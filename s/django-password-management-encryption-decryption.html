<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="applicable-device" content="pc,mobile">
  <meta name="keywords" content="Django, å¯†ç ç®¡ç†, åŠ å¯†è§£å¯†, Sadminå…¬å…±åº“, Django signals, é‡å†™modelçš„saveæ–¹æ³•" />
  <meta name="description" content="æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•é€šè¿‡é‡æ„Djangoé¡¹ç›®ä¸­çš„å¯†ç ç®¡ç†è¡¨å®ä¾‹ï¼Œå°†åŠ å¯†è§£å¯†é€»è¾‘ä»viewå±‚ç§»è‡³modelå±‚ï¼Œä»¥å®ç°æ›´ä¼˜é›…çš„ä»£ç ç»“æ„å’Œæ›´é«˜çš„ä»£ç å¤ç”¨æ€§ã€‚" />
  <link rel="alternate" type="application/rss+xml" title="è¿ç»´å’–å•¡å§" href="https://blog.ops-coffee.com/feed.xml" />
  <link rel="stylesheet" href="https://blog.ops-coffee.com/static/posts/css/ops-coffee.min.css" type="text/css" />

  <!-- Begin SEO tag -->
  <title>Django Modelå­—æ®µåŠ å¯†çš„ä¼˜é›…å®ç°</title>
  <meta property="og:locale" content="zh_CN" />
  <meta property="og:site_name" content="è¿ç»´å’–å•¡å§" />
  <meta property="og:url" content="https://blog.ops-coffee.coms/django-password-management-encryption-decryption.html" />
  <meta property="og:title" content="Django Modelå­—æ®µåŠ å¯†çš„ä¼˜é›…å®ç°" />
  <meta property="og:description" content="æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•é€šè¿‡é‡æ„Djangoé¡¹ç›®ä¸­çš„å¯†ç ç®¡ç†è¡¨å®ä¾‹ï¼Œå°†åŠ å¯†è§£å¯†é€»è¾‘ä»viewå±‚ç§»è‡³modelå±‚ï¼Œä»¥å®ç°æ›´ä¼˜é›…çš„ä»£ç ç»“æ„å’Œæ›´é«˜çš„ä»£ç å¤ç”¨æ€§ã€‚" />
  <link rel="canonical" href="https://blog.ops-coffee.coms/django-password-management-encryption-decryption.html" />

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "Django Modelå­—æ®µåŠ å¯†çš„ä¼˜é›…å®ç°",
    "description": "æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•é€šè¿‡é‡æ„Djangoé¡¹ç›®ä¸­çš„å¯†ç ç®¡ç†è¡¨å®ä¾‹ï¼Œå°†åŠ å¯†è§£å¯†é€»è¾‘ä»viewå±‚ç§»è‡³modelå±‚ï¼Œä»¥å®ç°æ›´ä¼˜é›…çš„ä»£ç ç»“æ„å’Œæ›´é«˜çš„ä»£ç å¤ç”¨æ€§ã€‚",
    "url": "https://blog.ops-coffee.coms/django-password-management-encryption-decryption.html",
    "author": {
      "@type": "Person",
      "name": "è¿ç»´å’–å•¡å§"
    },
    "publisher": {
      "@type": "Organization",
      "name": "è¿ç»´å’–å•¡å§",
      "logo": {
        "@type": "ImageObject",
        "url": "https://blog.ops-coffee.com/favicon.ico"
      }
    },
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://blog.ops-coffee.coms/django-password-management-encryption-decryption.html"
    }
  }
  </script>
  <!-- End SEO tag -->
</head>

<body>
  <div class="header">
    <div class="menu-button">&#9776; 
        <span class="menu-title">è¿ç»´å’–å•¡å§</span>
    </div> 

    <div class="container">
      <nav class="header-site">
        <ul>
          <li><a href="/">é¦–é¡µ</a></li>
            <li class="has-submenu">
              <a href="#" target="_self">è¿ç»´</a>
              <ul class="sub-menu">
                <li><a href="/tag/ç³»ç»Ÿè¿ç»´/" target="_self">ç³»ç»Ÿè¿ç»´</a></li>
                <li><a href="/elk/index.html" target="_self">ELKç³»åˆ—</a></li>
                <li><a href="/ldap/index.html" target="_self">LDAPç³»åˆ—</a></li>
              </ul>
            </li>
            <li class="has-submenu">
              <a href="#" target="_self">å¼€å‘</a>
              <ul class="sub-menu">
                <li><a href="/tag/Devops/" target="_self">DevOps</a></li>
                <li><a href="/tag/Python/" target="_self">Python</a></li>
                <li><a href="/tag/Django/" target="_self">Django</a></li>
                <li><a href="/bpmn/index.html" target="_self">BPMNç³»åˆ—</a></li>
                <li><a href="/webssh/index.html" target="_self">WebSSHç³»åˆ—</a></li>
                <li><a href="/frontend/index.html" target="_self">å‰ç«¯å¼€å‘ç³»åˆ—</a></li>
              </ul>
            </li>
            <li><a href="/devops/index.html" target="_self">è¿ç»´å¹³å°</a></li>
            <li class="has-submenu">
              <a href="#" target="_self">è¿™æ˜¯ç”Ÿæ´»</a>
              <ul class="sub-menu">
                <li><a href="/life/chronicles.html" target="_self">æ—¶å…‰å°è®°</a></li>
                <li><a href="/life/money.html" target="_self">å‰¯ä¸šèµšé’±</a></li>
                <li><a href="/life/writing.html" target="_self">å†™ä½œç›¸å…³</a></li>
                <li><a href="/tag/è¿™æ˜¯ç”Ÿæ´»/" target="_self">ç”Ÿæ´»éšç¬”</a></li>
              </ul>
            </li>
            <li class="has-submenu">
              <a href="#" target="_self">æˆ¿è½¦æ—…è¡Œ</a>
              <ul class="sub-menu">
                <li><a href="/rv.html" target="_self">æˆ¿è½¦ä½“éªŒ</a></li>
                <li><a href="/travels.html" target="_self">æ—…è¡Œæ¸¸è®°</a></li>
                <li><a href="/travel/china.html" target="_self">æ—…è¡Œåœ°å›¾</a></li>
              </ul>
            </li>
            <li><a href="/tag/index.html" target="_self">æ ‡ç­¾</a></li>
            <li><a href="/archive.html" target="_self">å½’æ¡£</a></li>
          <li class="search"><a href="/search.html" target="_self" aria-label="æœç´¢">ğŸ”</a></li>
        </ul>
      </nav>
    </div>
  </div>

  <header>
    <div class="container">
      <a href="/">
        <div class="name">è¿ç»´å’–å•¡å§</div>
        <div class="slogan">äº«å—æŠ€æœ¯å¸¦æ¥çš„ä¹è¶£ï¼Œä½“éªŒç”Ÿæ´»ç»™äºˆçš„æ„ŸåŠ¨</div>
      </a>
    </div>
  </header>

  <div id="content-wrap">
    <div class="container">
        <h1 id="art-title">Django Modelå­—æ®µåŠ å¯†çš„ä¼˜é›…å®ç°</h1>

        <p>æ—©å‰çš„ä¸€ç¯‡æ–‡ç« <a href="https://blog.ops-coffee.com/s/django-security-password-table-database-rsa.html" target="_blank">Djangoå¼€å‘å¯†ç ç®¡ç†è¡¨å®ä¾‹</a>æœ‰å†™æˆ‘ä»¬å†™äº†ä¸ªå¯†ç ç®¡ç†å·¥å…·æ¥å®ç°å¯¹å¯†ç çš„ç®¡ç†ï¼Œå½“æ—¶åŠ å¯†è§£å¯†çš„åŠŸèƒ½åœ¨viewå±‚å®ç°ï¼Œä¸€ç›´è¿è¡Œç¨³å®šæ‰€ä»¥ä¹Ÿæ²¡æœ‰è¿‡å¤šå…³æ³¨å®ç°æ˜¯å¦ä¼˜é›…çš„é—®é¢˜ã€‚æœ€è¿‘è¦å¤šåŠ å‡ ä¸ªå¯†ç è¡¨å†æ¬¡å›å¤´çœ‹ä¹‹å‰çš„ä»£ç å‘ç°åŠ è§£å¯†åœ¨viewå±‚å®ç°è¾ƒä¸ºç¹çï¼Œå°¤å…¶æ˜¯ä½¿ç”¨äº†<a href="https://blog.ops-coffee.com/sadmin/index.html" target="_blank">Sadminå…¬å…±åº“</a>ä¹‹åviewçš„ä»£ç ç®€æ´äº†å¾ˆå¤šï¼Œè‹¥å†åœ¨viewå±‚å¤„ç†æ˜¾ç„¶ä¸å¤Ÿä¼˜é›…ï¼Œæ˜¯æ—¶å€™ç”¨æ›´ä¼˜é›…çš„æ–¹å¼æ¥å®ç°äº†</p>
<h2 id="sadmin">Sadminå¢åˆ æ”¹æŸ¥</h2>
<p>å¯¹æ•°æ®åº“è¡¨çš„å¢åˆ æ”¹æŸ¥æ˜¯å¼€å‘è¿‡ç¨‹ä¸­æœ€å¸¸ç”¨åˆ°çš„åŠŸèƒ½ï¼Œä¹‹å‰çš„æ–‡ç« ä¹Ÿä»‹ç»è¿‡æˆ‘ä»¬é€šè¿‡å°è£…<a href="https://blog.ops-coffee.com/sadmin/index.html" target="_blank">Sadminå…¬å…±åº“</a>ç”¨æœ€ä¸ºç®€æ´çš„ä»£ç å®ç°äº†å¯¹è¡¨çš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼Œå…·ä½“æœ‰å¤šç®€æ´ï¼Œçœ‹ä¸‹è¾¹çš„ä»£ç </p>
<pre class="codehilite"><code>class TableList(ListCreateView):
    model = Table
    template = 'password/table.html'
    permission = {'get': 'password.select_table', 'post': 'password.create_table'}


class TableDetail(RetrieveUpdateDestroyView):
    model = Table
    permission = {'get': 'password.select_table', 'put': 'password.update_table',
                  'delete': 'password.delete_table'}</code></pre>


<p><code>TableList</code>ç±»å¯ä»¥å®ç°å¯¹è¡¨çš„æŸ¥è¯¢ä»¥åŠæ–°å»ºè¡¨æ•°æ®ï¼Œ<code>TableDetail</code>å¯ä»¥å®ç°å¯¹è¡¨å†…å•æ¡æ•°æ®çš„æŸ¥è¯¢ã€ä¿®æ”¹å’Œåˆ é™¤ï¼Œå¯¹åº”äº†ä¸¤æ¡URL</p>
<pre class="codehilite"><code>path('table/', views.TableList.as_view(), name='table-list-url'),
path('table/&lt;int:pk&gt;/', views.TableDetail.as_view(), name='table-detail-url'),</code></pre>


<p>å¦‚æœåœ¨viewå±‚å®ç°è¡¨å­—æ®µçš„åŠ å¯†çš„è¯ï¼Œé‚£å°±è¦é‡å†™<code>TableList</code>çš„postæ–¹æ³•ï¼Œä»¥åŠ<code>TableDetail</code>ç±»çš„putæ–¹æ³•ï¼Œéå¸¸éº»çƒ¦ï¼Œé‚£æœ‰ä»€ä¹ˆæ›´ä¸ºä¼˜é›…çš„æ–¹æ³•å‘¢ï¼Ÿå¯¹è¡¨å­—æ®µçš„å¤„ç†æœ€å¥½èƒ½åœ¨è¡¨å‘ç”Ÿå˜åŒ–çš„æ—¶å€™æ¥å¤„ç†ï¼Œç›´æ¥åœ¨modelå±‚æ¥å®ç°æ˜¾ç„¶è¦æ¯”viewæ›´åˆé€‚ï¼Œmodelå±‚æ¥å®ç°çš„è¯é€šè¿‡<a href="https://blog.ops-coffee.com/s/django-signals-for-notification-in-ticket-system.html" target="_blank">Djangoçš„signals</a>æˆ–æ˜¯<a href="https://blog.ops-coffee.com/s/django-model-update-save-method-validation.html" target="_blank">é‡å†™modelçš„saveæ–¹æ³•</a>éƒ½æ˜¯ä¸é”™çš„é€‰æ‹©</p>
<p>è‡³äºç©¶ç«Ÿæ˜¯ç”¨signalsè¿˜æ˜¯é‡å†™saveæ–¹æ³•ï¼Œä¸¤è€…éƒ½å¯ä»¥å®ç°ï¼Œä¸ªäººè§‰å¾—å¯¹äºç®€å•çš„å¤„ç†é€»è¾‘é‡‡ç”¨é‡å†™saveçš„æ–¹å¼æ¯”è¾ƒå¥½ï¼Œè€Œå¯¹äºå¤æ‚çš„å¤„ç†é€»è¾‘é‡‡ç”¨signalsæ›´æ¸…æ™°ï¼Œè€Œå¯¹äºæˆ‘ä»¬è¿™ä¸ªå¯¹å­—æ®µè¿›è¡ŒåŠ å¯†çš„éœ€æ±‚ï¼Œé€»è¾‘ç®€å•ä»£ç ä¹Ÿä¸éœ€è¦å¤ªå¤šï¼Œç›´æ¥é‡‡ç”¨é‡å†™saveçš„æ–¹å¼å°±å¥½äº†</p>
<h2 id="modelsave">é‡å†™modelçš„saveæ–¹æ³•</h2>
<p>å¯¹äºåŠ å¯†è§£å¯†çš„æ ¸å¿ƒä»£ç å¯ä»¥å‚è€ƒæ–‡ç« <a href="https://blog.ops-coffee.com/s/django-security-password-table-database-rsa.html" target="_blank">Djangoå¼€å‘å¯†ç ç®¡ç†è¡¨å®ä¾‹</a>ç»™å‡ºçš„æºç ï¼Œé‡å†™modelçš„saveæ–¹æ³•ä»£ç å¦‚ä¸‹</p>
<pre class="codehilite"><code>class Table(models.Model):
    username = models.CharField(max_length=64, verbose_name='ç”¨æˆ·å')
    password = models.CharField(max_length=512, verbose_name='å¯†ç ')

    def __str__(self):
        return self.application_name

    def save(self, *args, **kwargs):
        _encrypt = True

        if self.pk:
            old_password = Table.objects.get(id=self.id)
            _encrypt = False if old_password.password == self.password else True

        if _encrypt:
            _m = RsaCrypto().encrypt(self.password)
            if _m.get('state'):
                self.password = _m.get('message')
            else:
                raise Exception('åŠ å¯†å¤±è´¥ï¼š' + _m.get('message'))

        super(Table, self).save(*args, **kwargs)</code></pre>


<p>å¯¹äºå¯†ç åŠ å¯†ï¼Œé€šå¸¸ä¼šåœ¨é¦–æ¬¡æ–°åŠ è®°å½•ï¼Œä»¥åŠæ›´æ–°è®°å½•å¯†ç å‘ç”Ÿå˜åŒ–çš„æƒ…å†µä¸‹è¿›è¡Œ</p>
<p>æ¯å½“saveæ—¶å¦‚ä½•åˆ¤æ–­æ˜¯insertè¿˜æ˜¯updateå‘¢ï¼Ÿå¯ä»¥é€šè¿‡æ˜¯å¦å­˜åœ¨<code>self.pk</code>æ¥åˆ¤æ–­ï¼ŒDjangoçš„modelå¿…é¡»æœ‰ä¸€ä¸ªå­—æ®µä¸ºä¸»é”®ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰è®¾ç½®ä¸»é”®å­—æ®µï¼Œé‚£ä¹ˆDjangoä¼šé»˜è®¤åˆ›å»ºä¸€ä¸ªåä¸º<code>id</code>çš„å­—æ®µä½œä¸»é”®ï¼Œä¸»é”®ä¹Ÿç”¨<code>pk</code>åˆ«åæ¥è¡¨ç¤ºï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡<code>self.pk</code>æ˜¯å¦å­˜åœ¨æ¥åˆ¤æ–­æœ¬æ¬¡saveç©¶ç«Ÿæ˜¯insertè¿˜æ˜¯update</p>
<p>å½“æœ¬æ¬¡saveä¸ºupdateæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦åˆ¤æ–­å¯†ç å­—æ®µæ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ï¼Œå¦‚æœæ²¡æœ‰å˜åŒ–åˆ™ä¸éœ€è¦è°ƒç”¨åŠ å¯†æ–¹æ³•ï¼Œåˆ¤æ–­å­—æ®µæ˜¯å¦å˜åŒ–å°±éœ€è¦è·å–å­—æ®µæäº¤å‰çš„å€¼ï¼Œæäº¤å‰çš„å€¼å¯ä»¥é€šè¿‡<code>Table.objects.get(id=self.id)</code>æ¥è·å–</p>
<p>æœ‰äº†ä»¥ä¸Šè¿™äº›ä¿¡æ¯ï¼Œé‚£åŠ å¯†å°±æ°´åˆ°æ¸ æˆäº†ã€‚æˆ‘ä»¬ä¼˜é›…çš„å®ç°äº†å­—æ®µçš„åŠ å¯†ï¼Œé‚£å¯¹äºè§£å¯†å‘¢ï¼Ÿä¸ªäººè§‰å¾—åŒæ ·æ”¾åœ¨modelé‡Œæ¯”å†™åœ¨veiwé‡Œæ›´åˆé€‚ï¼Œå¯ä»¥åœ¨mdelé‡ŒåŠ ä¸ª<code>decode_password</code>çš„æ–¹æ³•</p>
<pre class="codehilite"><code>class Table(models.Model):
    ...

    def decode_password(self):
        _m = RsaCrypto().decrypt(self.password)
        if _m.get('state'):
            return {
                'state': 1,
                'message': _m.get('message'),
                'username': self.username
            }
        else:
            return {'state': 0, 'message': 'Error: ' + _m.get('message')}</code></pre>


<p>éœ€è¦è§£å¯†æ—¶è°ƒç”¨Modelçš„<code>decode_password</code>æ–¹æ³•å°±å¯ä»¥äº†</p>
<pre class="codehilite"><code>def decode_password(request, pk):
    try:
        _t = Table.objects.get(id=pk)
        return JsonResponse(_t.decode_password())
    except Exception as e:
        return JsonResponse({'state': 0, 'message': 'Error: ' + str(e)})</code></pre>


<h2 id="_1">å†™åœ¨æœ€å</h2>
<p>ä¸ªäººå¯¹ä»£ç æœ‰ä¸€ç‚¹æ´ç™–ï¼Œå®ç°åŠŸèƒ½ä¹Ÿä»¥ç®€å•å®ç”¨ä¸ºä¸»ï¼Œèƒ½2è¡Œæå®šçš„ç»å¯¹ä¸ä¼šå†™3è¡Œï¼Œèƒ½æœ‰æ›´ä¼˜çš„è§£æ³•å°±ä¼šæ¯«ä¸çŠ¹è±«å»é‡æ„ï¼ŒåŒæ—¶ä¹Ÿåšå†³åå¯¹â€œåˆä¸æ˜¯ä¸èƒ½ç”¨â€çš„è¯´æ³•ã€‚å¯¹äºä»¥ä¸Šå®ç°æ˜¯å¦ä¼˜é›…ï¼Œæˆ–æ˜¯æœ‰æ›´å¥½çš„è§£å†³æ–¹æ³•ï¼Œæ¬¢è¿è®¨è®º</p>

        <div>
          <ul style="display: inline-block;padding: 0;margin: 0 0 0.5em;color: #999;">
            <li style="display: inline-block;margin: 0 1em 0 0;"><a href="/s/django-password-management-encryption-decryption.html">ğŸ“… 2021-10-21</a></li>
<li style="display: inline-block;margin: 0 1em 0 0;"><a href="/tag/Django/">ğŸ·ï¸ Django</a></li><li style="display: inline-block;margin: 0 1em 0 0;"><a href="/tag/å…³äºæŠ€æœ¯/">ğŸ·ï¸ å…³äºæŠ€æœ¯</a></li>          </ul>
        </div>

        <hr>

        <div class="pagination">
            <a href="https://blog.ops-coffee.com/s/probius-kubernetes-pod-monitoring-integration.html" class="pagination-item prev-page">
                <span class="pagination-arrow">â†</span>
                <span class="pagination-text">ä¸Šä¸€ç¯‡ï¼š<br>Probius+Prometheusé€šè¿‡APIé›†æˆPODç›‘æ§</span>
            </a>
            <a href="https://blog.ops-coffee.com/s/traditional-idc-environment-operation-and-automation.html" class="pagination-item next-page">
                <span class="pagination-text">ä¸‹ä¸€ç¯‡ï¼š<br>ä»ä¸€ä»¶å°äº‹è¯´èµ·æˆ‘æ˜¯å¦‚ä½•æ€è€ƒä¸æ‰§è¡Œçš„</span>
                <span class="pagination-arrow">â†’</span>
            </a>
        </div>

        <div class="nav-cell">
    <script async src="https://giscus.app/client.js"
            data-repo="ops-coffee/blog" data-repo-id="MDEwOlJlcG9zaXRvcnkxNDY4OTI0MTg="
            data-category="Announcements" data-category-id="DIC_kwDOCMFmgs4CQar3"
            data-mapping="pathname" data-strict="0" data-reactions-enabled="1"
            data-emit-metadata="0" data-input-position="top" data-theme="light"
            data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous">
    </script>
</div>

        <div>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8944257246828217"
         data-ad-slot="6731434232" data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</div>

        <div class="nav-cell">
            <p class="nav-list-title">èƒ½çœ‹åˆ°è¿™é‡Œä¸€å®šæ˜¯çœŸçˆ±ï¼Œè®¢é˜…ä¸€ä¸‹å§</p>
            <img alt="" loading="lazy" src="/static/images/wx.sou1.png" />
        </div>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <div class="copy"> Â© ops-coffee</div>

      <div class="link">
        <a href="/comments.html" title="ç»™æˆ‘ç•™è¨€" target="_blank">ç•™è¨€</a>
        <a href="/friends.html" title="å‹æƒ…é“¾æ¥" target="_blank">å‹é“¾</a>
      </div>
    </div>
  </footer>
  
  <!-- Umami -->
<script defer src="https://umami.ops-coffee.cn/script.js" data-website-id="248e61f0-c324-444e-a56d-bf97ee44a8fc"></script>

<!-- Google Adsense -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8944257246828217" crossorigin="anonymous"></script>
</body>
</html>