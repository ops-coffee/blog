<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="applicable-device" content="pc,mobile">
  <meta name="keywords" content="Djangoæƒé™ç®¡ç†, Django-guardian, å¯¹è±¡æƒé™æ§åˆ¶, Djangoæƒé™æ‰©å±•, Djangoæƒé™åˆ†é…, Djangoæˆæƒ" />
  <meta name="description" content="æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†Django-guardiançš„å®‰è£…é…ç½®ã€æƒé™åˆ†é…ã€æƒé™å»é™¤ã€æ ¹æ®ç”¨æˆ·å’Œå¯¹è±¡è·å–æƒé™ã€ä»¥åŠå¦‚ä½•åœ¨æ¨¡æ¿å’Œè§†å›¾ä¸­ä½¿ç”¨guardianè¿›è¡Œæƒé™ç®¡ç†ï¼Œå¸®åŠ©ä½ åœ¨å„ç§åœºæ™¯ä¸‹æ›´å¥½åœ°ç®¡ç†Djangoæƒé™ã€‚" />
  <link rel="alternate" type="application/rss+xml" title="è¿ç»´å’–å•¡å§" href="https://blog.ops-coffee.cn/feed.xml" />
  <link rel="stylesheet" href="https://blog.ops-coffee.cn/static/posts/css/ops-coffee.min.css" type="text/css" />

  <!-- Begin SEO tag -->
  <title>Django Object Permissionä¹‹Django-guardianä½¿ç”¨è¯¦è§£</title>
  <meta property="og:locale" content="zh_CN" />
  <meta property="og:site_name" content="è¿ç»´å’–å•¡å§" />
  <meta property="og:url" content="https://blog.ops-coffee.cn" />
  <meta property="og:title" content="Django Object Permissionä¹‹Django-guardianä½¿ç”¨è¯¦è§£" />
  <meta property="og:description" content="æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†Django-guardiançš„å®‰è£…é…ç½®ã€æƒé™åˆ†é…ã€æƒé™å»é™¤ã€æ ¹æ®ç”¨æˆ·å’Œå¯¹è±¡è·å–æƒé™ã€ä»¥åŠå¦‚ä½•åœ¨æ¨¡æ¿å’Œè§†å›¾ä¸­ä½¿ç”¨guardianè¿›è¡Œæƒé™ç®¡ç†ï¼Œå¸®åŠ©ä½ åœ¨å„ç§åœºæ™¯ä¸‹æ›´å¥½åœ°ç®¡ç†Djangoæƒé™ã€‚" />
  <link rel="canonical" href="https://blog.ops-coffee.cn" />
  <!-- End SEO tag -->
</head>

<body>
  <div class="header">
    <div class="menu-button">&#9776; 
        <span class="menu-title">è¿ç»´å’–å•¡å§</span>
    </div> 

    <div class="container no-sidebar">
      <nav class="header-site">
        <ul>
          <li><a href="/">é¦–é¡µ</a></li>
            <li class="has-submenu">
              <a href="#" target="_self">è¿ç»´</a>
              <ul class="sub-menu">
                <li><a href="/tag/ç³»ç»Ÿè¿ç»´/" target="_self">ç³»ç»Ÿè¿ç»´</a></li>
                <li><a href="/elk/index.html" target="_self">ELKç³»åˆ—</a></li>
                <li><a href="/ldap/index.html" target="_self">LDAPç³»åˆ—</a></li>
              </ul>
            </li>
            <li class="has-submenu">
              <a href="#" target="_self">å¼€å‘</a>
              <ul class="sub-menu">
                <li><a href="/tag/Devops/" target="_self">DevOps</a></li>
                <li><a href="/tag/Python/" target="_self">Python</a></li>
                <li><a href="/tag/Django/" target="_self">Django</a></li>
                <li><a href="/bpmn/index.html" target="_self">BPMNç³»åˆ—</a></li>
                <li><a href="/webssh/index.html" target="_self">WebSSHç³»åˆ—</a></li>
                <li><a href="/frontend/index.html" target="_self">å‰ç«¯å¼€å‘ç³»åˆ—</a></li>
              </ul>
            </li>
            <li><a href="/devops/index.html" target="_self">è¿ç»´å¹³å°</a></li>
            <li class="has-submenu">
              <a href="#" target="_self">è¿™æ˜¯ç”Ÿæ´»</a>
              <ul class="sub-menu">
                <li><a href="/life/chronicles.html" target="_self">æ—¶å…‰å°è®°</a></li>
                <li><a href="/life/money.html" target="_self">å‰¯ä¸šèµšé’±</a></li>
                <li><a href="/life/writing.html" target="_self">å†™ä½œç›¸å…³</a></li>
                <li><a href="/tag/è¿™æ˜¯ç”Ÿæ´»/" target="_self">ç”Ÿæ´»éšç¬”</a></li>
              </ul>
            </li>
            <li class="has-submenu">
              <a href="#" target="_self">æˆ¿è½¦æ—…è¡Œ</a>
              <ul class="sub-menu">
                <li><a href="/rv.html" target="_self">æˆ¿è½¦ä½“éªŒ</a></li>
                <li><a href="/travels.html" target="_self">æ—…è¡Œæ¸¸è®°</a></li>
                <li><a href="/travel/china.html" target="_self">æ—…è¡Œåœ°å›¾</a></li>
              </ul>
            </li>
            <li><a href="/tag/index.html" target="_self">æ ‡ç­¾</a></li>
            <li><a href="/archive.html" target="_self">å½’æ¡£</a></li>
          <li class="search"><a href="/search.html" target="_self">ğŸ”</a></li>
        </ul>
      </nav>
    </div>
  </div>

  <header>
    <div class="container no-sidebar">
      <a href="/">
        <div class="name">è¿ç»´å’–å•¡å§</div>
        <div class="slogan">äº«å—æŠ€æœ¯å¸¦æ¥çš„ä¹è¶£ï¼Œä½“éªŒç”Ÿæ´»ç»™äºˆçš„æ„ŸåŠ¨</div>
      </a>
    </div>
  </header>

  <div id="content-wrap">
    <div class="container no-sidebar">
        <h1 id="art-title">Django Object Permissionä¹‹Django-guardianä½¿ç”¨è¯¦è§£</h1>

        <blockquote>
<p>Guardianè¯¦ç»†ç”¨æ³•ä»‹ç»ï¼ŒåŠ©ä½ ç©è½¬å„ç§åœºæ™¯ä¸‹çš„Djangoæƒé™ç®¡ç†</p>
</blockquote>
<p><a href="https://blog.ops-coffee.cn/s/django-contrib-auth-permissions-system.html" target="_blank">Djangoé»˜è®¤æƒé™æœºåˆ¶ä»‹ç»åŠå®è·µ</a>æ–‡ç« ä¸­è®²åˆ°Djangoé»˜è®¤çš„æƒé™åˆ†é…æœ€å°ç²’åº¦æ˜¯<strong>è¡¨</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€æ—¦æˆ‘ä»¬ç»™äº†ç”¨æˆ·è¿™ä¸ªè¡¨çš„ä¿®æ”¹æƒé™ï¼Œé‚£ä¹ˆç”¨æˆ·å°±å¯ä»¥ä¿®æ”¹è¡¨é‡Œçš„æ‰€æœ‰æ•°æ®ï¼Œè¿™åœ¨æŸäº›æƒ…å†µä¸‹æ˜¯æ— æ³•æ»¡è¶³éœ€æ±‚çš„ï¼Œä¾‹å¦‚å¯¹äºä¸€ä¸ªArticleæ–‡ç« è¡¨æ¥è¯´ï¼Œæˆ‘ä»¬è§„å®šç”¨æˆ·åªèƒ½ä¿®æ”¹è‡ªå·±çš„æ–‡ç« ï¼Œè€Œä¸èƒ½ä¿®æ”¹åˆ«äººçš„æ–‡ç« ï¼ŒDjangoçš„é»˜è®¤æƒé™æœºåˆ¶å°±æ— æ³•åšåˆ°</p>
<p>é‚£è¯¥å¦‚ä½•å®ç°ä¸Šè¿°éœ€æ±‚å‘¢ï¼Ÿ<a href="/s/BZsJnWLtv8ZwwlBYbWSbZQ" target="_blank">Djangoå†…ç½®æƒé™æ‰©å±•æ¡ˆä¾‹</a>æ–‡ç« å°±ç»™äº†å®ç°çš„æ–¹æ³•ï¼Œåœ¨Articleè¡¨æ–°åŠ å­—æ®µæ¥æ ‡è¯†è°æœ‰ä¿®æ”¹çš„æƒé™å³å¯ï¼Œè¯•æƒ³å¦‚æœæˆ‘ä»¬æœ‰å¾ˆå¤šè¡¨éƒ½éœ€è¦ç±»ä¼¼çš„æƒé™æ§åˆ¶å‘¢ï¼Ÿå°±éœ€è¦ä¸æ–­çš„æ¥æ·»åŠ å­—æ®µæ ‡è¯†æƒé™ï¼Œè¿™ç§æ–¹æ¡ˆçš„å¼Šç«¯é©¬ä¸Šæ˜¾ç°ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§æ›´ä¸ºä¼˜é›…çš„æ–¹æ¡ˆæ¥è§£å†³å‘¢ï¼Ÿ</p>
<p>åŸºäºå¯¹è±¡çš„æƒé™æ§åˆ¶å°±æ˜¯å¾ˆå¥½çš„æ–¹æ³•ï¼Œä»–çš„æƒé™æ§åˆ¶ç²’åº¦ä¸ºè¡¨ä¸­çš„<strong>å¯¹è±¡</strong>ï¼Œå¯ä»¥ç»™æ¯ä¸€ä¸ªå¯¹è±¡èµ‹äºˆæƒé™ï¼Œ<code>Django-guardian</code>ä¾¿æ˜¯åŸºäºDjangoçš„åŸç”Ÿé€»è¾‘æ‰©å±•å‡ºæ¥çš„å¯¹è±¡æƒé™æ§åˆ¶æ–¹æ¡ˆï¼Œä»–æ‰©å±•äº†Djangoçš„é»˜è®¤æƒé™æ–¹æ¡ˆï¼Œä»è€Œä½¿Djangoçš„æƒé™æ§åˆ¶æœºåˆ¶æ›´åŠ å®Œå–„</p>
<h2 id="_1">å®‰è£…é…ç½®</h2>
<p><code>django-guardian</code>å½“å‰çš„æœ€æ–°ç‰ˆæœ¬æ˜¯v2.2.0ï¼Œæ”¯æŒdjango2.1ä»¥ä¸Šç‰ˆæœ¬ï¼ŒåŒ…æ‹¬django3.0ï¼Œä¾èµ–pythonç‰ˆæœ¬3.5+ï¼Œä»¥ä¸‹æ¼”ç¤ºä»£ç å‡åŸºäºdjango3.0.2</p>
<p>å¯ä»¥ç›´æ¥é€šè¿‡pipæ¥å®‰è£…<code>django-guardian</code></p>
<pre class="codehilite"><code>pip install django-guardian</code></pre>


<p>å®‰è£…å®Œæˆåï¼Œéœ€è¦å°†guardianä»¥ç‹¬ç«‹appçš„æ–¹å¼å®‰è£…è¿›django</p>
<p>ä¿®æ”¹djangoé…ç½®æ–‡ä»¶settings.pyï¼Œåœ¨INSTALLED_APPSé…ç½®ä¸­æ·»åŠ <code>guardian</code></p>
<pre class="codehilite"><code>INSTALLED_APPS = [
    'guardian',
]</code></pre>


<p>ç„¶åå°†guardianä½œä¸ºé¢å¤–çš„æˆæƒBACKENDæ·»åŠ è¿›é…ç½®æ–‡ä»¶settings.py</p>
<pre class="codehilite"><code>AUTHENTICATION_BACKENDS = (
    'django.contrib.auth.backends.ModelBackend',
    'guardian.backends.ObjectPermissionBackend',
)</code></pre>


<p>djangoé»˜è®¤é€šè¿‡<code>django.contrib.auth.backends.ModelBackend</code>è¿›è¡Œç”¨æˆ·éªŒè¯æˆæƒï¼Œæˆ‘ä»¬è¿™é‡Œæ·»åŠ äº†<code>guardian.backends.ObjectPermissionBackend</code>ä½œä¸ºé»˜è®¤éªŒè¯æˆæƒçš„æ‰©å±•</p>
<p>æœ€ååˆ›å»ºguardiançš„æ•°æ®åº“è¡¨</p>
<pre class="codehilite"><code>python manage.py migrate</code></pre>


<p>åˆ›å»ºå®Œæˆåï¼Œä¼šå‘ç°æ•°æ®åº“é‡Œå¤šäº†ä¸¤å¼ è¡¨<code>guardian_groupobjectpermission</code>å’Œ<code>guardian_userobjectpermission</code>ï¼Œä¸¤ä¸ªè¡¨åˆ†åˆ«è®°å½•äº†ç”¨æˆ·/ç»„ä¸modelä»¥åŠmodelå†…çš„å…·ä½“objectçš„æƒé™å¯¹åº”å…³ç³»ï¼Œä»¥<code>guardian_groupobjectpermission</code>è¡¨ä¸ºä¾‹ï¼Œè¯´ä¸‹å„å­—æ®µçš„å«ä¹‰</p>
<ul>
<li><code>id</code>ï¼šé»˜è®¤ä¸»é”®</li>
<li><code>object_pk</code>ï¼šobjectçš„idï¼Œæ ‡è¯†å…·ä½“æ˜¯å“ªä¸ªå¯¹è±¡éœ€è¦æˆæƒï¼Œå¯¹åº”çš„æ˜¯å…·ä½“çš„æŸä¸€æ¡æ•°æ®</li>
<li><code>content_type_id</code>ï¼šè®°å½•å…·ä½“å“ªä¸ªè¡¨çš„idï¼Œå¯¹åº”çš„æ˜¯djangoç³»ç»Ÿè¡¨<code>django_content_type</code>å†…çš„æŸæ¡æ•°æ®ï¼Œdjangoæ‰€æœ‰æ³¨å†Œçš„modeléƒ½ä¼šåœ¨è¿™ä¸ªè¡¨é‡Œè®°å½•</li>
<li><code>group_id</code>ï¼šgroupçš„idï¼Œè®°å½•æ˜¯é‚£ä¸ªç»„çš„ç”¨æˆ·ä¼šæœ‰æƒé™ï¼Œå¯¹åº”çš„æ˜¯<code>auth_group</code>è¡¨é‡Œçš„æŸæ¡è®°å½•</li>
<li><code>permission_id</code>ï¼špermissionçš„idï¼Œè®°å½•å…·ä½“çš„æŸä¸ªæƒé™ï¼Œå¯¹åº”çš„æ˜¯<code>auth_permission</code>è¡¨é‡Œçš„æŸæ¡è®°å½•</li>
</ul>
<p>ä»è¿™å‡ ä¸ªå­—æ®µå°±å¯ä»¥æ¸…æ™°çš„è¡¨ç¤ºå‡ºæŸä¸ªç»„é‡Œçš„ç”¨æˆ·æ˜¯å¦å¯¹æŸä¸ªè¡¨é‡Œçš„æŸæ¡æ•°æ®å…·æœ‰å…·ä½“çš„æŸæƒé™ï¼Œ<code>guardian_userobjectpermission</code>è¡¨ç±»ä¼¼ï¼Œåªæ˜¯å°†groupæ¢æˆäº†userè€Œå·²</p>
<h2 id="_2">æƒé™åˆ†é…</h2>
<p>å¯ç”¨guardianå¯¹è±¡æƒé™ä¹‹åï¼Œå¯ä»¥é€šè¿‡<code>guardian.shortcuts.assign_perm()</code>æ–¹æ³•æ¥ä¸ºç”¨æˆ·/ç»„åˆ†é…æƒé™</p>
<p>å‡å¦‚æˆ‘ä»¬æœ‰<code>CommonTask</code>è¡¨å¦‚ä¸‹</p>
<pre class="codehilite"><code>class CommonTask(models.Model):
    create_time = models.DateTimeField(auto_now_add=True, verbose_name='åˆ›å»ºæ—¶é—´')
    update_time = models.DateTimeField(auto_now=True, verbose_name='æ›´æ–°æ—¶é—´')

    user = models.ForeignKey(User, on_delete=models.DO_NOTHING, db_constraint=False)
    name = models.CharField(max_length=128, unique=True, verbose_name='ä»»åŠ¡åç§°')

    template = models.ForeignKey(Template, on_delete=models.PROTECT, db_constraint=False)
    args = models.CharField(max_length=255, null=True, verbose_name='å‚æ•°')

    def __str__(self):
        return self.name

    class Meta:
        default_permissions = ()

        permissions = (
            (&quot;commontask_select&quot;, &quot;å¸¸ç”¨ä»»åŠ¡æŸ¥çœ‹æƒé™&quot;),
            (&quot;commontask_change&quot;, &quot;å¸¸ç”¨ä»»åŠ¡ä¿®æ”¹æƒé™&quot;),
            (&quot;commontask_run&quot;, &quot;æ‰§è¡Œå¸¸ç”¨ä»»åŠ¡&quot;),
        )</code></pre>


<p>å¦‚æœæƒ³æŠŠnameä¸º<code>dev-ops-coffee-build</code>çš„CommonTaskèµ‹æƒç»™nameä¸º<code>dev@ops-coffee.cn</code>çš„ç”¨æˆ·ï¼Œå¯ä»¥è¿™æ ·å¤„ç†</p>
<pre class="codehilite"><code># è·å–ä»»åŠ¡å¯¹è±¡
&gt;&gt;&gt; from engine.models import CommonTask
&gt;&gt;&gt; task = CommonTask.objects.get(name='dev-ops-coffee-build')

# è·å–ç”¨æˆ·å¯¹è±¡
&gt;&gt;&gt; from accounts.models import User
&gt;&gt;&gt; user = User.objects.get(username='dev@ops-coffee.cn')

# ç¡®è®¤ç”¨æˆ·dev@ops-coffee.cnå¯¹ä»»åŠ¡dev-ops-coffee-buildæ— æƒé™
&gt;&gt;&gt; user.has_perm('engine.commontask_run', task)
False

# ç»™ç”¨æˆ·èµ‹æƒ
&gt;&gt;&gt; from guardian.shortcuts import assign_perm
&gt;&gt;&gt; assign_perm('commontask_run', user, task)
&lt;UserObjectPermission: dev-ops-coffee-build | dev@ops-coffee.cn | commontask_run&gt;</code></pre>


<p>é€šè¿‡<code>assign_perm</code>å¯ä»¥ç»™ç”¨æˆ·èµ‹æƒï¼Œ<code>assign_perm</code>æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä¸º<code>perm</code>ã€<code>user_or_group</code>ä»¥åŠ<code>object</code></p>
<ul>
<li><code>perm</code>ï¼šæƒé™ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–è€…instanceå®ä¾‹ï¼Œå½“å¡«å†™å­—ç¬¦ä¸²æ—¶æ ¼å¼ä¸º<code>app_label.codename</code>ï¼Œè™½ç„¶åœ¨objectä¸ä¸ºNodeçš„æƒ…å†µä¸‹å¯ä»¥åªå†™<code>codename</code>ä½†ä¸æ¨è</li>
<li><code>user_or_group</code>ï¼šç”¨æˆ·æˆ–ç»„çš„å®ä¾‹ï¼Œä¹Ÿå¯ä»¥æ˜¯ç”¨æˆ·æˆ–ç»„çš„QuerySeté›†åˆ</li>
<li><code>object</code>ï¼šå¯¹è±¡å®ä¾‹ï¼Œå¯ä»¥ä¸ºNoneï¼Œå½“ä¸ºNoneæ—¶è¡¨ç¤ºç»™æ•´ä¸ªmodelèµ‹äºˆæƒé™ï¼Œä¹Ÿå¯ä»¥ä¸ºå¯¹è±¡çš„QuerySeté›†åˆ</li>
</ul>
<p>é€šè¿‡<code>has_perm</code>å¯ä»¥æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å…·æœ‰æƒé™ï¼Œhas_permæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæƒé™ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå…·ä½“çš„å¯¹è±¡ï¼Œå…¶ä¸­ç¬¬äºŒä¸ªå‚æ•°ä¸ºå¯é€‰å‚æ•°ï¼Œå¦‚æœæ²¡æœ‰åˆ™è·Ÿdjangoé»˜è®¤æƒé™æœºåˆ¶ä¸€æ ·ä¼šå»æ£€æŸ¥ç”¨æˆ·å¯¹modelæ˜¯å¦å…·æœ‰æƒé™ï¼Œå¦‚æœæœ‰åˆ™æ£€æŸ¥ç”¨æˆ·å¯¹modelä¸‹çš„objectæ˜¯å¦æœ‰æƒé™</p>
<p>èµ‹æƒè¿‡åå°±å¯ä»¥å†æ¬¡æŸ¥çœ‹ç”¨æˆ·æ˜¯å¦æœ‰æ­¤å¯¹è±¡çš„å¯¹åº”æƒé™äº†</p>
<pre class="codehilite"><code>&gt;&gt;&gt; user.has_perm('engine.commontask_run', task)
True</code></pre>


<p>å¯¹äºgroupç»„æˆæƒï¼Œæ“ä½œç±»ä¼¼</p>
<pre class="codehilite"><code># è·å–ç”¨æˆ·å¯¹è±¡
&gt;&gt;&gt; user = User.objects.get(username='qa@ops-coffee.cn')

# è·å–ç»„å¯¹è±¡
&gt;&gt;&gt; from django.contrib.auth.models import Group
&gt;&gt;&gt; group = Group.objects.get(name='æµ‹è¯•ç»„')

# ç»™ç”¨æˆ·åŠ å…¥ç»„
&gt;&gt;&gt; user.groups.add(group)

# å…ˆç¡®è®¤ä¸‹ç”¨æˆ·qa@ops-coffee.cnå¯¹ä»»åŠ¡dev-ops-coffee.cnæ— æƒé™
&gt;&gt;&gt; user.has_perm('engine.commontask_run', task)
False

# ç»™ç»„èµ‹æƒ
&gt;&gt;&gt; assign_perm('commontask_run', group, task)
&lt;GroupObjectPermission: dev-ops-coffee-build | æµ‹è¯•ç»„ | commontask_run&gt;</code></pre>


<p><code>assign_perm</code>åŒæ ·å¯ä»¥ç»™ç»„èµ‹æƒï¼Œåªéœ€è¦æŠŠç¬¬äºŒä¸ªå‚æ•°æ›¿æ¢ä¸ºç»„å¯¹è±¡å³å¯ï¼Œèµ‹æƒè¿‡åæŸ¥çœ‹ç»„å†…ç”¨æˆ·å°±æœ‰æƒé™äº†</p>
<pre class="codehilite"><code>&gt;&gt;&gt; user.has_perm('engine.commontask_run', task)
True</code></pre>


<p>ç”±äºåªèµ‹äºˆäº†ç”¨æˆ·ç»„å¯¹æŸä¸ªå…·ä½“å¯¹è±¡çš„æƒé™ï¼Œå¹¶æ²¡æœ‰èµ‹äºˆç”¨æˆ·ç»„å¯¹æ•´ä¸ªmodelçš„æƒé™ï¼Œæ‰€ä»¥<code>has_perm</code>æ£€æŸ¥ç”¨æˆ·å¯¹modelçš„æƒé™æ—¶ä¼šè¿”å›False</p>
<pre class="codehilite"><code>&gt;&gt;&gt; user.has_perm('engine.commontask_run')
False</code></pre>


<h2 id="_3">å»é™¤æƒé™</h2>
<p>å½“æˆ‘ä»¬éœ€è¦å»é™¤æƒé™æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>remove_perm</code>æ–¹æ³•ï¼Œ<code>remove_perm</code>æ–¹æ³•ä¸<code>assign_perm</code>æ–¹æ³•ç±»ä¼¼ï¼ŒåŒæ ·æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œå‚æ•°ç±»å‹ä¹Ÿç±»ä¼¼ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯<code>assign_perm</code>çš„ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æ˜¯QuerySetï¼Œè€Œ<code>remove_perm</code>çš„ç¬¬äºŒä¸ªå‚æ•°å¿…é¡»æ˜¯instance</p>
<p>å°±åƒè¿™æ ·<code>assign_perm</code>å¯ä»¥åŒæ—¶ç»™å¤šä¸ªç”¨æˆ·èµ‹æƒ</p>
<pre class="codehilite"><code>&gt;&gt;&gt; task =  CommonTask.objects.get(name='dev-ops-coffee-build')
&gt;&gt;&gt; assign_perm('engine.commontask_run', User.objects.filter(id__in=[3,4]), task)
[&lt;UserObjectPermission: dev-ops-coffee-build | test@ops-coffee.cn | commontask_run&gt;, &lt;UserObjectPermission: dev-ops-coffee-build | dev@ops-coffee.cn | commontask_run&gt;]</code></pre>


<p>å´ä¸èƒ½åŒæ—¶å»é™¤å¤šä¸ªç”¨æˆ·çš„æƒé™ï¼Œä»¥ä¸‹ç”¨æ³•ä¼šæŠ¥é”™</p>
<pre class="codehilite"><code>&gt;&gt;&gt; remove_perm('engine.commontask_run', User.objects.filter(id__in=[3,4]), task)
Traceback (most recent call last):
    ...
    'The QuerySet value for an exact lookup must be limited to '
ValueError: The QuerySet value for an exact lookup must be limited to one result using slicing.</code></pre>


<p>ä¸€ä¸ªæ¸…é™¤æƒé™çš„ä¾‹å­å¦‚ä¸‹ï¼Œä»¥ä¸‹ä¾‹å­ä¼šæ¸…é™¤ç”¨æˆ·<code>dev@ops-coffee.cn</code>å¯¹CommonTaskè¡¨ä¸‹æ‰€æœ‰å¯¹è±¡<code>engine.commontask_run</code>çš„æƒé™</p>
<pre class="codehilite"><code>&gt;&gt;&gt; from guardian.shortcuts import remove_perm
&gt;&gt;&gt;
&gt;&gt;&gt; remove_perm('engine.commontask_run', User.objects.get(username='dev@ops-coffee.cn'), CommonTask.objects.all())
(3, {'guardian.UserObjectPermission': 3})</code></pre>


<p>å½“ç„¶ç¬¬ä¸‰ä¸ªå‚æ•°objectæ˜¯å¯ä»¥ä¸ç”¨å†™çš„ï¼Œæ„æ€ä¹Ÿæ˜¯æ¸…é™¤æ•´ä¸ªmodelçš„æƒé™ï¼Œä¸ä»¥ä¸‹ç”¨æ³•æ•ˆæœä¸€æ ·</p>
<pre class="codehilite"><code>&gt;&gt;&gt; remove_perm('engine.commontask_run', User.objects.get(username='dev@ops-coffee.cn'))</code></pre>


<h2 id="_4">æ ¹æ®ç”¨æˆ·å’Œå¯¹è±¡è·å–æƒé™</h2>
<p><code>get_perms</code>æ–¹æ³•å¯ä»¥æ ¹æ®ç”¨æˆ·æˆ–ç»„ä»¥åŠå¯¹è±¡æ¥è·å–æƒé™ï¼Œæ¥æ”¶ä¸¤ä¸ªå‚æ•°<code>user_or_group</code>å®ä¾‹ä»¥åŠå¯¹è±¡å®ä¾‹</p>
<pre class="codehilite"><code>&gt;&gt;&gt; from guardian.shortcuts import get_perms

&gt;&gt;&gt; get_perms(User.objects.get(username='dev@ops-coffee.cn'), task)
['commontask_run']</code></pre>


<h2 id="_5">æ ¹æ®å¯¹è±¡å’Œæƒé™è·å–ç”¨æˆ·</h2>
<p>å½“æˆ‘ä»¬éœ€è¦è·å–æŸä¸ªå¯¹è±¡å“ªäº›ç”¨æˆ·æœ‰æƒé™æ—¶ï¼Œå¯ä»¥é€šè¿‡<code>get_users_with_perms</code>æ–¹æ³•æ¥å¤„ç†ï¼Œä¾‹å­å¦‚ä¸‹</p>
<p>å…ˆæ¥å‡†å¤‡æ•°æ®</p>
<pre class="codehilite"><code>&gt;&gt;&gt; task =  CommonTask.objects.get(name='dev-ops-coffee-build')
&gt;&gt;&gt;
&gt;&gt;&gt; u1 = User.objects.get(username='dev@ops-coffee.cn')
&gt;&gt;&gt; u2 = User.objects.get(username='qa@ops-coffee.cn')
&gt;&gt;&gt;
&gt;&gt;&gt; group = Group.objects.get(id=1)
&gt;&gt;&gt;
# èµ‹äºˆç”¨æˆ·u1å¯¹taskå¯¹è±¡æœ‰commontask_runçš„æƒé™
&gt;&gt;&gt; assign_perm('commontask_run', u1, task)
&lt;UserObjectPermission: dev-ops-coffee-build | dev@ops-coffee.cn | commontask_run&gt;

# èµ‹äºˆç”¨æˆ·u2å¯¹taskå¯¹è±¡æœ‰commontask_changeçš„æƒé™
&gt;&gt;&gt; assign_perm('commontask_change', u2, task)
&lt;UserObjectPermission: dev-ops-coffee-build | qa@ops-coffee.cn | commontask_change&gt;
&gt;&gt;&gt;

# æŠŠç”¨æˆ·test@ops-coffee.cnåŠ å…¥åˆ°ç»„group
&gt;&gt;&gt; User.objects.get(username='test@ops-coffee.cn').groups.add(group)

# èµ‹äºˆç»„groupå¯¹taskå¯¹è±¡æœ‰commontask_selectçš„æƒé™
&gt;&gt;&gt; assign_perm('commontask_select', group, task)
&lt;GroupObjectPermission: dev-ops-coffee-build | å¼€å‘ç»„ | commontask_select&gt;
&gt;&gt;&gt;</code></pre>


<p>é€šè¿‡<code>get_users_whth_perms</code>æ–¹æ³•è·å–å¯¹è±¡çš„æ‰€æœ‰æƒé™</p>
<pre class="codehilite"><code>&gt;&gt;&gt; from guardian.shortcuts import get_users_with_perms
&gt;&gt;&gt;
&gt;&gt;&gt; get_users_with_perms(task)
&lt;QuerySet [&lt;User: dev@ops-coffee.cn&gt;, &lt;User: qa@ops-coffee.cn&gt;, &lt;User: test@ops-coffee.cn&gt;]&gt;</code></pre>


<p>è¿™é‡Œå‘ç°superuserç”¨æˆ·å¹¶æ²¡æœ‰åœ¨æœ€ç»ˆçš„ç”¨æˆ·åˆ—è¡¨é‡Œï¼Œå¦‚æœæˆ‘ä»¬æƒ³è®©superuserç”¨æˆ·ä¹ŸåŒ…å«åœ¨å†…ï¼Œå¯ä»¥è®¾ç½®å‚æ•°<code>with_superusers=True</code></p>
<pre class="codehilite"><code>&gt;&gt;&gt; get_users_with_perms(task, with_superusers=True)
&lt;QuerySet [&lt;User: admin@163.com&gt;, &lt;User: dev@ops-coffee.cn&gt;, &lt;User: qa@ops-coffee.cn&gt;, &lt;User: test@ops-coffee.cn&gt;]&gt;</code></pre>


<p>ä»¥ä¸Šè¾“å‡ºç»“æœå±•ç¤ºäº†æ‰€æœ‰å…·æœ‰æƒé™çš„ç”¨æˆ·ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦æŸ¥çœ‹ç”¨æˆ·å…·æœ‰çš„æƒé™ï¼Œå¯ä»¥è®¾ç½®å‚æ•°<code>attach_perms=True</code>ï¼Œè¿”å›çš„ç»“æ„æ˜¯ä»¥ç”¨æˆ·ä¸ºkeyæƒé™ä¸ºvalueçš„ä¸€ä¸ªå­—å…¸ï¼Œçœ‹èµ·æ¥æ¸…æ™°æ˜äº†</p>
<pre class="codehilite"><code>&gt;&gt;&gt; get_users_with_perms(task, with_superusers=True, attach_perms=True)
{&lt;User: admin@163.com&gt;: ['commontask_change', 'commontask_run', 'commontask_select'], &lt;User: dev@ops-coffee.cn&gt;: ['commontask_run',
 'commontask_select'], &lt;User: qa@ops-coffee.cn&gt;: ['commontask_change', 'commontask_run'], &lt;User: test@ops-coffee.cn&gt;: ['commontask_select']}</code></pre>


<p>å¦‚æœæˆ‘ä»¬ä»…æƒ³æŸ¥çœ‹å…·æœ‰æŸä¸ªæƒé™çš„ç”¨æˆ·ï¼Œå¯ä»¥è®¾ç½®<code>only_with_perms_in</code>å‚æ•°ï¼Œä¾‹å¦‚æˆ‘ä»¬åªæƒ³æŸ¥çœ‹å¯¹è±¡æ‰€æœ‰å…·æœ‰<code>commontask_change</code>æƒé™çš„ç”¨æˆ·</p>
<pre class="codehilite"><code>&gt;&gt;&gt; get_users_with_perms(task, with_superusers=True, only_with_perms_in=['commontask_change'])
&lt;QuerySet [&lt;User: admin@163.com&gt;, &lt;User: qa@ops-coffee.cn&gt;]&gt;</code></pre>


<p>é»˜è®¤æƒ…å†µä¸‹ç”¨æˆ·æ‰€æ•°ç»„å¦‚æœå…·æœ‰æƒé™çš„è¯ä¹Ÿä¼šè¿”å›ï¼Œä¾‹å¦‚ä¸Šè¾¹çš„æˆ‘ä»¬æŠŠç”¨æˆ·<code>test@ops-coffee.cn</code>åŠ å…¥åˆ°äº†groupï¼Œç„¶åç»™groupèµ‹äºˆäº†æƒé™ï¼Œé‚£ä¹ˆç”¨æˆ·ä¹Ÿå°±å…·æœ‰äº†ç›¸åº”çš„æƒé™ï¼Œå¦‚æœæˆ‘ä»¬åªæƒ³æŸ¥çœ‹ç›´æ¥èµ‹äºˆç”¨æˆ·çš„æƒé™ï¼Œè€Œå¹¶éé—´æ¥é€šè¿‡groupå–å¾—çš„æƒé™ç”¨æˆ·åˆ—è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®å‚æ•°<code>with_group_users=False</code>ï¼Œæ­¤å‚æ•°é»˜è®¤ä¸ºTrue</p>
<pre class="codehilite"><code>&gt;&gt;&gt; get_users_with_perms(task, with_superusers=True, with_group_users=False)
&lt;QuerySet [&lt;User: admin@163.com&gt;, &lt;User: dev@ops-coffee.cn&gt;, &lt;User: qa@ops-coffee.cn&gt;]&gt;</code></pre>


<p>ä¸<code>get_users_with_perms</code>æ–¹æ³•ç›¸ç±»ä¼¼çš„æ˜¯<code>get_groups_with_perms</code>æ–¹æ³•ï¼Œä½†<code>get_groups_with_perms</code>è¦ç®€å•è®¸å¤šï¼Œåªèƒ½æ¥æ”¶ä¸¤ä¸ªå‚æ•°<code>object</code>å’Œ<code>attach_perms</code></p>
<h2 id="_6">æ ¹æ®ç”¨æˆ·å’Œæƒé™è·å–å¯¹è±¡</h2>
<p>å½“æˆ‘ä»¬ç»™å¯¹è±¡èµ‹äºˆæƒé™åï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬éƒ½éœ€è¦æ ¹æ®ç”¨æˆ·å’Œæƒé™æ¥è·å–å¯¹è±¡åˆ—è¡¨ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡<code>get_objects_for_user</code>æ–¹æ³•æ¥å®ç°</p>
<pre class="codehilite"><code>&gt;&gt;&gt; from guardian.shortcuts import get_objects_for_user
&gt;&gt;&gt; user = User.objects.get(username='dev@ops-coffee.cn')
&gt;&gt;&gt; 
&gt;&gt;&gt; get_objects_for_user(user, 'engine.commontask_run')
&lt;QuerySet [&lt;CommonTask: Dev-Coffee-Web-å‘å¸ƒ&gt;, &lt;CommonTask: Qa-Coffee-Web-å‘å¸ƒ&gt;, &lt;CommonTask: dev-ops-coffee-build&gt;]&gt;</code></pre>


<p><code>get_objects_for_user</code>æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç”¨æˆ·å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæƒé™ï¼ŒåŒæ—¶ç¬¬äºŒä¸ªå‚æ•°ä¹Ÿå¯ä»¥å†™æˆåˆ—è¡¨çš„æ–¹å¼ï¼Œè¡¨ç¤º<strong>åŒæ—¶æ»¡è¶³</strong>åˆ—è¡¨ä¸­çš„æƒé™</p>
<pre class="codehilite"><code>&gt;&gt;&gt; get_objects_for_user(user, ['engine.commontask_run', 'engine.commontask_change'])
&lt;QuerySet [&lt;CommonTask: Dev-Coffee-Web-å‘å¸ƒ&gt;]&gt;</code></pre>


<p>å¦‚æœæƒ³è¦ä»…æ»¡è¶³åˆ—è¡¨ä¸­çš„<strong>ä»»æ„ä¸€ä¸ª</strong>æƒé™ï¼Œå¯ä»¥æ·»åŠ ç¬¬ä¸‰ä¸ªå‚æ•°<code>any_perm=True</code></p>
<pre class="codehilite"><code>&gt;&gt;&gt; get_objects_for_user(user, ['engine.commontask_run', 'engine.commontask_change'], any_perm=True)
&lt;QuerySet [&lt;CommonTask: Dev-Coffee-Web-å‘å¸ƒ&gt;, &lt;CommonTask: Qa-Coffee-Web-å‘å¸ƒ&gt;, &lt;CommonTask: dev-ops-coffee-build&gt;]&gt;</code></pre>


<p>ä¸<code>get_objects_for_user</code>ç±»ä¼¼çš„æ–¹æ³•è¿˜æœ‰<code>get_objects_for_group</code>ï¼Œå¯ä»¥æ ¹æ®groupå’Œæƒé™æ¥è·å–å¯¹è±¡åˆ—è¡¨ï¼Œä½¿ç”¨æ–¹æ³•å‚è€ƒ<code>get_objects_for_user</code>å³å¯</p>
<h2 id="_7">è£…é¥°å™¨çš„ä½¿ç”¨</h2>
<p>djangoé»˜è®¤æƒé™æœºåˆ¶å°±æä¾›äº†ä¸€ä¸ª<code>permission_required</code>çš„è£…é¥°å™¨ï¼Œä»¥æ–¹ä¾¿åœ¨viewä¸­å¯¹ç”¨æˆ·æƒé™çš„æ£€æŸ¥ï¼Œåœ¨guardianä¸­å¯¹<code>permission_required</code>è£…é¥°å™¨åšäº†æ‰©å±•ï¼Œä¸ä»…èƒ½å¤Ÿæ£€æŸ¥å…¨å±€æƒé™ï¼Œè¿˜èƒ½å¯¹å¯¹è±¡æƒé™åšæ ¡éªŒ</p>
<p>ä½¿ç”¨æ–¹å¼å…¼å®¹djangoé»˜è®¤çš„<code>permission_required</code>è£…é¥°å™¨</p>
<pre class="codehilite"><code>from guardian.decorators import permission_required

@permission_required('engine.commontask_change')
def commontask_update_view(request):
    return HttpResponse('Hello')</code></pre>


<p>å½“ä»…æœ‰ä¸€ä¸ªæƒé™å‚æ•°æ—¶ï¼Œåˆ™ä¸djangoé»˜è®¤çš„<code>permission_required</code>è£…é¥°å™¨æ— ç–‘ï¼Œè¡¨ç¤ºç”¨æˆ·æ˜¯å¦å…·æœ‰æ•´ä¸ªmodelçš„<code>commontask_change</code>æƒé™</p>
<p>ä½†åœ¨guardiançš„<code>permission_required</code>è£…é¥°å™¨è¿˜æ”¯æŒç¬¬äºŒä¸ªå‚æ•°ï¼Œå‚æ•°ç±»å‹ä¸ºä¸€ä¸ªå…ƒç»„ï¼Œç±»ä¼¼è¿™æ ·<code>(CommonTask, 'id', 'pk')</code>ï¼Œç”¨æ¥æŒ‡å®šå…·ä½“çš„å¯¹è±¡ï¼Œå…¶ä¸­<code>CommonTask</code>ä¸ºmodelï¼Œ<code>id</code>ä¸ºmodelçš„å­—æ®µï¼Œ<code>pk</code>ä¸ºviewä¸­ç”¨æˆ·ä¼ å…¥çš„å…·ä½“å‚æ•°ï¼Œ<code>id</code>ä¸<code>pk</code>ä¸ºå¯¹åº”å…³ç³»ï¼Œå¤§æ¦‚çš„æŸ¥è¯¢é€»è¾‘å°±æ˜¯<code>CommonTask.objects.get(id=pk)</code>ï¼Œåˆ¤æ–­ç”¨æˆ·å¯¹æ­¤å¯¹è±¡æ˜¯å¦æœ‰CommonTaskçš„æƒé™ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹</p>
<pre class="codehilite"><code>@permission_required('engine.commontask_change', (CommonTask, 'id', 'pk'))
def commontask_delete_view(request, pk):
    if request.method == 'POST':
        try:
            _data = CommonTask.objects.get(id=int(pk))
            _data.delete()

            return JsonResponse({'state': 1, 'message': 'åˆ é™¤æˆåŠŸ!'})
        except Exception as e:
            return JsonResponse({'state': 0, 'message': 'Error: ' + str(e)})
    else:
        return JsonResponse({&quot;state&quot;: 0, &quot;message&quot;: &quot;Request method '%s' not supported&quot; % request.method.upper()})</code></pre>


<p><code>permission_required</code>è¿˜æ¥æ”¶ä»¥ä¸‹å‡ ä¸ªå‚æ•°ï¼š<code>login_url</code>ã€<code>redirect_field_name</code>ã€<code>return_403</code>ã€<code>return_404</code>ã€<code>accept_global_perms</code>ï¼Œå…¶ä¸­<code>accept_global_perms</code>å‚æ•°è¡¨ç¤ºæ˜¯å¦æ£€æŸ¥ç”¨æˆ·çš„å…¨å±€æƒé™ï¼Œå¦‚æœæŒ‡å®šäº†ç‰¹å®šå¯¹è±¡ï¼Œä¸”è®¾ç½®äº†<code>accept_global_perms=False</code>åˆ™åªæ£€æŸ¥å¯¹è±¡æƒé™ï¼Œä¸æ£€æŸ¥å…¨å±€æƒé™ï¼Œ<code>accept_global_perms</code>é»˜è®¤ä¸ºFalse</p>
<h2 id="_8">æ¨¡æ¿ä¸­ä½¿ç”¨</h2>
<p>guardianæä¾›äº†æ¨¡æ¿æ ‡ç­¾ï¼Œä»¥æ–¹ä¾¿åœ¨æ¨¡æ¿ä¸­å¯¹ç”¨æˆ·è¿›è¡Œå¯¹è±¡æƒé™çš„æ ¡éªŒï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•</p>
<p>å…ˆåŠ è½½æ ‡ç­¾</p>
<pre class="codehilite"><code>{% load guardian_tags %}</code></pre>


<p>ç„¶åå°±å¯ä»¥ä½¿ç”¨<code>get_obj_perms</code>æ¥è·å–ç”¨æˆ·æˆ–ç»„å…³äºå¯¹è±¡çš„æƒé™åˆ—è¡¨äº†</p>
<pre class="codehilite"><code>{% get_obj_perms user/group for obj as &quot;context_var&quot; %}</code></pre>


<p>ä¸€ä¸ªç®€å•çš„ä¾‹å­å¦‚ä¸‹ï¼Œå¦‚æœå½“å‰ç™»é™†çš„ç”¨æˆ·å¯¹<code>task</code>å¯¹è±¡æœ‰<code>commontask_change</code>æƒé™ï¼Œåˆ™èƒ½çœ‹åˆ°åˆ é™¤æŒ‰é’®</p>
<pre class="codehilite"><code>{% get_obj_perms request.user for task as &quot;task_perms&quot; %}

{% if &quot;commontask_change&quot; in task_perms %}
    &lt;button&gt;åˆ é™¤&lt;/button&gt;
{% endif %}</code></pre>


<p>è‡³æ­¤ï¼Œä½ äº†è§£äº†guardiançš„æ‰€æœ‰åŸºç¡€çŸ¥è¯†ï¼Œå¯ä»¥é€šè¿‡guardianæå®šå‡ ä¹æ‰€æœ‰çš„æƒé™é—®é¢˜äº†ï¼Œå¼€å¯æ„‰å¿«çš„ä½¿ç”¨æ—…ç¨‹å§~</p>

        <div>
          <ul style="display: inline-block;padding: 0;margin: 0 0 0.5em;color: #999;">
            <li style="display: inline-block;margin: 0 1em 0 0;"><a href="/s/django-object-permission-django-guardian-rbac.html">ğŸ“… 2020-05-06</a></li>
<li style="display: inline-block;margin: 0 1em 0 0;"><a href="/tag/Django/">ğŸ·ï¸ Django</a></li><li style="display: inline-block;margin: 0 1em 0 0;"><a href="/tag/å…³äºæŠ€æœ¯/">ğŸ·ï¸ å…³äºæŠ€æœ¯</a></li>          </ul>
        </div>

        <hr>

        <div class="nav-cell">
    <script async src="https://giscus.app/client.js"
            data-repo="ops-coffee/blog" data-repo-id="MDEwOlJlcG9zaXRvcnkxNDY4OTI0MTg="
            data-category="Announcements" data-category-id="DIC_kwDOCMFmgs4CQar3"
            data-mapping="pathname" data-strict="0" data-reactions-enabled="1"
            data-emit-metadata="0" data-input-position="top" data-theme="light"
            data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous">
    </script>
</div>

        <div>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8944257246828217"
         data-ad-slot="6731434232" data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</div>

        <div class="nav-cell">
            <p class="nav-list-title">èƒ½çœ‹åˆ°è¿™é‡Œä¸€å®šæ˜¯çœŸçˆ±ï¼Œè®¢é˜…ä¸€ä¸‹å§</p>
            <img alt="" loading="lazy" src="/static/images/wx.sou1.png" />
        </div>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <div class="copy"> Â© ops-coffee</div>

      <div class="link">
        <a href="/comments.html" title="ç»™æˆ‘ç•™è¨€" target="_blank">ç•™è¨€</a>
        <a href="/friends.html" title="å‹æƒ…é“¾æ¥" target="_blank">å‹é“¾</a>
      </div>
    </div>
  </footer>
  
  <!-- Umami Cloud -->
<script async src="https://umami.ops-coffee.cn/script.js" data-website-id="a4aabd8e-32c7-40e7-a81c-119b909f2d0f"></script>

<!-- Google Adsense -->
<script data-ad-client="ca-pub-8944257246828217" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</body>

</html>