<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="applicable-device" content="pc,mobile">
  <meta name="keywords" content="Django, aggregate, annotate, Echarts, æŸ±çŠ¶å›¾, å‰åç«¯åˆ†ç¦», API, æ•°æ®å¯è§†åŒ–" />
  <meta name="description" content="æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†å¦‚ä½•åœ¨Djangoä¸­ä½¿ç”¨aggregateå’Œannotateå‡½æ•°è¿›è¡Œæ•°æ®èšåˆå’Œåˆ†ç»„ï¼Œå¹¶ç»“åˆEchartsç»˜åˆ¶æŸ±çŠ¶å›¾ï¼Œå±•ç¤ºäº†å¦‚ä½•ä»å‰ç«¯é¡µé¢é€šè¿‡APIè·å–æ•°æ®å¹¶æ¸²æŸ“å›¾è¡¨ï¼Œé€‚ç”¨äºå‰åç«¯åˆ†ç¦»çš„é¡¹ç›®æ¶æ„ã€‚" />
  <link rel="alternate" type="application/rss+xml" title="è¿ç»´å’–å•¡å§" href="https://blog.ops-coffee.com/feed.xml" />
  <link rel="stylesheet" href="https://blog.ops-coffee.com/static/posts/css/ops-coffee.min.css" type="text/css" />

  <!-- Begin SEO tag -->
  <title>Django+Echartsç”»å›¾å®ä¾‹</title>
  <meta property="og:locale" content="zh_CN" />
  <meta property="og:site_name" content="è¿ç»´å’–å•¡å§" />
  <meta property="og:url" content="https://blog.ops-coffee.coms/django-aggregate-annotate-echarts-bar-chart.html" />
  <meta property="og:title" content="Django+Echartsç”»å›¾å®ä¾‹" />
  <meta property="og:description" content="æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†å¦‚ä½•åœ¨Djangoä¸­ä½¿ç”¨aggregateå’Œannotateå‡½æ•°è¿›è¡Œæ•°æ®èšåˆå’Œåˆ†ç»„ï¼Œå¹¶ç»“åˆEchartsç»˜åˆ¶æŸ±çŠ¶å›¾ï¼Œå±•ç¤ºäº†å¦‚ä½•ä»å‰ç«¯é¡µé¢é€šè¿‡APIè·å–æ•°æ®å¹¶æ¸²æŸ“å›¾è¡¨ï¼Œé€‚ç”¨äºå‰åç«¯åˆ†ç¦»çš„é¡¹ç›®æ¶æ„ã€‚" />
  <link rel="canonical" href="https://blog.ops-coffee.coms/django-aggregate-annotate-echarts-bar-chart.html" />

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "Django+Echartsç”»å›¾å®ä¾‹",
    "description": "æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†å¦‚ä½•åœ¨Djangoä¸­ä½¿ç”¨aggregateå’Œannotateå‡½æ•°è¿›è¡Œæ•°æ®èšåˆå’Œåˆ†ç»„ï¼Œå¹¶ç»“åˆEchartsç»˜åˆ¶æŸ±çŠ¶å›¾ï¼Œå±•ç¤ºäº†å¦‚ä½•ä»å‰ç«¯é¡µé¢é€šè¿‡APIè·å–æ•°æ®å¹¶æ¸²æŸ“å›¾è¡¨ï¼Œé€‚ç”¨äºå‰åç«¯åˆ†ç¦»çš„é¡¹ç›®æ¶æ„ã€‚",
    "url": "https://blog.ops-coffee.coms/django-aggregate-annotate-echarts-bar-chart.html",
    "author": {
      "@type": "Person",
      "name": "è¿ç»´å’–å•¡å§"
    },
    "publisher": {
      "@type": "Organization",
      "name": "è¿ç»´å’–å•¡å§",
      "logo": {
        "@type": "ImageObject",
        "url": "https://blog.ops-coffee.com/favicon.ico"
      }
    },
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://blog.ops-coffee.coms/django-aggregate-annotate-echarts-bar-chart.html"
    }
  }
  </script>
  <!-- End SEO tag -->
</head>

<body>
  <div class="top-nav">
    <input type="checkbox" id="menu-toggle" class="menu-toggle" />
    <label for="menu-toggle" class="menu-button">&#9776; 
        <span class="menu-title">è¿ç»´å’–å•¡å§</span>
    </label> 

    <div class="container">
      <nav class="header-site">
        <ul>
          <li><a href="/">é¦–é¡µ</a></li>
            <li class="has-submenu">
              <a href="#" target="_self">è¿ç»´</a>
              <ul class="sub-menu">
                <li><a href="/tag/ç³»ç»Ÿè¿ç»´/" target="_self">ç³»ç»Ÿè¿ç»´</a></li>
                <li><a href="/elk/index.html" target="_self">ELKç³»åˆ—</a></li>
                <li><a href="/ldap/index.html" target="_self">LDAPç³»åˆ—</a></li>
              </ul>
            </li>
            <li class="has-submenu">
              <a href="#" target="_self">å¼€å‘</a>
              <ul class="sub-menu">
                <li><a href="/tag/Devops/" target="_self">DevOps</a></li>
                <li><a href="/tag/Python/" target="_self">Python</a></li>
                <li><a href="/tag/Django/" target="_self">Django</a></li>
                <li><a href="/bpmn/index.html" target="_self">BPMNç³»åˆ—</a></li>
                <li><a href="/webssh/index.html" target="_self">WebSSHç³»åˆ—</a></li>
                <li><a href="/frontend/index.html" target="_self">å‰ç«¯å¼€å‘ç³»åˆ—</a></li>
              </ul>
            </li>
            <li class="has-submenu">
              <a href="#" target="_self">äº§å“</a>
              <ul class="sub-menu">
                <li><a href="/img.html" target="_self">æ‹¼å›¾å·¥å…·</a></li>
              </ul>
            </li>
            <li><a href="/devops/index.html" target="_self">è¿ç»´å¹³å°</a></li>
            <li class="has-submenu">
              <a href="#" target="_self">è¿™æ˜¯ç”Ÿæ´»</a>
              <ul class="sub-menu">
                <li><a href="/life/chronicles.html" target="_self">æ—¶å…‰å°è®°</a></li>
                <li><a href="/life/money.html" target="_self">å‰¯ä¸šèµšé’±</a></li>
                <li><a href="/life/writing.html" target="_self">å†™ä½œç›¸å…³</a></li>
                <li><a href="/tag/è¿™æ˜¯ç”Ÿæ´»/" target="_self">ç”Ÿæ´»éšç¬”</a></li>
              </ul>
            </li>
            <li class="has-submenu">
              <a href="#" target="_self">æˆ¿è½¦æ—…è¡Œ</a>
              <ul class="sub-menu">
                <li><a href="/rv.html" target="_self">æˆ¿è½¦ä½“éªŒ</a></li>
                <li><a href="/travels.html" target="_self">æ—…è¡Œæ¸¸è®°</a></li>
                <li><a href="/travel/china.html" target="_self">æ—…è¡Œåœ°å›¾</a></li>
              </ul>
            </li>
            <li><a href="/tag/index.html" target="_self">æ ‡ç­¾</a></li>
            <li><a href="/archive.html" target="_self">å½’æ¡£</a></li>
          <li class="search"><a href="/search.html" target="_self" aria-label="æœç´¢">ğŸ”</a></li>
        </ul>
      </nav>
    </div>
  </div>

  <header>
    <div class="container">
      <a href="/">
        <div class="name">è¿ç»´å’–å•¡å§</div>
        <div class="slogan">äº«å—æŠ€æœ¯å¸¦æ¥çš„ä¹è¶£ï¼Œä½“éªŒç”Ÿæ´»ç»™äºˆçš„æ„ŸåŠ¨</div>
      </a>
    </div>
  </header>

  <div id="content-wrap">
    <div class="container">
        <h1 id="art-title">Django+Echartsç”»å›¾å®ä¾‹</h1>

        <blockquote>
<p>æ‰€æœ‰æ¼”ç¤ºå‡åŸºäºDjango2.0</p>
</blockquote>
<p>é˜…è¯»æ­¤ç¯‡æ–‡ç« ä½ å¯ä»¥ï¼š</p>
<ul>
<li>äº†è§£Djangoä¸­aggregateå’Œannotateå‡½æ•°çš„ä½¿ç”¨æ–¹æ³•</li>
<li>è·å–ä¸€ä¸ªDjango+Echartsç»˜åˆ¶æŸ±çŠ¶å›¾çš„å®Œæ•´ç¤ºä¾‹</li>
</ul>
<h1 id="_1">éœ€æ±‚è¯´æ˜</h1>
<p>ä¸€å¼ ä¼šè®®è®°å½•è¡¨ï¼Œé‡Œè¾¹æœ‰ä¸€ä¸ªå­—æ®µå­˜æ”¾ä¼šè®®ä¸¾è¡Œçš„åœ°ç‚¹ï¼Œä¾‹å¦‚åŒ—äº¬ã€ä¸Šæµ·ã€æ´›é˜³ç­‰ç­‰ï¼Œéœ€è¦å–ä¸¾è¡Œä¼šè®®æœ€å¤šçš„å‰20ä¸ªåœ°ç‚¹ç»˜åˆ¶æˆæŸ±çŠ¶å›¾å±•ç¤ºï¼Œé¡¹ç›®ä¸ºå‰åç«¯åˆ†ç¦»çš„æ¶æ„</p>
<h2 id="_2">éœ€æ±‚åˆ†æ</h2>
<p>çœ‹äº†éœ€æ±‚ä¸»è¦æœ‰ä¸‰ä¸ªå…³é”®ç‚¹ï¼š</p>
<p>1.å‰åç«¯åˆ†ç¦»ï¼šå‰ç«¯åªè´Ÿè´£é¡µé¢æ¸²æŸ“ï¼Œåç«¯æä¾›APIè´Ÿè´£æ•°æ®è¾“å‡º</p>
<p>2.éœ€è¦ç»˜åˆ¶æˆæŸ±çŠ¶å›¾ï¼šç»˜åˆ¶å›¾è¡¨çš„ç¬¬ä¸‰æ–¹æ’ä»¶æœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬è¿™é‡Œå°±é€‰æ‹©ç™¾åº¦å¼€æºçš„echartsï¼Œç®€å•å¥½ç”¨ä¸”åŠŸèƒ½å¼ºå¤§</p>
<p>3.å–ä¸¾è¡Œä¼šè®®æœ€å¤šçš„å‰20ä¸ªåœ°ç‚¹ï¼šäº†è§£ä¸€ç‚¹SQLçŸ¥è¯†çš„è¯å°±çŸ¥é“éœ€è¦å…ˆè¦å¯¹åœ°ç‚¹å­—æ®µè¿›è¡Œgroup byï¼Œç„¶åorder by descå€’åºï¼Œæœ€ålimitå–å‰20</p>
<p>é‚£ä¹ˆåœ¨Djangoä¸­åº”è¯¥å¦‚ä½•group byï¼Œå¹¶åœ¨group byä¹‹åorder byæ’åºï¼Œæœ€ålimitå‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬ä»‹ç»djangoçš„ä¸¤ä¸ªå‡½æ•°<code>aggregate</code>å’Œ<code>annotate</code></p>
<h3 id="aggregate">aggregate</h3>
<p>aggregateèšåˆå‡½æ•°ï¼Œç”¨äºå¯¹QuerySetæ•´ä¸ªå¯¹è±¡ç»“æœçš„æ±‡æ€»ï¼Œä¾‹å¦‚è·å–å‘˜å·¥æ€»æ•°ï¼ˆCOUNTï¼‰ï¼Œå¹³å‡ï¼ˆAVGï¼‰å¹´é¾„ï¼Œæœ€å¤§ï¼ˆMAXï¼‰å¹´é¾„ï¼Œæœ€å°ï¼ˆMINï¼‰å¹´é¾„ï¼Œé”€å”®æ€»é¢ï¼ˆSUMï¼‰ç­‰ï¼Œè¾“å‡ºçš„ç»“æœæ˜¯ä¸€ä¸ªå­—å…¸</p>
<p>æˆ‘ä»¬æœ‰ä¸€ä¸ªmodelå¦‚ä¸‹ï¼š</p>
<pre class="codehilite"><code>class Employee(models.Model):
    name = models.CharField(max_length=32, verbose_name='å§“å')
    age = models.IntegerField(verbose_name='å¹´é¾„')
    salary = models.DecimalField(max_digits=10, decimal_places=2, verbose_name='è–ªèµ„')</code></pre>


<p>æƒ³è¦è·å–å‘˜å·¥çš„å·¥èµ„æ€»é¢ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™</p>
<pre class="codehilite"><code>&gt;&gt;&gt; from django.db.models import Sum

&gt;&gt;&gt; Employee.objects.aggregate(Sum('salary'))
{'salary__sum': Decimal('5000.00')}</code></pre>


<p>æƒ³è¦åŒæ—¶è·å–å‘˜å·¥çš„å¹³å‡å¹´é¾„ã€æœ€å¤§å¹´é¾„å’Œæœ€å°å¹´é¾„ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™</p>
<pre class="codehilite"><code>&gt;&gt;&gt; from django.db.models import Avg, Max, Min

&gt;&gt;&gt; Employee.objects.aggregate(Avg('age'), Max('age'), Min('age'))
{'age__avg': 23.333333333333332, 'age__max': 30, 'age__min': 18}</code></pre>


<h3 id="annotate">annotate</h3>
<p>annotateå‡½æ•°åŒºåˆ«äºaggregateå‡½æ•°çš„ä¸€ä¸ªæœ€é‡è¦çš„åœ°æ–¹æ˜¯annotateå‡½æ•°<strong>è¾“å‡ºçš„ç»“æœæ˜¯ä¸€ä¸ªQuerySetå¯¹è±¡</strong>ï¼Œè¿™ä¸ªéå¸¸é‡è¦ï¼Œaggregateå‡½æ•°æœ€åè¾“å‡ºçš„ç»“æœæ˜¯ä¸ªå­—å…¸ï¼Œä¹Ÿå°±ä¸èƒ½å†åœ¨å­—å…¸çš„åŸºç¡€ä¸Šè¿›è¡ŒQuerySetæ“ä½œäº†ï¼Œè€Œannotateå‡½æ•°æ‰§è¡Œå®Œæˆåè¾“å‡ºQuerySetå¯¹è±¡å¯ä»¥ç»§ç»­è°ƒç”¨Djangoå†…ç½®çš„filterã€order_byç­‰å‡½æ•°æ¥å®Œæˆæ›´åŠ å¤æ‚çš„æŸ¥è¯¢è®¡ç®—æ“ä½œ</p>
<p>ç”¨åˆ°annotateå‡½æ•°çš„é€»è¾‘å¾€å¾€æ¯”è¾ƒå¤æ‚ï¼ŒDjangoéå¸¸äººæ€§åŒ–çš„æä¾›äº†queryæ–¹æ³•ï¼Œæ–¹ä¾¿æŸ¥çœ‹annotateç”Ÿæˆçš„SQLè¯­å¥å¸®åŠ©æˆ‘ä»¬ç¡®å®šæ‰§è¡Œè¿‡ç¨‹</p>
<p>ä»¥ä¸Šè¾¹çš„å®é™…éœ€æ±‚ä¸ºä¾‹ï¼Œmodelå¦‚ä¸‹ï¼š</p>
<pre class="codehilite"><code>class EventInfo(models.Model):
    event_location = models.CharField(max_length=30)

    class Meta:
        db_table = &quot;app_event_info&quot;</code></pre>


<p>æˆ‘ä»¬éœ€è¦å…ˆå¯¹åœ°ç‚¹event_locationè¿›è¡Œgroup byï¼š</p>
<pre class="codehilite"><code>&gt;&gt;&gt; _t = EventInfo.objects.values_list('event_location').annotate(Count('id'))

# values_listå¯ä»¥è·å–evnet_locationçš„å…ƒç»„åˆ—è¡¨ã€‚
# values_listæ–¹æ³•åŠ ä¸ªå‚æ•°flat=Trueå¯ä»¥è·å–event_locationçš„å€¼åˆ—è¡¨ã€‚</code></pre>


<p>group byä¹‹åæˆ‘ä»¬å°±éœ€è¦order byæ’åºäº†ï¼Œå¦‚æœæˆ‘ä»¬ä¸çŸ¥é“order byçš„å­—æ®µï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡queryå…ˆæŸ¥çœ‹group byç”Ÿæˆçš„SQLè¯­å¥</p>
<pre class="codehilite"><code>&gt;&gt;&gt; print(_t.query)
SELECT &quot;app_event_info&quot;.&quot;event_location&quot;, COUNT(&quot;app_event_info&quot;.&quot;id&quot;) AS &quot;id__count&quot; FROM &quot;app_event_info&quot; GROUP BY &quot;app_event_info&quot;.&quot;event_location&quot;</code></pre>


<p>è¿™ä¸ªæ—¶å€™å¯ä»¥çœ‹åˆ°å®é™…ä¸Šè¾“å‡ºçš„ç»“æœæœ‰ä¸€ä¸ªå«<code>id__count</code>çš„å­—æ®µè¡¨ç¤ºåœ°ç‚¹çš„æ€»æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ¥ç€å¯¹åœ°ç‚¹æ€»æ•°è¿›è¡Œæ’åºäº†,å› ä¸ºæ˜¯è¦å€’å™ï¼Œéœ€è¦åœ¨å­—æ®µå<code>id__count</code>å‰è¾¹åŠ ä¸Š<code>-</code>å·æ¥è¡¨ç¤ºå€’åº</p>
<pre class="codehilite"><code>&gt;&gt;&gt; _x = _t.order_by('-id__count')
&gt;&gt;&gt;
&gt;&gt;&gt; print(_x.query)
SELECT &quot;app_event_info&quot;.&quot;event_location&quot;, COUNT(&quot;app_event_info&quot;.&quot;id&quot;) AS &quot;id__count&quot; FROM &quot;app_event_info&quot; GROUP BY &quot;app_event_info&quot;.&quot;event_location&quot; ORDER BY &quot;id__count&quot; DESC</code></pre>


<p>æœ€ålimitå–å‰äºŒåï¼ŒDjangoä¸­limitå¯ä»¥ç›´æ¥é€šè¿‡QuerySetç»“æœååŠ pythonçš„æ•°ç»„åˆ‡ç‰‡è¯­æ³•æ¥å®ç°ï¼Œå°±åƒ[0:20]ï¼ˆå…¶ä¸­0å¯ä»¥çœç•¥ï¼‰ç›¸å½“äºlimit 20ä¸€æ ·ï¼Œ[10:20]æ„æ€ä¸ºå–ç¬¬10åˆ°ç¬¬20æ¡æ•°æ®</p>
<pre class="codehilite"><code>&gt;&gt;&gt; _y = _x[:20]
&gt;&gt;&gt;
&gt;&gt;&gt; print(_y.query)
SELECT &quot;app_event_info&quot;.&quot;event_location&quot;, COUNT(&quot;app_event_info&quot;.&quot;id&quot;) AS &quot;id__count&quot; FROM &quot;app_event_info&quot; GROUP BY &quot;app_event_info&quot;.&quot;event_location&quot; ORDER BY &quot;id__count&quot; DESC LIMIT 20</code></pre>


<p>ä¸Šè¾¹çš„æ¯ä¸€æ­¥æˆ‘ä»¬éƒ½é€šè¿‡queryæ‰“å°äº†SQLï¼Œç¡®å®šæ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœäº†ã€‚éœ€æ±‚åˆ†ææ¸…æ¥šï¼Œæ‰€æœ‰çš„å…³é”®ç‚¹æˆ‘ä»¬ä¹Ÿéƒ½çŸ¥é“æ€ä¹ˆå¤„ç†äº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å®ç°å°±æ°´åˆ°æ¸ æˆäº†ã€‚</p>
<h1 id="_3">å®ç°ä»£ç </h1>
<p>URLå¦‚ä¸‹ï¼š</p>
<pre class="codehilite"><code>from django.urls import path
from django.views.generic.base import TemplateView

from .views import echarts_data
urlpatterns = [
    path('echarts/', TemplateView.as_view(template_name='echarts.html'), name='echarts-url'),

    path('api/echarts/', echarts_data, name='api-echarts')
]</code></pre>


<p>å› ä¸ºæ˜¯å‰åç«¯åˆ†ç¦»çš„ï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œç”¨äº†ä¸¤ä¸ªurl<code>echarts</code>å’Œ<code>api/echarts</code></p>
<p><code>echarts</code>ä¸ºå‰å°è®¿é—®åœ°å€ï¼Œå¯¹åº”ä¸‹è¾¹çš„htmlä»£ç ï¼Œé€šè¿‡ajaxæ–¹å¼è°ƒç”¨åç«¯æ¥å£ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥ç”¨äº†TemplateViewï¼Œä¸éœ€è¦å†å†™é¢å¤–çš„viewä»£ç </p>
<p><code>api/echarts</code>ä¸ºåç«¯APIçš„åœ°å€ï¼Œå¯¹åº”ä¸‹è¾¹çš„viewä»£ç ï¼Œä¸ºå‰å°æä¾›æ•°æ®æ¥å£</p>
<p>å‰ç«¯HTMLï¼š</p>
<pre class="codehilite"><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;meta charset=&quot;utf-8&quot;&gt;
  &lt;title&gt;ops-coffee&lt;/title&gt;
  &lt;!-- å¼•å…¥ echarts.js --&gt;
  &lt;script src=&quot;/static/js/jquery.min.js&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;/static/js/echarts/echarts.common.min.js&quot;&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;!-- ä¸ºEChartså‡†å¤‡ä¸€ä¸ªå…·å¤‡å¤§å°ï¼ˆå®½é«˜ï¼‰çš„Dom --&gt;
  &lt;div id=&quot;main&quot; style=&quot;height:400px;&quot;&gt;&lt;/div&gt;
  &lt;script type=&quot;text/javascript&quot;&gt;
    // åŸºäºå‡†å¤‡å¥½çš„domï¼Œåˆå§‹åŒ–echartså®ä¾‹
    var myChart = echarts.init(document.getElementById('main'));


    $.ajax({
      type: &quot;get&quot;,
      url: &quot;/api/echarts&quot;,
      dataType: &quot;json&quot;,
      success: function (data) {

        // æŒ‡å®šå›¾è¡¨çš„é…ç½®é¡¹å’Œæ•°æ®
        var option = {
          title: {
            left: 'center',
            text: 'ops-coffee è¿ç»´å’–å•¡å§'
          },
          tooltip: {},
          xAxis: {
              data: data.key
          },
          yAxis: {},
          series: [{
            name: 'æ•°é‡',
            type: 'bar',
            data: data.value
          }]
        };

        // ä½¿ç”¨åˆšæŒ‡å®šçš„é…ç½®é¡¹å’Œæ•°æ®æ˜¾ç¤ºå›¾è¡¨ã€‚
        myChart.setOption(option);
      },
      error: function () {
        alert('Error: ajax è¯·æ±‚å‡ºé”™ï¼')
      }
    });
  &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>


<p>å®ä¾‹æ¯”è¾ƒç®€å•ï¼ŒæŠ„çš„echartså®˜æ–¹ç¤ºä¾‹ï¼Œè¿™é‡Œä¼šçœ‹åˆ°echartsæ¸²æŸ“å›¾å½¢å®é™…ä¸Šåªéœ€è¦Xè½´å’ŒYè½´ä¸¤ä¸ªæ•°æ®å˜é‡ï¼Œä¸”éƒ½ä¸ºliståˆ—è¡¨ç±»å‹</p>
<p>åç«¯VIEWï¼š</p>
<pre class="codehilite"><code>from django.http import JsonResponse
from django.db.models import Count

from .models import EventInfo

def echarts_data(request):
    _x = EventInfo.objects.values_list('event_location').annotate(Count('id')).order_by('-id__count')[:20]

    jsondata = {
        &quot;key&quot;: [i[0] for i in _x],
        &quot;value&quot;: [i[1] for i in _x]
    }

    return JsonResponse(jsondata)</code></pre>


<p>æœ€æ ¸å¿ƒçš„é‚£è¡Œgroup by + order by + limitçš„ORMæ‹¼æ¥ï¼Œæˆ‘ä»¬ä¸Šè¾¹å·²ç»è¯¦ç»†çš„ä»‹ç»è¿‡äº†ï¼Œé‚£ä¹ˆè¿™é‡Œåªéœ€è¦åœ¨è¾“å‡ºçš„ç»“æœä¸­å•ç‹¬çš„æŠŠåŸå¸‚è·Ÿæ•°é‡è½¬æˆä¸¤ä¸ªåˆ—è¡¨å¯¹åº”echartsé‡Œè¾¹éœ€è¦çš„Xè½´Yè½´æ•°æ®å°±å¯ä»¥äº†</p>
<p>æœ€åè®¿é—®url:https://ops-coffee.com/echarts å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æœ</p>
<p><img alt="" loading="lazy" src="/static/images/2018/1126.01.png" /></p>
<p>æ•´ä¸ªDemoç¤ºä¾‹ä»‹ç»å®Œæˆã€‚</p>

        <div>
          <ul class="article-meta">
            <li><a href="/s/django-aggregate-annotate-echarts-bar-chart.html">ğŸ“… 2018-11-26</a></li>
<li><a href="/tag/Django/">ğŸ·ï¸ Django</a></li><li><a href="/tag/å…³äºæŠ€æœ¯/">ğŸ·ï¸ å…³äºæŠ€æœ¯</a></li>          </ul>
        </div>

        <hr>

        <div class="pagination">
            <a href="https://blog.ops-coffee.com/s/django-signals-for-notification-in-ticket-system.html" class="pagination-item prev-page">
                <span class="pagination-arrow">â†</span>
                <span class="pagination-text">ä¸Šä¸€ç¯‡ï¼š<br>Djangoä½¿ç”¨Signalsç›‘æµ‹modelå­—æ®µå˜åŒ–å‘é€é€šçŸ¥</span>
            </a>
            <a href="https://blog.ops-coffee.com/s/django-security-password-table-database-rsa.html" class="pagination-item next-page">
                <span class="pagination-text">ä¸‹ä¸€ç¯‡ï¼š<br>Djangoå¼€å‘å¯†ç ç®¡ç†è¡¨å®ä¾‹ã€é™„æºç ã€‘</span>
                <span class="pagination-arrow">â†’</span>
            </a>
        </div>

        <div>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8944257246828217"
         data-ad-slot="6731434232" data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</div>

<div class="nav-cell">
    <script async src="https://giscus.app/client.js"
            data-repo="ops-coffee/blog" data-repo-id="MDEwOlJlcG9zaXRvcnkxNDY4OTI0MTg="
            data-category="Announcements" data-category-id="DIC_kwDOCMFmgs4CQar3"
            data-mapping="pathname" data-strict="0" data-reactions-enabled="1"
            data-emit-metadata="0" data-input-position="top" data-theme="light"
            data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous">
    </script>
</div>

        <div class="nav-cell">
    <p class="nav-list-title">èƒ½çœ‹åˆ°è¿™é‡Œä¸€å®šæ˜¯çœŸçˆ±ï¼Œè®¢é˜…ä¸€ä¸‹å§</p>
    <img alt="" loading="lazy" src="/static/images/wx.sou1.png" />
</div>

    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <div class="copy"> Â© ops-coffee</div>

      <div class="link">
        <a href="/comments.html" title="ç»™æˆ‘ç•™è¨€" target="_blank">ç•™è¨€</a>
        <a href="/friends.html" title="å‹æƒ…é“¾æ¥" target="_blank">å‹é“¾</a>
      </div>
    </div>
  </footer>
  
  <!-- Umami -->
<script defer src="https://umami.ops-coffee.cn/script.js" data-website-id="248e61f0-c324-444e-a56d-bf97ee44a8fc"></script>

<!-- Google Adsense -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8944257246828217" crossorigin="anonymous"></script>
</body>
</html>