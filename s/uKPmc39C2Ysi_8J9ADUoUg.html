<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="applicable-device" content="pc,mobile">
  <meta name="keywords" content="Django JSONField, Django 3.1æ›´æ–°, JSONFieldä½¿ç”¨æ–¹æ³•, æ•°æ®åº“JSONæ”¯æŒ, JSONFieldæŸ¥è¯¢, MariaDB JSONæ”¯æŒ, MySQL JSONæ”¯æŒ, PostgreSQL JSONæ”¯æŒ, SQLite JSONæ”¯æŒ, Oracle JSONæ”¯æŒ, Django models, Django forms, JSONFieldæ•°æ®åº“æŸ¥è¯¢, JSONField NULLå¤„ç†, Django JSONFieldç¤ºä¾‹, JSONFieldæ•°æ®åº“å…¼å®¹æ€§, JSONFieldæŸ¥è¯¢æ–¹æ³•, Django JSONFieldé”™è¯¯å¤„ç†, SQL NULL vs JSON NULL" />
  <meta name="description" content="æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†Djangoæœ€æ–°ç‰ˆv3.1ä¸­æ–°å¢çš„JSONFieldåŠŸèƒ½ï¼ŒåŒ…æ‹¬å…¶ä½¿ç”¨æ–¹æ³•ã€æ•°æ®åº“æ”¯æŒæƒ…å†µã€æŸ¥è¯¢æŠ€å·§ä»¥åŠSQLiteä¸æ”¯æŒJSONFieldsæ—¶çš„è§£å†³æ–¹æ¡ˆã€‚" />
  <link rel="alternate" type="application/rss+xml" title="è¿ç»´å’–å•¡å§" href="https://blog.ops-coffee.cn/feed.xml" />
  <link rel="stylesheet" href="https://blog.ops-coffee.cn/static/posts/css/ops-coffee.min.css" type="text/css" />

  <!-- Begin SEO tag -->
  <title>Django ORMä¸­åŸç”ŸJSONFieldçš„ä½¿ç”¨æ–¹æ³•</title>
  <meta property="og:locale" content="zh_CN" />
  <meta property="og:site_name" content="è¿ç»´å’–å•¡å§" />
  <meta property="og:url" content="https://blog.ops-coffee.cn" />
  <meta property="og:title" content="Django ORMä¸­åŸç”ŸJSONFieldçš„ä½¿ç”¨æ–¹æ³•" />
  <meta property="og:description" content="æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†Djangoæœ€æ–°ç‰ˆv3.1ä¸­æ–°å¢çš„JSONFieldåŠŸèƒ½ï¼ŒåŒ…æ‹¬å…¶ä½¿ç”¨æ–¹æ³•ã€æ•°æ®åº“æ”¯æŒæƒ…å†µã€æŸ¥è¯¢æŠ€å·§ä»¥åŠSQLiteä¸æ”¯æŒJSONFieldsæ—¶çš„è§£å†³æ–¹æ¡ˆã€‚" />
  <link rel="canonical" href="https://blog.ops-coffee.cn" />
  <!-- End SEO tag -->
</head>

<body>
  <div class="header">
    <div class="menu-button">&#9776; 
        <span class="menu-title">è¿ç»´å’–å•¡å§</span>
    </div> 

    <div class="container no-sidebar">
      <nav class="header-site">
        <ul>
          <li><a href="/">é¦–é¡µ</a></li>
            <li class="has-submenu">
              <a href="#" target="_self">è¿ç»´</a>
              <ul class="sub-menu">
                <li><a href="/tag/ç³»ç»Ÿè¿ç»´/" target="_self">ç³»ç»Ÿè¿ç»´</a></li>
                <li><a href="/elk/index.html" target="_self">ELKç³»åˆ—</a></li>
                <li><a href="/ldap/index.html" target="_self">LDAPç³»åˆ—</a></li>
              </ul>
            </li>
            <li class="has-submenu">
              <a href="#" target="_self">å¼€å‘</a>
              <ul class="sub-menu">
                <li><a href="/tag/Devops/" target="_self">DevOps</a></li>
                <li><a href="/tag/Python/" target="_self">Python</a></li>
                <li><a href="/tag/Django/" target="_self">Django</a></li>
                <li><a href="/bpmn/index.html" target="_self">BPMNç³»åˆ—</a></li>
                <li><a href="/webssh/index.html" target="_self">WebSSHç³»åˆ—</a></li>
                <li><a href="/frontend/index.html" target="_self">å‰ç«¯å¼€å‘ç³»åˆ—</a></li>
              </ul>
            </li>
            <li><a href="/devops/index.html" target="_self">è¿ç»´å¹³å°</a></li>
            <li><a href="/tag/è¿™æ˜¯ç”Ÿæ´»/" target="_self">è¿™æ˜¯ç”Ÿæ´»</a></li>
            <li class="has-submenu">
              <a href="#" target="_self">æˆ¿è½¦æ—…è¡Œ</a>
              <ul class="sub-menu">
                <li><a href="/rv.html" target="_self">æˆ¿è½¦ä½“éªŒ</a></li>
                <li><a href="/travels.html" target="_self">æ—…è¡Œæ¸¸è®°</a></li>
                <li><a href="/travel/china.html" target="_self">æ—…è¡Œåœ°å›¾</a></li>
              </ul>
            </li>
            <li><a href="/tag/index.html" target="_self">æ ‡ç­¾</a></li>
            <li><a href="/archive.html" target="_self">å½’æ¡£</a></li>
          <li class="search"><a href="/search.html" target="_self">ğŸ”</a></li>
        </ul>
      </nav>
    </div>
  </div>

  <header>
    <div class="container no-sidebar">
      <a href="/">
        <div class="name">è¿ç»´å’–å•¡å§</div>
        <div class="slogan">äº«å—æŠ€æœ¯å¸¦æ¥çš„ä¹è¶£ï¼Œä½“éªŒç”Ÿæ´»ç»™äºˆçš„æ„ŸåŠ¨</div>
      </a>
    </div>
  </header>

  <div id="content-wrap">
    <div class="container no-sidebar">
        <h1 id="art-title">Django ORMä¸­åŸç”ŸJSONFieldçš„ä½¿ç”¨æ–¹æ³•</h1>

        <blockquote>
<p>å¸¦ä½ å°é²œDjangoæœ€æ–°ç‰ˆé‡è¦æ›´æ–°JSONFieldçš„ä½¿ç”¨</p>
</blockquote>
<p>Djangoæœ€æ–°ç‰ˆv3.1çš„ä¸»è¦æ›´æ–°ä¹‹ä¸€ä¾¿æ˜¯å®Œå–„äº†å¯¹JSONæ•°æ®å­˜å‚¨çš„æ”¯æŒï¼Œæ–°å¢<code>models.JSONField</code>å’Œ<code>forms.JSONField</code>ï¼Œå¯åœ¨æ‰€æœ‰å—æ”¯æŒçš„æ•°æ®åº“åç«¯ä¸Šä½¿ç”¨</p>
<p>ç›®å‰æ”¯æŒçš„æ•°æ®åº“ä»¥åŠå¯¹åº”ç‰ˆæœ¬ä¸»è¦æœ‰<code>MariaDB 10.2.7+</code>,<code>MySQL 5.7.8+</code>,<code>Oracle</code>,<code>PostgreSQL</code>å’Œ<code>SQLite 3.9.0+</code>ï¼Œä½†ä¸ªåˆ«Djangoçš„æŸ¥è¯¢æ–¹æ³•å¯èƒ½ä¸éƒ¨åˆ†æ•°æ®åº“ä¸å…¼å®¹ï¼Œä¾‹å¦‚<code>contains</code>å’Œ<code>contained_by</code>å°±ä¸æ”¯æŒOracleå’ŒSQLiteæ•°æ®åº“</p>
<h2 id="jsonfield">JSONFieldä½¿ç”¨</h2>
<pre class="codehilite"><code>from django.db import models

class Hero(models.Model):
    name = models.CharField(max_length=200)
    data = models.JSONField(null=True)

    def __str__(self):
        return self.name</code></pre>


<p>é€šè¿‡<code>models.JSONField</code>å¯æŒ‡å®šæ­¤å­—æ®µä¸ºå­˜å‚¨ç±»å‹ä¸ºJSONæ ¼å¼ã€‚<code>null=True</code>è¡¨ç¤ºæ­¤å­—æ®µå¯ä»¥ä¸ºç©ºï¼Œè¿™ä¸ªNULLæŒ‡çš„æ˜¯SQL NULLï¼Œå¦‚æœæƒ³å­˜å‚¨ä¸ºJsonNULLï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>Value('null')</code>æ¥å®ç°</p>
<pre class="codehilite"><code>Hero.objects.create(name='coffee', data=Value('null'))</code></pre>


<p>SQL NULLä¸JsonNULLçš„åŒºåˆ«ä¸»è¦åœ¨<code>is_null</code>çš„æŸ¥è¯¢ä¸Šä¸åŒï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹è¿™ä¸ªç¤ºä¾‹æ¥ç†è§£ä¸‹</p>
<pre class="codehilite"><code>&gt;&gt;&gt; from django.db.models import Value
&gt;&gt;&gt;
&gt;&gt;&gt; Hero.objects.create(name='ops')
&lt;Hero: ops&gt;
&gt;&gt;&gt; Hero.objects.create(name='coffee', data=Value('null'))
&lt;Hero: coffee&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Hero.objects.filter(data=None)
&lt;QuerySet [&lt;Hero: coffee&gt;]&gt;
&gt;&gt;&gt; Hero.objects.filter(data=Value('null'))
&lt;QuerySet [&lt;Hero: coffee&gt;]&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Hero.objects.get(name='ops').data
&gt;&gt;&gt; Hero.objects.get(name='coffee').data
&gt;&gt;&gt;
&gt;&gt;&gt; Hero.objects.filter(data__isnull=True)
&lt;QuerySet [&lt;Hero: ops&gt;]&gt;
&gt;&gt;&gt; Hero.objects.filter(data__isnull=False)
&lt;QuerySet [&lt;Hero: coffee&gt;]&gt;</code></pre>


<h2 id="jsonfield_1">JSONFieldæŸ¥è¯¢</h2>
<p>Jsonå­—æ®µçš„æŸ¥è¯¢æ–¹æ³•ï¼Œé€šè¿‡ä¸‹è¾¹è¿™ä¸ªç¤ºä¾‹æ¼”ç¤ºè¯´æ˜</p>
<pre class="codehilite"><code>&gt;&gt;&gt; Hero.objects.create(name='ops-coffee.cn', data={
...     'age': 12,
...     'group': {
...         'name': 'ow1',
...         'skill': [
...             {'name': 'swim', 'rank': 'A+'},
...             {'name': 'shot', 'rank': None}
...         ]
...     }
... })
&lt;Hero: ops-coffee.cn&gt;
&gt;&gt;&gt; Hero.objects.create(name='ops-coffee', data={'age':16})
&lt;Hero: ops-coffee&gt;</code></pre>


<p>å½“æƒ³è¦æŸ¥è¯¢<code>age</code>ä¸º<code>12</code>çš„æ•°æ®æ—¶å¯ä»¥è¿™æ ·æŸ¥è¯¢</p>
<pre class="codehilite"><code>&gt;&gt;&gt; Hero.objects.filter(data__age=12)
&lt;QuerySet [&lt;Hero: ops-coffee.cn&gt;]&gt;</code></pre>


<p>å½“æƒ³è¦æŸ¥è¯¢<code>group</code>çš„<code>name</code>ä¸º<code>ow1</code>çš„æ•°æ®æ—¶å¯ä»¥è¿™æ ·æŸ¥è¯¢</p>
<pre class="codehilite"><code>&gt;&gt;&gt; Hero.objects.filter(data__group__name='ow1')
&lt;QuerySet [&lt;Hero: ops-coffee.cn&gt;]&gt;</code></pre>


<p>å½“æƒ³è¦æŸ¥è¯¢<code>group</code>ä¸‹<code>skill</code>ä¸­ç¬¬ä¸€ä¸ªæ•°æ®çš„<code>name</code>å€¼ä¸º<code>swim</code>çš„æ•°æ®æ—¶å¯ä»¥è¿™æ ·æŸ¥è¯¢</p>
<pre class="codehilite"><code>&gt;&gt;&gt; Hero.objects.filter(data__group__skill__0__name='swim')
&lt;QuerySet [&lt;Hero: ops-coffee.cn&gt;]&gt;</code></pre>


<p>å½“æƒ³è¦æŸ¥æ‰¾åŒ…å«<code>group</code>é”®çš„æ‰€æœ‰æ•°æ®æ—¶ï¼Œå¯ä»¥é€šè¿‡<code>has_key</code>æ¥å®ç°</p>
<pre class="codehilite"><code>&gt;&gt;&gt; Hero.objects.filter(data__has_key='group')
&lt;QuerySet [&lt;Hero: ops-coffee.cn&gt;]&gt;</code></pre>


<p>å½“æƒ³è¦æŸ¥æ‰¾åŒæ—¶åŒ…å«<code>group</code>é”®å’Œ<code>age</code>é”®çš„æ‰€æœ‰æ•°æ®æ—¶ï¼Œå¯ä»¥é€šè¿‡<code>has_keys</code>æ¥å®ç°</p>
<pre class="codehilite"><code>&gt;&gt;&gt; Hero.objects.filter(data__has_keys=['group','age'])
&lt;QuerySet [&lt;Hero: ops-coffee.cn&gt;]&gt;</code></pre>


<p>å½“æƒ³è¦æŸ¥æ‰¾åŒ…å«<code>group</code>é”®æˆ–è€…<code>age</code>é”®çš„æ‰€æœ‰æ•°æ®æ—¶ï¼Œå¯ä»¥é€šè¿‡<code>has_any_keys</code>æ¥å®ç°</p>
<pre class="codehilite"><code>&gt;&gt;&gt; Hero.objects.filter(data__has_any_keys=['group','age'])
&lt;QuerySet [&lt;Hero: ops-coffee.cn&gt;, &lt;Hero: ops-coffee&gt;]&gt;</code></pre>


<p>å½“æƒ³ä¸€æ¬¡æ€§æŸ¥æ‰¾åŒ…å«<code>age</code>ä¸º<code>12</code>ä¸”<code>group</code>çš„<code>name</code>ä¸º<code>ow1</code>çš„æ•°æ®æ—¶ï¼Œå¯ä»¥é€šè¿‡<code>contains</code>æ¥å®ç°</p>
<pre class="codehilite"><code>&gt;&gt;&gt; Hero.objects.filter(data__contains={'age':12,'group': {'name': 'ow1'}})
&lt;QuerySet [&lt;Hero: ops-coffee.cn&gt;]&gt;</code></pre>


<p>JSONFieldé™¤äº†æ”¯æŒä»¥ä¸ŠæŸ¥è¯¢æ–¹å¼å¤–ï¼Œå¯¹äºORMæ‰€æä¾›çš„å¤§éƒ¨åˆ†å…¶ä»–æŸ¥è¯¢æ–¹å¼åŒæ ·æ”¯æŒï¼Œä¾‹å¦‚<code>icontains</code>,<code>endswith</code>,<code>iendswith</code>,<code>iexact</code>,<code>regex</code>,<code>iregex</code>, <code>startswith</code>,<code>istartswith</code>,<code>lt</code>,<code>lte</code>,<code>gt</code>,<code>gte</code>ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿæ˜¯éå¸¸æ–¹ä¾¿</p>
<pre class="codehilite"><code>&gt;&gt;&gt; Hero.objects.filter(data__age__lte=12)
&lt;QuerySet [&lt;Hero: ops-coffee.cn&gt;]&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Hero.objects.filter(data__group__name__startswith='ow')
&lt;QuerySet [&lt;Hero: ops-coffee.cn&gt;]&gt;</code></pre>


<h2 id="sqlite3">SQLite3æŠ¥é”™å¤„ç†</h2>
<p>æˆ‘åœ¨Windowsä¸‹å¼€å‘æµ‹è¯•æ—¶ï¼Œå½“<code>migrate</code>ç”Ÿæˆè¡¨çš„æ—¶å€™é‡åˆ°äº†å¦‚ä¸‹æŠ¥é”™ï¼Œè¿™ä¸»è¦æ˜¯å› ä¸ºSQLiteä¸æ”¯æŒJSONFieldså¯¼è‡´çš„</p>
<pre class="codehilite"><code>SQLite does not support JSONFields</code></pre>


<p>è§£å†³æ–¹æ³•ä¸ºï¼š</p>
<p>å…ˆå»sqliteå®˜ç½‘ä¸‹è½½å¯¹åº”çš„DLLè½¯ä»¶åŒ…<code>https://www.sqlite.org/download.html</code>ï¼Œç„¶åæ›¿æ¢æ‰å½“å‰ä½¿ç”¨çš„<code>sqlite3.dllæ–‡ä»¶</code>ã€‚ä¾‹å¦‚æˆ‘çš„windowsä¸º64ä½ç‰ˆæœ¬ï¼Œæ‰€ä»¥ä¸‹è½½äº†<code>sqlite-dll-win64-x64-3320300.zip</code>è¿™ä¸ªè½¯ä»¶åŒ…ï¼Œæœ¬åœ°pythonçš„å®‰è£…è·¯å¾„ä¸º<code>C:\python36</code>ï¼Œç›´æ¥å°†<code>C:\python36\DLLs\sqlite3.dll</code>ç”¨ä¸‹è½½çš„è½¯ä»¶åŒ…é‡Œçš„<code>sqlite3.dll</code>æ–‡ä»¶æ›¿æ¢ï¼Œç„¶åå†æ¬¡è¿è¡Œ<code>migrate</code>é¡ºåˆ©åˆ›å»ºäº†æ•°æ®åº“è¡¨</p>

        <div>
          <ul style="display: inline-block;padding: 0;margin: 0 0 0.5em;color: #999;">
            <li style="display: inline-block;margin: 0 1em 0 0;"><a href="/s/uKPmc39C2Ysi_8J9ADUoUg.html">ğŸ“… 2020-08-07</a></li>
<li style="display: inline-block;margin: 0 1em 0 0;"><a href="/tag/Django/">ğŸ·ï¸ Django</a></li><li style="display: inline-block;margin: 0 1em 0 0;"><a href="/tag/å…³äºæŠ€æœ¯/">ğŸ·ï¸ å…³äºæŠ€æœ¯</a></li>          </ul>
        </div>

        <hr>

        <div class="nav-cell">
            <script async src="https://giscus.app/client.js"
                    data-repo="ops-coffee/blog" data-repo-id="MDEwOlJlcG9zaXRvcnkxNDY4OTI0MTg="
                    data-category="Announcements" data-category-id="DIC_kwDOCMFmgs4CQar3"
                    data-mapping="pathname" data-strict="0" data-reactions-enabled="1"
                    data-emit-metadata="0" data-input-position="top" data-theme="light"
                    data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous">
            </script>
        </div>

        <div>
            <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8944257246828217"
                 data-ad-slot="6731434232" data-ad-format="auto" data-full-width-responsive="true"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>

        <div class="nav-cell">
            <p class="nav-list-title">èƒ½çœ‹åˆ°è¿™é‡Œä¸€å®šæ˜¯çœŸçˆ±ï¼Œè®¢é˜…ä¸€ä¸‹å§</p>
            <img alt="" loading="lazy" src="/static/images/wx.sou1.png" />
        </div>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <div class="copy"> Â© ops-coffee</div>

      <div class="link">
        <a href="/comments.html" title="ç»™æˆ‘ç•™è¨€" target="_blank">ç•™è¨€</a>
        <a href="/friends.html" title="å‹æƒ…é“¾æ¥" target="_blank">å‹é“¾</a>
      </div>
    </div>
  </footer>
  
  <!-- Umami Cloud -->
<script async src="https://umami.ops-coffee.cn/script.js" data-website-id="a4aabd8e-32c7-40e7-a81c-119b909f2d0f"></script>

<!-- Google Adsense -->
<script data-ad-client="ca-pub-8944257246828217" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</body>

</html>