<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="applicable-device" content="pc,mobile">
  <meta name="keywords" content="Just-For-Fun,这是生活,关于技术" />
  <meta name="description" content="效率提升杠杆的，在线问卷提升数据收集效率，企业微信通知提升数据校验效率" />
  <link rel="alternate" type="application/rss+xml" title="运维咖啡吧" href="https://blog.ops-coffee.cn/feed.xml" />
  <link rel="stylesheet" href="https://blog.ops-coffee.cn/static/posts/css/ops-coffee.min.css" type="text/css" />

  <!-- Begin SEO tag -->
  <title>疫情在家帮老婆提升下工作效率</title>
  <meta property="og:locale" content="zh_CN" />
  <meta property="og:site_name" content="运维咖啡吧" />
  <meta property="og:url" content="https://blog.ops-coffee.cn" />
  <meta property="og:title" content="疫情在家帮老婆提升下工作效率" />
  <meta property="og:description" content="效率提升杠杆的，在线问卷提升数据收集效率，企业微信通知提升数据校验效率" />
  <link rel="canonical" href="https://blog.ops-coffee.cn" />
  <!-- End SEO tag -->
</head>

<body>
  <div class="header">
    <div class="container">
      <nav class="header-site">
        <ul>
          <li><a href="/">首页</a></li>
            <li class="has-submenu">
              <a href="#" target="_self">运维</a>
              <ul class="sub-menu">
                <li><a href="/tag/系统运维/"target="_self">系统运维</a></li>
                <li><a href="/elk/index.html"target="_self">ELK系列</a></li>
                <li><a href="/ldap/index.html"target="_self">LDAP系列</a></li>
              </ul>
            </li>
            <li class="has-submenu">
              <a href="#" target="_self">开发</a>
              <ul class="sub-menu">
                <li><a href="/tag/Devops/"target="_self">DevOps</a></li>
                <li><a href="/tag/Python/"target="_self">Python</a></li>
                <li><a href="/tag/Django/"target="_self">Django</a></li>
                <li><a href="/bpmn/index.html"target="_self">BPMN系列</a></li>
                <li><a href="/webssh/index.html"target="_self">WebSSH系列</a></li>
                <li><a href="/frontend/index.html"target="_self">前端开发系列</a></li>
              </ul>
            </li>
            <li><a href="/tag/这是生活/" target="_self">这是生活</a></li>
            <li><a href="/devops.html" target="_self">运维平台</a></li>
            <li class="has-submenu">
              <a href="/travels.html" target="_self">房车旅行</a>
              <ul class="sub-menu">
                <li><a href="/r/index.html"target="_self">房车体验</a></li>
                <li><a href="/travels.html"target="_self">旅行游记</a></li>
              </ul>
            </li>
            <li><a href="/tag/index.html" target="_self">标签</a></li>
            <li><a href="/archive.html" target="_self">归档</a></li>
        </ul>
      </nav>
    </div>
  </div>

  <header>
    <div class="container">
      <a href="/">
        <h1>运维咖啡吧</h1>
        <h2>享受技术带来的乐趣，体验生活给予的感动</h2>
      </a>
    </div>
  </header>

  <div id="content-wrap">
    <div class="container">
        <h1 id="art-title">疫情在家帮老婆提升下工作效率</h1>

        <p>受疫情影响，上海许多公司都在两周之前开始居家办公，我和老婆都是，随着风控加码有些小伙伴开始出现物资短缺，吃饭都面临困难。上周老婆任职的公司启动关怀模式，开始给缺乏物资的员工派送蔬菜礼包。特殊时期公司能得到的物资也有限，没有办法给每一位员工都派送，只能先派发给风控区内物资匮乏的员工，老婆得到任务统计有哪些员工比较紧急需要支援，收集相关信息上报</p>
<h2 id="_1">信息收集</h2>
<p>拿到任务后马上就开始执行，我看她拟了个通知发到公司大群让有需求的员工单独找她，她再将大家的联系电话家庭住址等信息统一进行汇总</p>
<p>看这操作手法我实在着急，效率也太低了，收集信息完全可以通过在线问卷的方式，大家各自填写，完了后台导出报表就行了，不仅简单高效还能做到数据格式统一</p>
<p>于是我打开腾讯问卷系统花点时间现学现卖生成了个问卷，让她发在大群让有需求的同事自行填写，起初她还抵触，用过之后是真的香</p>
<p><img alt="" loading="lazy" src="/static/images/2022/0401.01.jpg" /></p>
<h2 id="_2">信息确认</h2>
<p>这周上海以黄浦江为界，整个浦东都开启封闭管理，老婆她们公司开启了第二波蔬菜大礼包配送，有了上次成功的经验，这次主动求我给重新做个问卷收集信息，我自当义不容辞了</p>
<p>信息收集完成后，领导说由于上次有些人信息填错导致物资送不到，这次再确认下大家填写的信息是否有误，总共有百来十个员工信息需要确认，这要一个一个的找她们确认得确认到啥时候呀，沟通成本太高了</p>
<p>于是我给她建议，用个Google文档之类的在线文档，数据放进去发消息给每个人让他们自己去确认下，然而数据里包含家庭住址等私密信息，所有人都能看到自己的家庭住址不太好</p>
<p>自己只能看到自己的信息，别人的看不到，那也就是说发给每个人的信息都是不一样的，现有的这些在线工具似乎是不太好处理，这个时候就发挥出来我的优势了，由于她们内部使用企业微信沟通的，花了点时间看了下企业微信的文档，可以通过推送消息接口给每个人推送个性化的消息</p>
<p>说干就干，总体也比较简单，没几行代码就搞定了，思路就是循环读取记录用户信息的csv文件，取每一条数据匹配出来相关信息然后调用企业微信API发送通知，发送通知的代码如下</p>
<pre class="codehilite"><code>import json
import requests


class WorkWeixinApi:
    def __init__(self):
        self.domain = 'https://qyapi.weixin.qq.com/cgi-bin'
        self.client_id = 'Your client id'
        self.client_secret = 'Your client secret'
        self.agentid = 'Your agentid'

    def get_access_token(self):
        params = {
            'corpid': self.client_id,
            'corpsecret': self.client_secret,
        }

        try:
            r = requests.get(self.domain + '/gettoken', params=params)

            return True, r.status_code, r.json()
        except Exception as e:
            return False, 500, '获取Token失败：' + str(e)

    def send_message(self, subject, content, reciever_list, enable_duplicate_check=0):
        _state, _code, _data = self.get_access_token()

        if _state:
            post_data = json.dumps({
                &quot;touser&quot;: '|'.join([i.split('@')[0] for i in reciever_list]),
                &quot;msgtype&quot;: &quot;text&quot;,
                &quot;agentid&quot;: int(self.agentid),
                &quot;text&quot;: {&quot;content&quot;: subject + &quot;\r\n\r\n&quot; + content},
                &quot;enable_duplicate_check&quot;: enable_duplicate_check
            })

            try:
                r = requests.post(self.domain + '/message/send?access_token=' + _data.get('access_token'),
                                  data=post_data)

                return True, r.status_code, r.json()
            except Exception as e:
                return False, 500, '发送消息失败：' + str(e)
        else:
            return _state, _code, _data


if __name__ == '__main__':
    for line in open(&quot;ops-coffee.cn.csv&quot;): 
        id, name, email, phone, street, address = line.split(',')

        state, code, data = WorkWeixinApi().send_message(
            '蔬菜大礼包信息确认',
            '你好，请你确认蔬菜礼包送货地址是否正确，如有错误请单独联系HR告知，无错误请忽略\r\n\r\n名称：%s\r\n电话：%d\r\n街道：%s\r\n地址：%s' %(
            name, phone.strip(), street, address),
            ['%s' % email]
        )

        print('%s 通知发送 %s, %s' %(name, '成功' if state and data.get('errcode') == 0 else '失败', data.get('errmsg')))</code></pre>


<p>csv文件的内容大概像这样</p>
<pre class="codehilite"><code>01,韦小宝,andy@ops-coffee.cn,15866668888,张江镇,张江路115弄40号
01,张无忌,jason@ops-coffee.cn,15866668888,张江镇,张江路115弄41号</code></pre>


<p>数据脚本都准备好了，然后直接执行，相关的人就只收到了包含自己信息的通知</p>
<p><img alt="" loading="lazy" src="/static/images/2022/0401.02.png" /></p>
<p>片刻时间所有需要确认的信息都准确无误的发送给了正确的人，这波操作下来，起码晚上加两个菜应该是没啥问题了吧。由此想到其实可以给做的更简单更完善一点，一个专门发送企业微信通知的服务，面向不懂技术的普通用户，她们只需要收集好要发送的通知信息就好了，然后上传或者粘贴进系统内一键发送，同时能记录发送日志，就到这里不再展开了吧，各位有想法的小伙伴可以实现下</p>
<p>最后，希望疫情快点过去，大家都能绿码永在，核算常阴，早日自由</p>

        <div>
          <ul style="display: inline-block;padding: 0;margin: 0 0 0.5em;color: #999;">
            <li style="display: inline-block;margin: 0 1em 0 0;"><a href="/s/zpVZw8vdpTLgGOR6GvpiqA.html">📅 2022-04-01</a></li>
<li style="display: inline-block;margin: 0 1em 0 0;"><a href="/tag/这是生活/">🏷️ 这是生活</a></li><li style="display: inline-block;margin: 0 1em 0 0;"><a href="/tag/Just-For-Fun/">🏷️ Just-For-Fun</a></li><li style="display: inline-block;margin: 0 1em 0 0;"><a href="/tag/关于技术/">🏷️ 关于技术</a></li>          </ul>
        </div>

        <hr>

        <div class="nav-cell clearfix">
            <script async src="https://giscus.app/client.js"
                    data-repo="ops-coffee/blog" data-repo-id="MDEwOlJlcG9zaXRvcnkxNDY4OTI0MTg="
                    data-category="Announcements" data-category-id="DIC_kwDOCMFmgs4CQar3"
                    data-mapping="pathname" data-strict="0" data-reactions-enabled="1"
                    data-emit-metadata="0" data-input-position="top" data-theme="light"
                    data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous">
            </script>
        </div>

        <div>
            <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8944257246828217"
                 data-ad-slot="6731434232" data-ad-format="auto" data-full-width-responsive="true"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>

        <div class="nav-cell clearfix">
            <p class="nav-list-title">能看到这里一定是真爱，关注一下吧</p>
            <img alt="" loading="lazy" src="/static/images/wx.sou1.png" />
        </div>
    </div>
  </div>

  <footer class="footer">
    <div class="container clearfix">
      <div class="copy"> © ops-coffee</div>

      <div class="link">
        <a href="/search.html" title="搜索" target="_blank">搜索</a>
        <a href="/questions.html" title="提问" target="_blank">提问</a>
        <a href="/friends.html" title="友情链接" target="_blank">友链</a>
      </div>
    </div>
  </footer>
  
  <!-- Umami Cloud -->
<script async src="https://umami.ops-coffee.cn/script.js" data-website-id="a4aabd8e-32c7-40e7-a81c-119b909f2d0f"></script>

<!-- Google Adsense -->
<script data-ad-client="ca-pub-8944257246828217" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</body>

</html>