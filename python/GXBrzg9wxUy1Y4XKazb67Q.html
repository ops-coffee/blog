<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="applicable-device" content="pc,mobile">
  <meta name="keywords" content="Python,Linux,å…³äºæŠ€æœ¯" />
  <meta name="description" content="è¿™ç¯‡æ–‡ç« ä»‹ç»å¦‚ä½•å†™ä¸ªç³»ç»Ÿå‘½ä»¤ä»¥åŠæˆ‘ä¸ºä»€ä¹ˆè¦å†™å‘½ä»¤" />
  <link rel="alternate" type="application/rss+xml" title="è¿ç»´å’–å•¡å§" href="https://blog.ops-coffee.cn/feed.xml" />
  <link rel="stylesheet" href="https://blog.ops-coffee.cn/static/posts/css/ops-coffee.min.css" type="text/css" />

  <!-- Begin SEO tag -->
  <title>ç”¨Pythonå†™ä¸ªLinuxç³»ç»Ÿå‘½ä»¤</title>
  <meta property="og:locale" content="zh_CN" />
  <meta property="og:site_name" content="è¿ç»´å’–å•¡å§" />
  <meta property="og:url" content="https://blog.ops-coffee.cn" />
  <meta property="og:title" content="ç”¨Pythonå†™ä¸ªLinuxç³»ç»Ÿå‘½ä»¤" />
  <meta property="og:description" content="è¿™ç¯‡æ–‡ç« ä»‹ç»å¦‚ä½•å†™ä¸ªç³»ç»Ÿå‘½ä»¤ä»¥åŠæˆ‘ä¸ºä»€ä¹ˆè¦å†™å‘½ä»¤" />
  <link rel="canonical" href="https://blog.ops-coffee.cn" />
  <!-- End SEO tag -->
</head>

<body>
  <div class="header">
    <div class="container">
      <nav class="header-site">
        <ul>
          <li><a href="/">é¦–é¡µ</a></li>
            <li class="has-submenu">
              <a href="#" target="_self">è¿ç»´</a>
              <ul class="sub-menu">
                <li><a href="/tag/ç³»ç»Ÿè¿ç»´/" target="_self">ç³»ç»Ÿè¿ç»´</a></li>
                <li><a href="/elk/index.html" target="_self">ELKç³»åˆ—</a></li>
                <li><a href="/ldap/index.html" target="_self">LDAPç³»åˆ—</a></li>
              </ul>
            </li>
            <li class="has-submenu">
              <a href="#" target="_self">å¼€å‘</a>
              <ul class="sub-menu">
                <li><a href="/tag/Devops/" target="_self">DevOps</a></li>
                <li><a href="/tag/Python/" target="_self">Python</a></li>
                <li><a href="/tag/Django/" target="_self">Django</a></li>
                <li><a href="/bpmn/index.html" target="_self">BPMNç³»åˆ—</a></li>
                <li><a href="/webssh/index.html" target="_self">WebSSHç³»åˆ—</a></li>
                <li><a href="/frontend/index.html" target="_self">å‰ç«¯å¼€å‘ç³»åˆ—</a></li>
              </ul>
            </li>
            <li><a href="/devops.html" target="_self">è¿ç»´å¹³å°</a></li>
            <li><a href="/tag/è¿™æ˜¯ç”Ÿæ´»/" target="_self">è¿™æ˜¯ç”Ÿæ´»</a></li>
            <li class="has-submenu">
              <a href="#" target="_self">æˆ¿è½¦æ—…è¡Œ</a>
              <ul class="sub-menu">
                <li><a href="/r/index.html" target="_self">æˆ¿è½¦ä½“éªŒ</a></li>
                <li><a href="/travels.html" target="_self">æ—…è¡Œæ¸¸è®°</a></li>
              </ul>
            </li>
            <li><a href="/tag/index.html" target="_self">æ ‡ç­¾</a></li>
            <li><a href="/archive.html" target="_self">å½’æ¡£</a></li>
        </ul>
      </nav>
    </div>
  </div>

  <header>
    <div class="container">
      <a href="/">
        <h1>è¿ç»´å’–å•¡å§</h1>
        <h2>äº«å—æŠ€æœ¯å¸¦æ¥çš„ä¹è¶£ï¼Œä½“éªŒç”Ÿæ´»ç»™äºˆçš„æ„ŸåŠ¨</h2>
      </a>
    </div>
  </header>

  <div id="content-wrap">
    <div class="container">
        <h1 id="art-title">ç”¨Pythonå†™ä¸ªLinuxç³»ç»Ÿå‘½ä»¤</h1>

        <blockquote>
<p>è¿™ç¯‡æ–‡ç« ä»‹ç»å¦‚ä½•å†™ä¸ªç³»ç»Ÿå‘½ä»¤ä»¥åŠæˆ‘ä¸ºä»€ä¹ˆè¦å†™å‘½ä»¤</p>
</blockquote>
<p>â€œä¸€åˆ‡çš†æ–‡ä»¶â€æ˜¯linuxçš„åŸºæœ¬å“²å­¦ä¹‹ä¸€ï¼Œæˆ‘ä»¬åœ¨linuxä¸‹æ‰§è¡Œçš„è¯¸å¦‚<code>ls</code>ä¹‹ç±»çš„å‘½ä»¤å®é™…ä¸Šéƒ½æ˜¯å»æ‰§è¡Œäº†ç³»ç»Ÿä¸Šçš„æŸä¸ªæ–‡ä»¶ï¼Œ<code>which</code>å‘½ä»¤å¯ä»¥æŸ¥çœ‹åˆ°æˆ‘ä»¬æ‰§è¡Œçš„å‘½ä»¤å¯¹åº”çš„æ˜¯ç³»ç»Ÿä¸Šçš„å“ªä¸ªæ–‡ä»¶ï¼Œä¾‹å¦‚å¸¸ç”¨çš„<code>ls</code>å‘½ä»¤å®é™…ä¸Šå°±æ˜¯æ‰§è¡Œäº†<code>/bin/ls</code>è¿™ä¸ªæ–‡ä»¶</p>
<pre class="codehilite"><code>root@ops-coffee:~# which ls
/bin/ls</code></pre>


<p>åŸºäºæ­¤ï¼Œæˆ‘ä»¬å°±çŸ¥é“äº†å®šä¹‰ä¸€ä¸ªå‘½ä»¤å¾ˆç®€å•ï¼Œåªéœ€è¦å†™ä¸ªå¯æ‰§è¡Œçš„æ–‡ä»¶å°±è¡Œäº†ï¼Œpythonçš„æ ‡å‡†æ¨¡å—<code>argparse</code>å°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿæ–¹ä¾¿çš„æ„å»ºä¸€ä¸ªç”¨æˆ·å‹å¥½çš„å‘½ä»¤</p>
<h2 id="argparse">argparse</h2>
<p>ç›¸æ¯”äºè‡ªå·±å®ç°ä¸ªå‘½ä»¤æ–‡ä»¶ï¼Œ<code>argparse</code>æ¨¡å—èƒ½å¤Ÿè‡ªåŠ¨ç”Ÿæˆå¸®åŠ©å’Œä½¿ç”¨æ‰‹å†Œï¼Œå¹¶åœ¨ç”¨æˆ·ä¼ å…¥æ— æ•ˆå‚æ•°æ—¶æŠ¥é”™ã€‚ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹å¦‚ä¸‹</p>
<pre class="codehilite"><code class="language-python3 linenums">#!/usr/bin/env python3
# coding:utf8

import argparse

parser = argparse.ArgumentParser(description='æ•´æ•°å¤„ç†')
parser.add_argument('integers', type=int, help='è¦å¤„ç†æ•´æ•°')

args = parser.parse_args()
print(args.integers)</code></pre>


<p>è¿™ä¸ªç¤ºä¾‹çš„æ„æ€æ˜¯æ¥æ”¶ä¸€ä¸ªæ•°å­—ï¼Œå¹¶å°†è¿™ä¸ªæ•°å­—è¾“å‡ºï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹è¯¦ç»†çš„è§£é‡Š</p>
<p>é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª<code>ArgumentParser</code>å¯¹è±¡ï¼Œ<code>ArgumentParser</code>å¯¹è±¡æœ‰å¾ˆå¤šå‚æ•°å¯ä»¥é€‰æ‹©ï¼Œè¿™é‡Œçš„<code>description</code>å®šä¹‰åœ¨å‚æ•°å¸®åŠ©æ–‡æ¡£ä¹‹å‰æ˜¾ç¤ºçš„æ–‡æœ¬ï¼Œé€šå¸¸ç”¨æ¥å®šä¹‰è¿™ä¸ªç¨‹åºåšä»€ä¹ˆä»¥åŠæ€ä¹ˆåš</p>
<pre class="codehilite"><code>parser = argparse.ArgumentParser(description='æ•´æ•°å¤„ç†')</code></pre>


<p>ç„¶åé€šè¿‡<code>add_argument</code>ç»™<code>ArgumentParser</code>å¯¹è±¡æ·»åŠ å‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°<code>integers</code>ä¸ºå‚æ•°åï¼Œ<code>type</code>æŒ‡å®šç±»å‹ä¸º<code>int</code>ï¼Œ<code>help</code>æŒ‡å®šè¿™ä¸ªå­—æ®µçš„å¸®åŠ©ä¿¡æ¯</p>
<pre class="codehilite"><code>parser.add_argument('integers', type=int, help='è¦å¤„ç†çš„æ•´æ•°')</code></pre>


<p>é€šè¿‡è°ƒç”¨<code>ArgumentParser</code>å¯¹è±¡çš„<code>parse_args</code>æ–¹æ³•è¿”å›ä¸€ä¸ªå…·æœ‰æ‰€æœ‰å‚æ•°å±æ€§çš„å¯¹è±¡</p>
<pre class="codehilite"><code>args = parser.parse_args()</code></pre>


<p>æœ€åé€šè¿‡<code>args.å‚æ•°å</code>è·å–åˆ°ä¼ å…¥çš„å‚æ•°å€¼</p>
<pre class="codehilite"><code>print(args.integers)</code></pre>


<h3 id="_1">æ‰§è¡Œ</h3>
<p>æˆ‘ä»¬å°†ä»¥ä¸Šæ–‡ä»¶å‘½åä¸º<code>opscoffee</code>ï¼Œå¹¶èµ‹äºˆæ‰§è¡Œæƒé™ï¼Œæ”¾åœ¨ç³»ç»Ÿç¯å¢ƒå˜é‡<code>/bin</code>ä¸‹ï¼Œå°±å¯ä»¥å½“ä½œå‘½ä»¤ç›´æ¥æ‰§è¡Œäº†</p>
<pre class="codehilite"><code># chmod +x opscoffee
# mv opscoffee /bin/</code></pre>


<p>å¦‚æœç›´æ¥æ‰§è¡Œ<code>opscoffee</code>å‘½ä»¤çš„è¯å°†ä¼šæ”¶åˆ°ä¸€ä¸ªæŠ¥é”™ï¼Œæç¤ºä½ å¿…é¡»æœ‰ä¸€ä¸ªå‚æ•°<code>integers</code></p>
<pre class="codehilite"><code># opscoffee
usage: opscoffee [-h] integers
opscoffee: error: the following arguments are required: integers</code></pre>


<p>åŒæ—¶ä¹Ÿé€šè¿‡<code>usage</code>å‘Šè¯‰äº†ä½ è¿™ä¸ªå‘½ä»¤çš„ç”¨æ³•ï¼Œé»˜è®¤æœ‰ä¸€ä¸ª<code>-h</code>å‚æ•°å¯ä»¥æ‰“å°å‘½ä»¤å¸®åŠ©</p>
<pre class="codehilite"><code># opscoffee -h
usage: opscoffee [-h] integers

æ•´æ•°å¤„ç†

positional arguments:
  integers    è¦å¤„ç†çš„æ•´æ•°

optional arguments:
  -h, --help  show this help message and exit</code></pre>


<p>è¿™å°±æ˜¯ä½¿ç”¨<code>argparse</code>æ¨¡å—çš„å¥½å¤„ï¼Œè‡ªåŠ¨ç”Ÿæˆå¸®åŠ©ï¼Œæä¾›å‹å¥½çš„ä½¿ç”¨ä½“éªŒ</p>
<h3 id="_2">å‚æ•°</h3>
<p><code>argparse</code>èƒ½å®ç°çš„è¿œä¸æ­¢äºæ­¤ï¼Œè¿˜æœ‰æ›´åŠ å¼ºå¤§çš„åŠŸèƒ½ï¼Œä¸»è¦åœ¨äº<code>add_argument</code>æ–¹æ³•å‚æ•°çš„è¿ç”¨ï¼Œä»¥ä¸‹ä»¥ä¸€äº›ä¾‹å­æ¥å­¦ä¹ ä¸‹ä¸€äº›å¸¸ç”¨çš„å‚æ•°</p>
<h4 id="_3">å¯é€‰å‚æ•°</h4>
<p>å½“æˆ‘ä»¬åœ¨å‚æ•°åå‰æ·»åŠ <code>-</code>æˆ–è€…<code>--</code>æ—¶ï¼Œ<code>argparse</code>ä¼šé»˜è®¤è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå¯ä»¥ä¸ä¼ å€¼ï¼Œä¾‹å¦‚</p>
<pre class="codehilite"><code>parser.add_argument('--age', type=int, help='å¹´é¾„')</code></pre>


<p>å¯é€‰å‚æ•°å½“æ²¡æœ‰ä¼ å€¼æ—¶çš„é»˜è®¤å€¼ä¸º<code>None</code>ï¼Œå¯ä»¥é€šè¿‡<code>default</code>æ¥è®¾ç½®é»˜è®¤å€¼</p>
<pre class="codehilite"><code>parser.add_argument('--age', type=int, default=37, help='å¹´é¾„')</code></pre>


<p>å½“æ²¡æœ‰å‚æ•°<code>--age</code>æ—¶ï¼Œæ˜¾ç¤º<code>default</code>è®¾ç½®çš„å€¼(æ²¡æœ‰è®¾ç½®<code>default</code>åˆ™æ˜¾ç¤ºNone)ï¼Œæœ‰<code>--age</code>åˆ™æ˜¾ç¤º<code>--age</code>æŒ‡å®šçš„å€¼</p>
<pre class="codehilite"><code># opscoffee
37
# opscoffee --age 38
38</code></pre>


<p>å¦‚æœä½ æƒ³è®©å¯é€‰å‚æ•°ä¹Ÿå˜æˆå¿…é€‰çš„ï¼Œåˆ™åªéœ€è¦è®¾ç½®<code>required=True</code>å³å¯</p>
<pre class="codehilite"><code>parser.add_argument('--age', type=int, default=37, required=True, help='å¹´é¾„')</code></pre>


<h4 id="type">type</h4>
<p><code>type</code>ç”¨æ¥æŒ‡å®šå‚æ•°çš„ç±»å‹ï¼Œå…è®¸ä»»ä½•ç±»å‹æ£€æŸ¥å’Œç±»å‹è½¬æ¢ï¼Œä¾‹å¦‚<code>str</code>ã€<code>int</code>ã€<code>float</code>ã€<code>open</code>ç”šè‡³æ˜¯ä½ è‡ªå®šä¹‰çš„æ–¹æ³•éƒ½å¯ä»¥ã€‚</p>
<pre class="codehilite"><code class="language-python3 linenums">#!/usr/bin/env python3
# coding:utf8

import argparse

def even(string):
    value = int(string)

    if value%2!=0:
        msg = &quot;%r ä¸æ˜¯å¶æ•°&quot; % string
        raise argparse.ArgumentTypeError(msg)
    return value

parser = argparse.ArgumentParser(description='æ•´æ•°å¤„ç†')
parser.add_argument('integers', type=even, help='è¦å¤„ç†çš„æ•´æ•°')

args = parser.parse_args()
print(args.integers)</code></pre>


<p>ä»¥ä¸Šå‘½ä»¤æ¥æ”¶ä¸€ä¸ªå‚æ•°<code>integers</code>ï¼Œå¹¶å°†å…¶<code>type</code>è®¾ç½®ä¸ºäº†è‡ªå®šä¹‰æ–¹æ³•<code>even</code>ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåˆ¤æ–­ç”¨æˆ·è¾“å…¥çš„æ•°å­—æ˜¯å¦æ˜¯å¶æ•°ï¼Œå¦‚æœä¸æ˜¯åˆ™æŠ¥é”™ï¼Œæ‰§è¡Œç»“æœå¦‚ä¸‹</p>
<pre class="codehilite"><code># opscoffee 1
usage: opscoffee [-h] integers
opscoffee: error: argument integers: '1' ä¸æ˜¯å¶æ•°
# opscoffee 2
2</code></pre>


<h4 id="choices">choices</h4>
<p><code>choices</code>å‚æ•°å¯ä»¥é™åˆ¶å‚æ•°çš„èŒƒå›´ï¼Œä¾‹å¦‚æˆ‘ä»¬åªæƒ³è®©ç”¨æˆ·ä»<code>ops</code>æˆ–<code>coffee</code>ä¸¤ä¸ªå‚æ•°ä¸­é€‰æ‹©ä¸€ä¸ªè¾“å…¥ï¼Œåˆ™å¯ä»¥è¿™æ ·ç”¨</p>
<pre class="codehilite"><code>parser.add_argument('site', choices=['ops','coffee'], help='Site')</code></pre>


<p>é‚£ä¹ˆå½“æˆ‘ä»¬è¾“å…¥çš„å†…å®¹ä¸æ˜¯<code>ops</code>æˆ–<code>coffee</code>æ—¶ï¼Œåˆ™æŠ¥é”™</p>
<pre class="codehilite"><code># opscoffee cn
usage: opscoffee [-h] {ops,coffee}
opscoffee: error: argument site: invalid choice: 'cn' (choose from 'ops', 'coffee')</code></pre>


<h4 id="nargs">nargs</h4>
<p>é€šå¸¸æˆ‘ä»¬åœ¨<code>argparse</code>ä¸­å®šä¹‰çš„å‚æ•°æ•°é‡ä¸ä¼ å…¥çš„å‚æ•°æ•°é‡åº”å½“ç›¸ç­‰ï¼Œä½†æœ‰äº›æ—¶å€™æˆ‘ä»¬éœ€è¦æ¥æ”¶æœªçŸ¥æ•°é‡çš„å‚æ•°ï¼Œ<code>nargs</code>å°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬</p>
<p>nargsæ”¯æŒä»¥ä¸‹å€¼ï¼š<code>N</code>ï¼ˆæ•´æ•°ï¼‰ã€<code>'?'</code>ã€<code>'*'</code>ã€<code>'+'</code>ã€<code>argarse.REMAINDER</code></p>
<p><strong><code>Nï¼š</code></strong> è¡¨ç¤ºNä¸ªå‚æ•°ä¼šè¢«èšé›†åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­ï¼Œä¾‹å¦‚</p>
<pre class="codehilite"><code>import argparse

parser = argparse.ArgumentParser(description='æ•´æ•°å¤„ç†')
parser.add_argument('integers', type=int, nargs=2, help='è¦å¤„ç†çš„æ•´æ•°')

args = parser.parse_args()
print(args.integers)</code></pre>


<p>å°†è¾“å‡º</p>
<pre class="codehilite"><code># opscoffee 9 10 
[9, 10]</code></pre>


<p><strong><code>'?'ï¼š</code></strong> è¡¨ç¤ºä½¿ç”¨ä¸€ä¸ªæˆ–ä¸ä½¿ç”¨å‚æ•°ï¼Œå½“ä¸ä¼ å‚æ•°æ—¶ï¼Œé»˜è®¤ä¸ºNone</p>
<pre class="codehilite"><code>parser.add_argument('integers', type=int, nargs='?', help='è¦å¤„ç†çš„æ•´æ•°')</code></pre>


<p><strong><code>'*'ï¼š</code></strong> è¡¨ç¤ºä½¿ç”¨æ‰€æœ‰å‚æ•°ï¼Œå‚æ•°ä¸ªæ•°å¯ä»¥ä¸º0</p>
<pre class="codehilite"><code>parser.add_argument('integers', type=int, nargs='*', help='è¦å¤„ç†çš„æ•´æ•°')</code></pre>


<p><strong><code>'+'ï¼š</code></strong> ä¸<code>'*'</code>ç±»ä¼¼ï¼Œä½†è‡³å°‘è¦æœ‰ä¸€ä¸ªå‚æ•°ï¼Œå¦åˆ™å°†ä¼šæŠ¥é”™</p>
<pre class="codehilite"><code>parser.add_argument('integers', type=int, nargs='+', help='è¦å¤„ç†çš„æ•´æ•°')</code></pre>


<h2 id="_4">è‡ªå®šä¹‰å‘½ä»¤</h2>
<p>å…ˆè¯´æˆ‘ä¸ºä»€ä¹ˆè¦å†™ä¸ªç³»ç»Ÿå‘½ä»¤ï¼Ÿ</p>
<p>æ–‡ç« <a href="/s/uXQbM4t11ICdzNofZyDeXA" target="_blank">ã€Probiusï¼šä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„è‡ªå®šä¹‰ä»»åŠ¡ç³»ç»Ÿã€</a>ä¸­ä»‹ç»äº†æˆ‘ä»¬çš„è‡ªå®šä¹‰ä»»åŠ¡ç³»ç»Ÿï¼Œè¿™ä¸ªç³»ç»Ÿå¯ä»¥ç”¨æ¥ç¼–æ’ä»»åŠ¡ï¼Œè€Œåœ¨ç¼–æ’CICDä»»åŠ¡ä¸­ä¼šç”¨åˆ°é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬çš„é…ç½®æ–‡ä»¶éƒ½æ˜¯é€šè¿‡<a href="/s/QG42UqJ9rnswQDMd41CYUg" target="_blank">Kerrigané…ç½®ä¸­å¿ƒ</a>æ¥ç®¡ç†çš„,ç›®å‰è·å–é…ç½®ä¸­å¿ƒçš„é…ç½®ä¸»è¦æœ‰ä¸¤ç§æ–¹æ³•</p>
<ol>
<li>é…åˆconfdæœåŠ¡è‡ªåŠ¨æ‹‰å–æ›´æ–°ï¼Œè¯¦ç»†å†…å®¹å¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="/s/uGUvV4jl4YIvNztuepdC8A" target="_blank">ä¸­å°å›¢é˜Ÿè½åœ°é…ç½®ä¸­å¿ƒè¯¦è§£</a></li>
<li>é…ç½®ä¸­å¿ƒæä¾›APIï¼Œå¯ä»¥é€šè¿‡APIè·å–é…ç½®å†…å®¹</li>
</ol>
<p>è„šæœ¬é‡Œå¦‚æœæƒ³è¦ä½¿ç”¨é…ç½®ä¸­å¿ƒçš„é…ç½®ï¼Œåˆ™åªèƒ½é€šè¿‡APIçš„æ–¹å¼å»è·å–ï¼Œè¿™æ ·å°±è¦åœ¨æ¯ä¸ªéœ€è¦ç”¨åˆ°é…ç½®çš„åœ°æ–¹å†™ä¸€æ®µä»£ç æ¥è·å–åŠå¤„ç†ï¼Œä¸ä»…ä¼šå‡ºç°å¤§é‡çš„é‡å¤ä»£ç ï¼Œå¹¶ä¸”éå¸¸çš„ä¸ä¼˜é›…ï¼Œæ›´ä¸ºé‡è¦çš„æ˜¯è¯·æ±‚APIçš„Tokenå°†ä¼šå‡ºç°åœ¨è„šæœ¬é‡Œï¼Œå¸¦æ¥ä¸€å®šçš„å®‰å…¨é£é™©</p>
<p>åŸºäºä»¥ä¸Šè€ƒè™‘ï¼Œå†™ä¸ªè‡ªå®šä¹‰å‘½ä»¤æ¥åšè¿™ä»¶äº‹æƒ…æ›´ä¸ºå¦¥å½“ï¼Œäºæ˜¯ä¾¿å†™äº†ä¸‹è¾¹è¿™ä¸ªå‘½ä»¤</p>
<pre class="codehilite"><code class="language-python3 linenums">#!/usr/bin/env python3
# coding:utf8

# è¿™æ˜¯ä¸€ä¸ªç³»ç»Ÿå‘½ä»¤ç”¨æ¥è·å–kerrigané…ç½®ä¸­å¿ƒçš„é…ç½®å¹¶å†™å…¥æœ¬åœ°æ–‡ä»¶ï¼Œéœ€è¦å°†æ­¤æ–‡ä»¶copyåˆ°ç›®å½•/binä¸‹

import sys
import argparse
import requests

parser = argparse.ArgumentParser(description='è·å–é…ç½®ä¸­å¿ƒKerrigané…ç½®')

parser.add_argument('configkey', type=str, help='é…ç½®ä¸­å¿ƒä¸­æ–‡ä»¶çš„Key')
parser.add_argument('localfile', type=str, help='ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶çš„è·¯å¾„')

args = parser.parse_args()

# è·å¾—ä¼ å…¥çš„å‚æ•°
configkey = args.configkey
localfile = args.localfile

header = {
    'Authorization': 'Token eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.JTdCJTIyZXhwJTIyJTNBMTkwNjcwNzAyMCUyQyUyMmlhdCUyMiUzQTE1OTEzNDcwMjAlMkMlMjJkYXRhJTIyJTNBJTdCJTIydXNlcm5hbWUlMjIlM0ElMjJwcm9iaXVzQG9wcy1jb2ZmZWUuY24lMjIlN0QlN0Q.ops1ZNhq19XSEL2PUo-iQqzbhimDnpFiYc_7EUXftF4'}

uri = 'http://kerrigan.ops-coffee.cn/api/config/?key=' + configkey
r = requests.get(uri, headers=header)

if r.json()['state']:
    content = r.json()['message']['content']

    try:
        with open(localfile, 'w') as f:
            f.write(content)

        sys.exit(0)
    except Exception as e:
        print('write local file failed: ', str(e))
        sys.exit(3)
else:
    print('get config failed: ', r.json()['message'])
    sys.exit(1)</code></pre>


<p>ä»¥ä¸Šä»£ç çš„æ„æ€æ˜¯æ ¹æ®ä¼ å…¥çš„keyå’Œfileè·¯å¾„ï¼Œå»é…ç½®ä¸­å¿ƒè·å–å¯¹åº”é…ç½®æ–‡ä»¶çš„å†…å®¹å¹¶å†™å…¥åˆ°æœ¬åœ°fileä¸­ã€‚éœ€è¦æ³¨æ„çš„æ˜¯<code>exit</code>ï¼Œè¿”å›åˆé€‚çš„é€€å‡ºçŠ¶æ€æ˜¯ä¸ªå¾ˆå¥½çš„ä¹ æƒ¯ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡<code>$?</code>æ¥è·å–å‘½ä»¤æ‰§è¡ŒæˆåŠŸè¿˜æ˜¯å¤±è´¥</p>
<p>å°†æ­¤æ–‡ä»¶å‘½åä¸ºgetconfigå¹¶ç§»åŠ¨åˆ°/binç›®å½•ä¸‹æ·»åŠ æ‰§è¡Œæƒé™ï¼Œå°±å¯ä»¥åœ¨ç³»ç»Ÿä»»ä½•åœ°æ–¹ä½¿ç”¨<code>getconfig</code>å‘½ä»¤äº†</p>
<pre class="codehilite"><code>getconfig /conf/coffee/prod/docker/Dockerfile  /home/project/coffee/Dockerfile</code></pre>

        <div>
          <ul style="display: inline-block;padding: 0;margin: 0 0 0.5em;color: #999;">
            <li style="display: inline-block;margin: 0 1em 0 0;"><a href="/python/GXBrzg9wxUy1Y4XKazb67Q.html">ğŸ“… 2020-06-09</a></li>
<li style="display: inline-block;margin: 0 1em 0 0;"><a href="/tag/Python/">ğŸ·ï¸ Python</a></li><li style="display: inline-block;margin: 0 1em 0 0;"><a href="/tag/å…³äºæŠ€æœ¯/">ğŸ·ï¸ å…³äºæŠ€æœ¯</a></li>          </ul>
        </div>

        <hr>

        <div class="nav-cell clearfix">
            <script async src="https://giscus.app/client.js"
                    data-repo="ops-coffee/blog" data-repo-id="MDEwOlJlcG9zaXRvcnkxNDY4OTI0MTg="
                    data-category="Announcements" data-category-id="DIC_kwDOCMFmgs4CQar3"
                    data-mapping="pathname" data-strict="0" data-reactions-enabled="1"
                    data-emit-metadata="0" data-input-position="top" data-theme="light"
                    data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous">
            </script>
        </div>

        <div>
            <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8944257246828217"
                 data-ad-slot="6731434232" data-ad-format="auto" data-full-width-responsive="true"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>

        <div class="nav-cell clearfix">
            <p class="nav-list-title">èƒ½çœ‹åˆ°è¿™é‡Œä¸€å®šæ˜¯çœŸçˆ±ï¼Œå…³æ³¨ä¸€ä¸‹å§</p>
            <img alt="" loading="lazy" src="/static/images/wx.sou1.png" />
        </div>
    </div>
  </div>

  <footer class="footer">
    <div class="container clearfix">
      <div class="copy"> Â© ops-coffee</div>

      <div class="link">
        <a href="/search.html" title="æœç´¢" target="_blank">æœç´¢</a>
        <a href="/questions.html" title="æé—®" target="_blank">æé—®</a>
        <a href="/friends.html" title="å‹æƒ…é“¾æ¥" target="_blank">å‹é“¾</a>
      </div>
    </div>
  </footer>
  
  <!-- Umami Cloud -->
<script async src="https://umami.ops-coffee.cn/script.js" data-website-id="a4aabd8e-32c7-40e7-a81c-119b909f2d0f"></script>

<!-- Google Adsense -->
<script data-ad-client="ca-pub-8944257246828217" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</body>

</html>