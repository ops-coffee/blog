<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="applicable-device" content="pc,mobile">
  <meta name="keywords" content="bpmn-js, æµç¨‹ç¼–è¾‘å™¨, ContextPad, è‡ªå®šä¹‰, Vue, Vuex, BPMN, æµç¨‹å›¾" />
  <meta name="description" content="æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†å¦‚ä½•åœ¨Vueç¯å¢ƒä¸­è‡ªå®šä¹‰BPMN.jsçš„ContextPadï¼Œå±•ç¤ºäº†å¦‚ä½•é€šè¿‡Vuexç®¡ç†çŠ¶æ€ï¼Œå¹¶åœ¨æµç¨‹å›¾ä¸­å®ç°èŠ‚ç‚¹å±æ€§çš„åŠ¨æ€æ›´æ–°ã€‚" />
  <link rel="alternate" type="application/rss+xml" title="è¿ç»´å’–å•¡å§" href="https://blog.ops-coffee.com/feed.xml" />
  <link rel="stylesheet" href="https://blog.ops-coffee.com/static/posts/css/ops-coffee.min.css" type="text/css" />

  <!-- Begin SEO tag -->
  <title>æœ€å¥½ç”¨çš„æµç¨‹ç¼–è¾‘å™¨bpmn-jsç³»åˆ—ä¹‹ContextPad</title>
  <meta property="og:locale" content="zh_CN" />
  <meta property="og:site_name" content="è¿ç»´å’–å•¡å§" />
  <meta property="og:url" content="https://blog.ops-coffee.combpmn/bpmn-js-vue-custom-contextpad-demo-code-source.html" />
  <meta property="og:title" content="æœ€å¥½ç”¨çš„æµç¨‹ç¼–è¾‘å™¨bpmn-jsç³»åˆ—ä¹‹ContextPad" />
  <meta property="og:description" content="æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†å¦‚ä½•åœ¨Vueç¯å¢ƒä¸­è‡ªå®šä¹‰BPMN.jsçš„ContextPadï¼Œå±•ç¤ºäº†å¦‚ä½•é€šè¿‡Vuexç®¡ç†çŠ¶æ€ï¼Œå¹¶åœ¨æµç¨‹å›¾ä¸­å®ç°èŠ‚ç‚¹å±æ€§çš„åŠ¨æ€æ›´æ–°ã€‚" />
  <link rel="canonical" href="https://blog.ops-coffee.combpmn/bpmn-js-vue-custom-contextpad-demo-code-source.html" />

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "æœ€å¥½ç”¨çš„æµç¨‹ç¼–è¾‘å™¨bpmn-jsç³»åˆ—ä¹‹ContextPad",
    "description": "æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†å¦‚ä½•åœ¨Vueç¯å¢ƒä¸­è‡ªå®šä¹‰BPMN.jsçš„ContextPadï¼Œå±•ç¤ºäº†å¦‚ä½•é€šè¿‡Vuexç®¡ç†çŠ¶æ€ï¼Œå¹¶åœ¨æµç¨‹å›¾ä¸­å®ç°èŠ‚ç‚¹å±æ€§çš„åŠ¨æ€æ›´æ–°ã€‚",
    "url": "https://blog.ops-coffee.combpmn/bpmn-js-vue-custom-contextpad-demo-code-source.html",
    "author": {
      "@type": "Person",
      "name": "è¿ç»´å’–å•¡å§"
    },
    "publisher": {
      "@type": "Organization",
      "name": "è¿ç»´å’–å•¡å§",
      "logo": {
        "@type": "ImageObject",
        "url": "https://blog.ops-coffee.com/favicon.ico"
      }
    },
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://blog.ops-coffee.combpmn/bpmn-js-vue-custom-contextpad-demo-code-source.html"
    }
  }
  </script>
  <!-- End SEO tag -->
</head>

<body>
  <div class="header">
    <div class="menu-button">&#9776; 
        <span class="menu-title">è¿ç»´å’–å•¡å§</span>
    </div> 

    <div class="container">
      <nav class="header-site">
        <ul>
          <li><a href="/">é¦–é¡µ</a></li>
            <li class="has-submenu">
              <a href="#" target="_self">è¿ç»´</a>
              <ul class="sub-menu">
                <li><a href="/tag/ç³»ç»Ÿè¿ç»´/" target="_self">ç³»ç»Ÿè¿ç»´</a></li>
                <li><a href="/elk/index.html" target="_self">ELKç³»åˆ—</a></li>
                <li><a href="/ldap/index.html" target="_self">LDAPç³»åˆ—</a></li>
              </ul>
            </li>
            <li class="has-submenu">
              <a href="#" target="_self">å¼€å‘</a>
              <ul class="sub-menu">
                <li><a href="/tag/Devops/" target="_self">DevOps</a></li>
                <li><a href="/tag/Python/" target="_self">Python</a></li>
                <li><a href="/tag/Django/" target="_self">Django</a></li>
                <li><a href="/bpmn/index.html" target="_self">BPMNç³»åˆ—</a></li>
                <li><a href="/webssh/index.html" target="_self">WebSSHç³»åˆ—</a></li>
                <li><a href="/frontend/index.html" target="_self">å‰ç«¯å¼€å‘ç³»åˆ—</a></li>
              </ul>
            </li>
            <li><a href="/devops/index.html" target="_self">è¿ç»´å¹³å°</a></li>
            <li class="has-submenu">
              <a href="#" target="_self">è¿™æ˜¯ç”Ÿæ´»</a>
              <ul class="sub-menu">
                <li><a href="/life/chronicles.html" target="_self">æ—¶å…‰å°è®°</a></li>
                <li><a href="/life/money.html" target="_self">å‰¯ä¸šèµšé’±</a></li>
                <li><a href="/life/writing.html" target="_self">å†™ä½œç›¸å…³</a></li>
                <li><a href="/tag/è¿™æ˜¯ç”Ÿæ´»/" target="_self">ç”Ÿæ´»éšç¬”</a></li>
              </ul>
            </li>
            <li class="has-submenu">
              <a href="#" target="_self">æˆ¿è½¦æ—…è¡Œ</a>
              <ul class="sub-menu">
                <li><a href="/rv.html" target="_self">æˆ¿è½¦ä½“éªŒ</a></li>
                <li><a href="/travels.html" target="_self">æ—…è¡Œæ¸¸è®°</a></li>
                <li><a href="/travel/china.html" target="_self">æ—…è¡Œåœ°å›¾</a></li>
              </ul>
            </li>
            <li><a href="/tag/index.html" target="_self">æ ‡ç­¾</a></li>
            <li><a href="/archive.html" target="_self">å½’æ¡£</a></li>
          <li class="search"><a href="/search.html" target="_self" aria-label="æœç´¢">ğŸ”</a></li>
        </ul>
      </nav>
    </div>
  </div>

  <header>
    <div class="container">
      <a href="/">
        <div class="name">è¿ç»´å’–å•¡å§</div>
        <div class="slogan">äº«å—æŠ€æœ¯å¸¦æ¥çš„ä¹è¶£ï¼Œä½“éªŒç”Ÿæ´»ç»™äºˆçš„æ„ŸåŠ¨</div>
      </a>
    </div>
  </header>

  <div id="content-wrap">
    <div class="container">
        <h1 id="art-title">æœ€å¥½ç”¨çš„æµç¨‹ç¼–è¾‘å™¨bpmn-jsç³»åˆ—ä¹‹ContextPad</h1>

        <blockquote>
<p>æœ€å¥½ç”¨çš„æµç¨‹ç¼–è¾‘å™¨bpmn-jsç³»åˆ—æ–‡ç« </p>
</blockquote>
<p>ä¸Šä¸€ç¯‡æ–‡ç« <a href="https://blog.ops-coffee.com/bpmn/bpmn-js-vue-custom-palette-demo-code-source" target="_blank">ã€æœ€å¥½ç”¨çš„æµç¨‹ç¼–è¾‘å™¨bpmn-jsç³»åˆ—ä¹‹Paletteã€</a>ä»‹ç»äº†modeleræ¨¡å¼ä¸‹å¦‚ä½•è‡ªå®šä¹‰å·¦ä¾§å·¥å…·æ Paletteï¼Œè¿™ç¯‡æ–‡ç« å°†ä¼šä»‹ç»å¦‚æœè‡ªå®šä¹‰ContextPad</p>
<p>ä»¥ä¸‹æ¼”ç¤ºä»£ç åŸºäºä¸Šä¸€èŠ‚æ­å»ºå¥½çš„vueç¯å¢ƒï¼Œä½¿ç”¨bpmnç‰ˆæœ¬ä¸ºå½“å‰æœ€æ–°ç‰ˆ7.3.0</p>
<h2 id="contextpad">è‡ªå®šä¹‰ContextPad</h2>
<p>è‡ªå®šä¹‰ContextPadä¸è‡ªå®šä¹‰Paletteä¸€æ ·ï¼Œæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥é€‰æ‹©ï¼Œç¬¬ä¸€ç§å°±æ˜¯åŸºäºé»˜è®¤çš„ContextPadæ¥ä¿®æ”¹ï¼Œç¬¬äºŒç§å°±æ˜¯å®Œå…¨å†™ä¸ªæ–°çš„ContextPadæ¥æ›¿ä»£é»˜è®¤çš„ContextPadï¼ŒåŒæ ·çš„è¿™é‡Œå°±ä¸‹å®Œå…¨è‡ªå®šä¹‰ContextPadï¼Œå› ä¸ºä¸è‡ªå®šä¹‰Paletteé«˜åº¦ç›¸ä¼¼ï¼Œè¿™é‡Œä»¥å…·ä½“ä»£ç ä¸ºä¸»</p>
<p>1.åœ¨customç›®å½•ä¸‹æ–°å»º<code>CustomContextPadProvider.js</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹</p>
<pre class="codehilite"><code>import { assign } from &quot;min-dash&quot;;

export default function ContextPadProvider(
  config,
  injector,
  contextPad,
  modeling,
  elementFactory,
  connect,
  create,
  translate
) {
  this.modeling = modeling;
  this.elementFactory = elementFactory;
  this.connect = connect;
  this.create = create;
  this.translate = translate;
  config = config || {};

  if (config.autoPlace !== false) {
    this.autoPlace = injector.get(&quot;autoPlace&quot;, false);
  }

  contextPad.registerProvider(this);
}

ContextPadProvider.$inject = [
  &quot;config.contextPad&quot;,
  &quot;injector&quot;,
  &quot;contextPad&quot;,
  &quot;modeling&quot;,
  &quot;elementFactory&quot;,
  &quot;connect&quot;,
  &quot;create&quot;,
  &quot;translate&quot;
];

ContextPadProvider.prototype.getContextPadEntries = function (element) {
  const {
    autoPlace,
    create,
    elementFactory,
    translate,
    modeling,
    connect
  } = this;

  function appendAction(type, className, title, options) {
    function appendStart(event, element) {
      var shape = elementFactory.createShape(assign({ type: type }, options));
      create.start(event, shape, {
        source: element
      });
    }

    var append = autoPlace
      ? function (event, element) {
        var shape = elementFactory.createShape(
          assign({ type: type }, options)
        );
        autoPlace.append(element, shape);
      }
      : appendStart;

    return {
      group: &quot;model&quot;,
      className: className,
      title: title,
      action: {
        dragstart: appendStart,
        click: append
      }
    };
  }

  function removeElement(e) {
    modeling.removeElements([element]);
  }

  var actions = {};

  if (
    element.type === &quot;bpmn:UserTask&quot; ||
    element.type === &quot;bpmn:SequenceFlow&quot;
  ) {
    assign(actions, {
      edit: {
        group: &quot;edit&quot;,
        className: &quot;bpmn-icon-business-rule&quot;,
        title: translate(&quot;å±æ€§&quot;),
        action: {}
      }
    });
  }

  assign(actions, {
    delete: {
      group: &quot;edit&quot;,
      className: &quot;bpmn-icon-trash&quot;,
      title: translate(&quot;Remove&quot;),
      action: {
        click: removeElement
      }
    }
  });

  return actions;
};</code></pre>


<p>ä¸»è¦æ€è·¯ä¾ç„¶æ˜¯æ„å»ºæœ€ç»ˆè¾“å‡ºçš„å­—æ®µæ•°æ®ï¼Œå¯ä»¥æ ¹æ®ä¸åŒç±»å‹çš„shapeæ·»åŠ ä¸åŒçš„ContextPadï¼Œä»¥ä¸Šä»£ç å°±æ˜¯é»˜è®¤æ‰€æœ‰shapeéƒ½æœ‰åˆ é™¤æŒ‰é’®ï¼Œç„¶åç»™<code>UserTask</code>ç±»å‹çš„shapeå’Œè¿çº¿éƒ½æ·»åŠ äº†ä¸€ä¸ªåä¸ºâ€œå±æ€§â€çš„æŒ‰é’®</p>
<p>åŒæ ·çš„è¿™é‡Œæ‰€éœ€è¦çš„shapeæ•°æ®ä¹Ÿå¯ä»¥å‚è€ƒä¸Šç¯‡æ–‡ç« æœ€åç»™å‡ºçš„é‚£ä¸¤ä¸ªGithubæºç é“¾æ¥</p>
<p>2.åœ¨<code>custom/index.js</code>æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹å°†è‡ªå®šä¹‰çš„ContextPadå¯¼å‡º</p>
<pre class="codehilite"><code>import CustomContextPadProvider from &quot;./CustomContextPadProvider&quot;;

export default {
  __init__: [&quot;contextPadProvider&quot;],
  contextPadProvider: [&quot;type&quot;, CustomContextPadProvider]
};</code></pre>


<p>è¿™é‡Œåªæœ‰è‡ªå®šä¹‰<code>ContextPad</code>çš„é…ç½®ï¼Œå¦‚æœä½ æ˜¯æƒ³åœ¨è‡ªå®šä¹‰<code>Palette</code>çš„åŸºç¡€ä¸Šå†è‡ªå®šä¹‰<code>ContextPad</code>çš„è¯ï¼Œå°†ä»¥ä¸Šä»£ç ä¸åŸæœ¬çš„å†…å®¹æ•´åˆå³å¯</p>
<p>3.åœ¨<code>customModeler/index.js</code>æ–‡ä»¶ä¸­ç¼–å†™è‡ªå®šä¹‰çš„<code>CustomModeler</code>ç±»</p>
<pre class="codehilite"><code>import inherits from &quot;inherits&quot;;

import Viewer from &quot;bpmn-js/lib/Viewer&quot;;

import ZoomScrollModule from &quot;diagram-js/lib/navigation/zoomscroll&quot;;
import MoveCanvasModule from &quot;diagram-js/lib/navigation/movecanvas&quot;;

function CustomViewer(options) {
  Viewer.call(this, options);
}

inherits(CustomViewer, Viewer);

CustomViewer.prototype._modules = [].concat(Viewer.prototype._modules, [
  ZoomScrollModule,
  MoveCanvasModule
]);

export { CustomViewer };</code></pre>


<p>åŒæ ·çš„å¦‚æœä½ æƒ³åœ¨è‡ªå®šä¹‰<code>Palette</code>çš„åŸºç¡€ä¸Šå†è‡ªå®šä¹‰<code>ContextPad</code>ï¼Œåˆ™åœ¨ä¹‹å‰çš„ä»£ç åŸºç¡€ä¸Šä¸ä»¥ä¸Šä»£ç æ•´åˆ</p>
<p>4.åœ¨é¡µé¢ä¸Šå¼•ç”¨è‡ªå®šä¹‰çš„<code>CustomModeler</code>ä»¥æ›¿ä»£åŸæœ¬å¼•ç”¨çš„<code>BpmnModeler</code>ç±»ï¼Œè¿™æ ·å°±èƒ½ç”¨åˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„Paletteå•¦</p>
<pre class="codehilite"><code>import { xmlStr } from &quot;../mock/xmlStrPreview&quot;;
import { CustomModeler } from &quot;../components/customBpmn&quot;;

export default {
  ...
  methods: {
    init() {
      const canvas = this.$refs.canvas;
      this.bpmnModeler = new CustomModeler({
        container: canvas
      });
      this.createNewDiagram();
    },
    async createNewDiagram() {
      try {
        const result = await this.bpmnModeler.importXML(xmlStr);
        const { warnings } = result;
        console.log(warnings);
      } catch (err) {
        console.log(err.message, err.warnings);
      }
    }
  }
};</code></pre>


<p>æœ€ç»ˆæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img alt="" loading="lazy" src="/static/images/2020/1111.01.png" /></p>
<h2 id="_1">ç‚¹å‡»å¤„ç†</h2>
<p>bpmn.jsç»™èŠ‚ç‚¹å…³è”å±æ€§æ˜¯é€šè¿‡å³ä¾§é¢æ¿<code>Properties-panel</code>æ¥å®ç°çš„ï¼Œå…¶æ ¸å¿ƒæ˜¯å¯¹xmlæ–‡ä»¶çš„ä¿®æ”¹ï¼Œä½†æˆ‘ä»¬å¹¶æ²¡æœ‰è¿™æ ·ç”¨ï¼Œè€Œæ˜¯ç›´æ¥ç»™æ¯ä¸ªèŠ‚ç‚¹å…³è”ä¸€ä¸ªè¡¨å•ï¼Œè¿™ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰æ•°æ®éƒ½ä¿å­˜åœ¨è¿™ä¸ªè¡¨å•é‡Œï¼Œåå°å•ç‹¬å­˜äºæ•°æ®åº“ï¼Œè¿™é‡Œæ‰€è¯´çš„èŠ‚ç‚¹åŒ…å«å›¾å½¢shapeå’Œè¿çº¿SequenceFlowç­‰æµç¨‹å›¾é‡Œçš„å…ƒç´ ï¼ŒèŠ‚ç‚¹IDä¸è¡¨å•æ•°æ®ä¸€ä¸€å¯¹åº”</p>
<p>èŠ‚ç‚¹è¦å…³è”è¡¨å•æ•°æ®ï¼Œå°±éœ€è¦ç”¨åˆ°æˆ‘ä»¬ä¸Šè¾¹æ·»åŠ çš„åä¸ºâ€œå±æ€§â€çš„æŒ‰é’®ï¼Œå½“ç‚¹å‡»â€œå±æ€§â€æŒ‰é’®æ—¶å‡ºç°è¡¨å•ï¼Œå› ä¸ºä¸åŒç±»å‹çš„èŠ‚ç‚¹éœ€è¦å¼¹å‡ºä¸åŒçš„è¡¨å•ï¼Œæ‰€ä»¥åœ¨ç‚¹å‡»æŒ‰é’®ä¹‹åä¸»ç¨‹åºä¹Ÿéœ€è¦çŸ¥é“ç‚¹å‡»çš„èŠ‚ç‚¹ç±»å‹ç­‰æ•°æ®ï¼Œè¿™å°±æ¶‰åŠåˆ°äº†ç»„ä»¶é—´çš„æ•°æ®ä¼ é€’ï¼Œè¯•äº†å¾ˆå¤šæ–¹æ³•éƒ½ä¸è¡Œï¼Œæœ€ç»ˆåªèƒ½å€ŸåŠ©äºå€ŸåŠ©äº<code>store</code>æ¥å®ç°äº†ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹</p>
<p>1.åœ¨storeç›®å½•ä¸‹æ–°å»ºmodulesç›®å½•ï¼Œmodulesç›®å½•ä¸‹åˆ›å»ºæ¨¡å—åŒ–æ–‡ä»¶<code>bpmn.js</code>ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹</p>
<p><img alt="" loading="lazy" src="/static/images/2020/1111.02.png" /></p>
<p>2.åœ¨<code>bpmn.js</code>ä¸­ç¼–å†™å¦‚ä¸‹ä»£ç </p>
<pre class="codehilite"><code>const bpmn = {
  state: {
    nodeVisible: false,
    nodeInfo: {}
  },
  mutations: {
    TOGGLENODEVISIBLE: (state, visible) =&gt; {
      state.nodeVisible = visible;
    },
    SETNODEINFO: (state, info) =&gt; {
      state.nodeInfo = info;
    }
  },
  actions: {}
};

export default bpmn;</code></pre>


<p>æƒ³è¦äº†è§£ä»¥ä¸Šä»£ç çš„æ„æ€ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸‹Vuexçš„åŸºæœ¬æ€æƒ³ï¼šå½“æˆ‘ä»¬åœ¨é¡µé¢ä¸Šç‚¹å‡»äº†ä¸€ä¸ªæŒ‰é’®ï¼Œå®ƒä¼šè§¦å‘ä¸€ä¸ª<code>action</code>ï¼Œ<code>action</code>éšåä¼šæ‰§è¡Œä¸€ä¸ª<code>mutation</code>ï¼Œ<code>mutation</code>ä¼šå»æ”¹å˜<code>state</code>ï¼Œå½“<code>state</code>æ”¹å˜åé¡µé¢å°±èƒ½æ ¹æ®<code>state</code>æ¥è¿›è¡Œç›¸åº”çš„å¤„ç†äº†</p>
<p>ç„¶åå†æ¥çœ‹ä¸Šè¾¹çš„ä»£ç ï¼Œç”¨åˆ°äº†VuexåŸºæœ¬æ€æƒ³é‡Œè¾¹çš„<code>state</code>å’Œ<code>mutations</code>ï¼Œå…¶ä¸­<code>state</code>ä¸ºå•ä¸€çŠ¶æ€æ ‘ï¼Œç®€å•ç†è§£ä¸ºæˆ‘ä»¬å®šä¹‰çš„å˜é‡ï¼Œå…¨å±€å˜é‡ï¼Œå…¶ä»–ç»„ä»¶å¯ä»¥è·å–çš„åˆ°çš„å˜é‡ï¼Œè€Œæƒ³è¦ä¿®æ”¹<code>state</code>é‡Œå®šä¹‰çš„å˜é‡å°±å¿…é¡»é€šè¿‡<code>mutations</code>æ¥å®ç°ï¼Œ<code>mutations</code>å°±å®šä¹‰äº†ä¸¤ä¸ªäº‹ä»¶æ¥å¯¹åº”ä¿®æ”¹stateé‡Œçš„ä¸¤ä¸ªå˜é‡</p>
<p><code>state</code>é‡Œå®šä¹‰çš„ä¸¤ä¸ªå˜é‡åˆ†åˆ«ä¸ºç”¨æ¥è®°å½•è¡¨å•å±•ç¤ºçŠ¶æ€çš„<code>nodeVisible</code>ä»¥åŠç‚¹å‡»èŠ‚ç‚¹ä¿¡æ¯çš„<code>nodeInfo</code>ï¼Œé»˜è®¤æƒ…å†µä¸‹<code>nodeVisible</code>ä¸ºfalseï¼Œè¡¨ç¤ºè¡¨å•ä¸ºéšè—çŠ¶æ€ï¼Œå½“ç‚¹å‡»ContextPadçš„çš„â€œå±æ€§â€æŒ‰é’®æ—¶ä¿®æ”¹ä¸ºtrueï¼Œå±•ç¤ºè¡¨å•ï¼ŒåŒæ—¶ä¼šæŠŠç‚¹å‡»çš„èŠ‚ç‚¹ä¿¡æ¯èµ‹äºˆ<code>nodeInfo</code>ï¼Œè¿™ä¸ªåè¾¹ä»£ç ä¼šæœ‰å®ç°</p>
<p>æƒ³è¦å®šä¹‰çš„storeç”Ÿæ•ˆè¿˜éœ€è¦ä»¥ä¸‹ä¸¤æ­¥è¿›è¡ŒstoreæŒ‚è½½åŠå¼•ç”¨</p>
<p>3.<code>store/index.js</code>ä¸­ç¼–å†™å¦‚ä¸‹ä»£ç æŒ‚è½½store</p>
<pre class="codehilite"><code>import Vue from &quot;vue&quot;;
import Vuex from &quot;vuex&quot;;

import bpmn from &quot;./modules/bpmn&quot;;

Vue.use(Vuex);

export default new Vuex.Store({
  state: {},
  mutations: {},
  actions: {},
  modules: { bpmn }
});</code></pre>


<p>4.åœ¨<code>main.js</code>ä¸­å¼•å…¥store</p>
<pre class="codehilite"><code>import store from &quot;./store&quot;;

new Vue({
  store
}).$mount(&quot;#app&quot;);</code></pre>


<p>ä»¥ä¸Šå°±å®šä¹‰å¥½äº†storeï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä½¿ç”¨storeäº†ï¼Œé¦–å…ˆéœ€è¦å¤„ç†çš„æ˜¯ï¼Œå½“ç‚¹å‡»ContextPadé‡Œçš„â€œå±æ€§â€æŒ‰é’®æ—¶ï¼Œä¿®æ”¹storeé‡Œ<code>nodeVisible</code>å’Œ<code>nodeInfo</code>å€¼</p>
<p>5.ä¿®æ”¹<code>CustomContextPadProvider.js</code>æ–‡ä»¶ï¼Œç»™actionæ·»åŠ <code>click</code>æ–¹æ³•ï¼Œ<code>click</code>æ–¹æ³•ä¿®æ”¹storeé‡Œå®šä¹‰çš„state</p>
<pre class="codehilite"><code>function clickElement(e) {
  store.commit(&quot;SETNODEINFO&quot;, element);
  store.commit(&quot;TOGGLENODEVISIBLE&quot;, true);
}

if (
  element.type === &quot;bpmn:UserTask&quot; ||
  element.type === &quot;bpmn:SequenceFlow&quot;
) {
  assign(actions, {
    edit: {
      group: &quot;edit&quot;,
      className: &quot;bpmn-icon-business-rule&quot;,
      title: translate(&quot;å±æ€§&quot;),
      action: {
        click: clickElement
      }
    }
  });
}</code></pre>


<p>å¯¹storeçš„ä¿®æ”¹åªèƒ½é€šè¿‡<code>store.commit</code>æ¥å®ç°</p>
<p>6.æœ€ååœ¨é¡µé¢ä¸­å°±å¯ä»¥å€ŸåŠ©<code>computed</code>å’Œ<code>watch</code>æ¥å®ç°å¯¹storeé‡Œæ•°æ®çš„è·å–ä»¥åŠå¯¹é¡µé¢çš„å¤„ç†</p>
<pre class="codehilite"><code>export default {
  ...
  data() {
    return {
      userTask: false,
      scriptTask: false,
      sequenceFlow: &quot;&quot;,
      formData: {
        name: &quot;&quot;,
        type: &quot;&quot;
      }
    };
  },
  computed: {
    task: {
      get: function() {
        const that = this;
        const element = this.$store.state.bpmn.nodeInfo;

        if (element.businessObject) {
          if (element.businessObject.$type === &quot;bpmn:UserTask&quot;) {
            that.formData.type = &quot;ç”¨æˆ·ä»»åŠ¡&quot;;
            that.formData.name = element.businessObject.name;
            that.userTask = this.$store.state.bpmn.nodeVisible;
          }

          if (element.businessObject.$type === &quot;bpmn:SequenceFlow&quot;) {
            that.sequenceFlow = element.businessObject.name;
            that.scriptTask = this.$store.state.bpmn.nodeVisible;
          }
        }

        return false;
      },
      set: function(val) {
        this.$store.state.bpmn.nodeVisible = val;
      }
    }
  },
  watch: {
    task(val) {}
  }
};</code></pre>


<p>æœ€ç»ˆå®ç°çš„æ•ˆæœå¦‚ä¸‹</p>
<p><img alt="" loading="lazy" src="/static/images/2020/1111.03.png" /></p>
<p>ä½†è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å½“æˆ‘åœ¨è¡¨å•é‡Œä¿®æ”¹äº†èŠ‚ç‚¹åç§°ï¼Œä¹Ÿå°±æ˜¯èŠ‚ç‚¹çš„nameå±æ€§æ—¶ä¸ä¼šåŒæ­¥åˆ°å·¦ä¾§çš„æµç¨‹å›¾èŠ‚ç‚¹ä¸Šï¼Œé‚£è¯¥å¦‚ä½•å®ç°åŒæ­¥å‘¢ï¼Ÿä¹Ÿå¾ˆç®€å•ï¼Œä¿®æ”¹ä¸‹watchå³å¯</p>
<pre class="codehilite"><code>watch: {
  task(val) {},
  userTask(val) {
    this.$store.state.bpmn.nodeVisible = val;
  },
  sequenceFlow(val) {
    const element = this.$store.state.bpmn.nodeInfo;
    const modeling = this.bpmnModeler.get(&quot;modeling&quot;);
    modeling.updateLabel(element, val);
  },
  &quot;formData.name&quot;: {
    handler(val, old) {
      const element = this.$store.state.bpmn.nodeInfo;
      const modeling = this.bpmnModeler.get(&quot;modeling&quot;);
      modeling.updateLabel(element, val);
    },
    deep: true
  }
}</code></pre>


<p>è·å–storeé‡Œçš„å€¼ç„¶åé€šè¿‡<code>modeling.updateLabel</code>æ–¹æ³•æ¥æ›´æ–°èŠ‚ç‚¹çš„åç§°ï¼Œè‡³æ­¤é—®é¢˜å®Œç¾è§£å†³</p>
<h2 id="_2">å†™åœ¨æœ€å</h2>
<p>æ¥è§¦bpmn-jsä¸ä¹…ï¼Œä¸”ç¬¬ä¸€æ¬¡ç”¨VUEï¼Œè¾¹å­¦è¾¹å†™ï¼Œæ–‡ç« éš¾å…å‡ºé”™ï¼Œå„ä½å¤šå¤šåŒ…å«ã€‚bmpnç³»åˆ—çš„æ–‡ç« å·²ç»å†™äº†å…­ç¯‡ï¼Œè‡³æ­¤æˆ‘ä»¬çš„ä½¿ç”¨å·²ç»åŸºæœ¬åˆ°æ­¤ï¼Œæ„Ÿè°¢å„ä½å°ä¼™ä¼´çš„æ”¯æŒã€‚é™¤äº†è¿™å‡ ç¯‡æ–‡ç« å¤–ï¼Œæˆ‘è¿˜åˆ›å»ºäº†BPMNçš„ä¸»é¡µï¼š<a href="https://blog.ops-coffee.com/bpmn" target="_blank">https://blog.ops-coffee.com/bpmn</a>å†…å®¹æ›´ä¸ºä¸°å¯Œï¼ŒåŒ…å«äº†ä¸€äº›è¿™ç³»åˆ—æ–‡ç« ä¸­æ²¡æœ‰çš„å†…å®¹ï¼Œä¾‹å¦‚APIåˆ—è¡¨ã€ICONåˆ—è¡¨ç­‰ï¼Œæ¬¢è¿æŸ¥çœ‹</p>
<p>éƒ¨åˆ†å°ä¼™ä¼´å¯¹æµç¨‹ç¼–è¾‘å™¨ä¸äº†è§£ï¼Œæˆ–æ˜¯å¯¹BPMNä¸äº†è§£ï¼Œæˆ‘æ­å»ºäº†ä¸ªåœ¨çº¿çš„Demo: <a href="https://bpmn.ops-coffee.com" target="_blank">https://bpmn.ops-coffee.com</a>ï¼Œç‚¹å‡»é“¾æ¥å³å¯è½»æ¾ä½“éªŒï¼Œå»ºè®®PCç«¯æ‰“å¼€æ•ˆæœæ›´å¥½</p>

        <div>
          <ul style="display: inline-block;padding: 0;margin: 0 0 0.5em;color: #999;">
            <li style="display: inline-block;margin: 0 1em 0 0;"><a href="/bpmn/bpmn-js-vue-custom-contextpad-demo-code-source.html">ğŸ“… 2020-11-11</a></li>
<li style="display: inline-block;margin: 0 1em 0 0;"><a href="/tag/å…³äºæŠ€æœ¯/">ğŸ·ï¸ å…³äºæŠ€æœ¯</a></li>          </ul>
        </div>

        <hr>

        <div class="pagination">
            <a href="https://blog.ops-coffee.com/bpmn/bpmn-js-modeling-api-cn.html" class="pagination-item prev-page">
                <span class="pagination-arrow">â†</span>
                <span class="pagination-text">ä¸Šä¸€ç¯‡ï¼š<br>bpmn.js Modeling API åˆ—è¡¨</span>
            </a>
            <a href="https://blog.ops-coffee.com/bpmn/bpmn-js-minimap.html" class="pagination-item next-page">
                <span class="pagination-text">ä¸‹ä¸€ç¯‡ï¼š<br>æœ€å¥½ç”¨çš„æµç¨‹ç¼–è¾‘å™¨bpmn-jsç³»åˆ—ä¹‹minimap</span>
                <span class="pagination-arrow">â†’</span>
            </a>
        </div>

        <div class="nav-cell">
    <script async src="https://giscus.app/client.js"
            data-repo="ops-coffee/blog" data-repo-id="MDEwOlJlcG9zaXRvcnkxNDY4OTI0MTg="
            data-category="Announcements" data-category-id="DIC_kwDOCMFmgs4CQar3"
            data-mapping="pathname" data-strict="0" data-reactions-enabled="1"
            data-emit-metadata="0" data-input-position="top" data-theme="light"
            data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous">
    </script>
</div>

        <div>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8944257246828217"
         data-ad-slot="6731434232" data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</div>

        <div class="nav-cell">
            <p class="nav-list-title">èƒ½çœ‹åˆ°è¿™é‡Œä¸€å®šæ˜¯çœŸçˆ±ï¼Œè®¢é˜…ä¸€ä¸‹å§</p>
            <img alt="" loading="lazy" src="/static/images/wx.sou1.png" />
        </div>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <div class="copy"> Â© ops-coffee</div>

      <div class="link">
        <a href="/comments.html" title="ç»™æˆ‘ç•™è¨€" target="_blank">ç•™è¨€</a>
        <a href="/friends.html" title="å‹æƒ…é“¾æ¥" target="_blank">å‹é“¾</a>
      </div>
    </div>
  </footer>
  
  <!-- Umami -->
<script defer src="https://umami.opendevops.cn/script.js" data-website-id="a4aabd8e-32c7-40e7-a81c-119b909f2d0f"></script>

<!-- Google Adsense -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8944257246828217" crossorigin="anonymous"></script>
</body>
</html>