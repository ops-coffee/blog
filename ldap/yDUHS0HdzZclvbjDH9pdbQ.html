<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="applicable-device" content="pc,mobile">
  <meta name="keywords" content="LDAP,GitLab,OpenLDAP,SVN,LDAP,Git,è¿ç»´,è¿ç»´åšå®¢,è¿ç»´å¼€å‘,è‡ªåŠ¨åŒ–,äº‘è®¡ç®—,ops,sre,linux,devops,cloud" />
  <meta name="description" content="LDAPè½åœ°å®æˆ˜ï¼ˆä¸‰ï¼‰ï¼šGitLabé›†æˆOpenLDAPè®¤è¯" />
  <link rel="stylesheet" href="https://static.opendevops.cn/static/posts/css/ops-coffee.min.css" type="text/css" />
  <link rel="shortcut icon" href="/static/images/favicon.ico" />

  <!-- Begin SEO tag -->
  <title>LDAPè½åœ°å®æˆ˜ï¼ˆä¸‰ï¼‰ï¼šGitLabé›†æˆOpenLDAPè®¤è¯</title>
  <meta property="og:locale" content="zh_CN" />
  <meta property="og:site_name" content="è¿ç»´å’–å•¡å§" />
  <meta property="og:url" content="https://blog.ops-coffee.cn" />
  <meta property="og:title" content="LDAPè½åœ°å®æˆ˜ï¼ˆä¸‰ï¼‰ï¼šGitLabé›†æˆOpenLDAPè®¤è¯" />
  <meta property="og:description" content="LDAPè½åœ°å®æˆ˜ï¼ˆä¸‰ï¼‰ï¼šGitLabé›†æˆOpenLDAPè®¤è¯" />
  <link rel="canonical" href="https://blog.ops-coffee.cn" />
  <!-- End SEO tag -->

  <!-- Umami Cloud -->
  <script async src="https://umami.ops-coffee.cn/script.js" data-website-id="a4aabd8e-32c7-40e7-a81c-119b909f2d0f"></script>

  <!-- Google Adsense -->
  <script data-ad-client="ca-pub-8944257246828217" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>

<body>
  <header>
    <div class="container">
      <a href="https://blog.ops-coffee.cn">
        <h1>è¿ç»´å’–å•¡å§</h1>
      </a>
      <h2>äº«å—æŠ€æœ¯å¸¦æ¥çš„ä¹è¶£ï¼Œä½“éªŒç”Ÿæ´»ç»™äºˆçš„æ„ŸåŠ¨</h2>
    </div>
  </header>

  <div id="content-wrap">
    <div class="container">
        <h1 id="art-title">LDAPè½åœ°å®æˆ˜ï¼ˆä¸‰ï¼‰ï¼šGitLabé›†æˆOpenLDAPè®¤è¯</h1>

        <blockquote>
<p>ä¸Šä¸€ç¯‡æ–‡ç« ä»‹ç»äº†SVNé›†æˆOpenLDAPè®¤è¯ï¼Œç‰ˆæœ¬æ§åˆ¶é™¤äº†SVNå¤–ï¼ŒGitç›®å‰ä¹Ÿè¢«è¶Šæ¥è¶Šå¤šçš„å¼€å‘è€…æ‰€å–œçˆ±ï¼Œæœ¬æ–‡å°†ä»‹ç»GitLabå¦‚ä½•é›†æˆOpenLDAPå®ç°è´¦å·è®¤è¯</p>
</blockquote>
<h1 id="gitlab">GitLabé…ç½®</h1>
<ol>
<li>ä¿®æ”¹é…ç½®æ–‡ä»¶gitlab.yml</li>
</ol>
<pre class="codehilite"><code>ldap:
enabled: true
servers:
  main: 
    label: 'LDAP'

    host: 'ldap.ops-coffee.cn'
    port: 389
    uid: 'uid'
    method: 'plain'
    bind_dn: 'uid=authz,ou=Public,dc=ops-coffee,dc=cn'
    password: 'ImNVZODT884'

    timeout: 10

    active_directory: false
    allow_username_or_email_login: false

    block_auto_created_users: false

    base: 'dc=ops-coffee,dc=cn'
    user_filter: ''</code></pre>


<ol>
<li>é‡å¯GitLabæœåŠ¡ï¼Œçœ‹åˆ°é¡µé¢å·²ç»æœ‰LDAPçš„ç™»å½•é€‰é¡¹äº† </li>
</ol>
<p><img alt="" loading="lazy" src="/static/images/20180701.gitlab.png" /></p>
<h2 id="_1">é‡è¦é…ç½®å‚æ•°è§£é‡Š</h2>
<p>ä»”ç»†é˜…è¯»ä¸Šä¸€ç¯‡svné›†æˆLDAPè®¤è¯çš„æ–‡ç« è¿™äº›å‚æ•°ä¼šæ›´å¥½ç†è§£</p>
<ul>
<li><strong>host</strong>ï¼šLDAPæœåŠ¡å™¨åœ°å€</li>
<li><strong>port</strong>ï¼šLDAPæœåŠ¡ç«¯å£</li>
<li><strong>uid</strong>ï¼šä»¥å“ªä¸ªå±æ€§ä½œä¸ºéªŒè¯å±æ€§ï¼Œå¯ä»¥ä¸ºuidã€cnç­‰ï¼Œæˆ‘ä»¬ä½¿ç”¨uid</li>
<li><strong>method</strong>ï¼šå¦‚æœå¼€å¯äº†tlsæˆ–sslåˆ™å¡«å†™å¯¹åº”çš„tlsæˆ–sslï¼Œéƒ½æ²¡æœ‰å°±å¡«å†™plain</li>
<li><strong>bind_dn</strong>ï¼šsearchæœç´¢è´¦å·ä¿¡æ¯çš„ç”¨æˆ·å®Œæ•´bindï¼ˆéœ€è¦ä¸€ä¸ªæœ‰readæƒé™çš„è´¦å·éªŒè¯é€šè¿‡åæœç´¢ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åæ˜¯å¦å­˜åœ¨ï¼‰</li>
<li><strong>password</strong>ï¼šbind_dnç”¨æˆ·çš„å¯†ç ï¼Œ<code>bind_dn</code>å’Œ<code>password</code>ä¸¤ä¸ªå‚æ•°ç™»å½•LDAPæœåŠ¡å™¨æœç´¢ç”¨æˆ·</li>
<li><strong>active_directory</strong>ï¼šLDAPæœåŠ¡æ˜¯å¦æ˜¯windowsçš„ADï¼Œæˆ‘ä»¬æ˜¯ç”¨çš„OpenLDAPï¼Œè¿™é‡Œå†™false</li>
<li><strong>allow_username_or_email_login</strong>ï¼šæ˜¯å¦å…è®¸ç”¨æˆ·åæˆ–è€…é‚®ç®±è®¤è¯ï¼Œå¦‚æœæ˜¯åˆ™ç”¨æˆ·è¾“å…¥ç”¨æˆ·åæˆ–é‚®ç®±éƒ½å¯</li>
<li><strong>base</strong>ï¼šä»å“ªä¸ªä½ç½®æœç´¢ç”¨æˆ·ï¼Œä¾‹å¦‚å…è®¸ç™»å½•GitLabçš„ç”¨æˆ·éƒ½åœ¨ou gitlabé‡Œï¼Œnameè¿™é‡Œå¯ä»¥å†™<code>ou=gitlab,dc=domain,dc=com</code></li>
<li><strong>filter</strong>ï¼šæ·»åŠ è¿‡æ»¤å±æ€§ï¼Œä¾‹å¦‚åªè¿‡æ»¤employeeTypeä¸ºdeveloperçš„ç”¨æˆ·è¿›è¡Œè®¤è¯ï¼Œå¯ä»¥è®¾ç½®<code>employeeType=developer</code></li>
</ul>
<h2 id="_2">æŠ¥é”™å¤„ç†</h2>
<p>å½“é‡å¯å®Œæˆåç™»é™†æŠ¥ï¼š<code>Could not authenticate you from Ldapmain because "Invalid credentials"</code></p>
<p>æŸ¥æ—¥å¿—æœ‰å¦‚ä¸‹æŠ¥é”™ï¼š<code>(LDAP) Error saving user: ["Email is not whitelisted. Email domains valid for registration are: domain.com"]</code></p>
<p>Emailä¸åœ¨ç™½åå•ï¼Ÿï¼Ÿä»”ç»†æƒ³äº†ä¸€ä¸‹åŸå› ï¼š</p>
<ol>
<li>GitLabä¹‹å‰ä¸ºäº†å®‰å…¨é…ç½®äº† Restricted domains for sign-upsåªå…è®¸domain.comé‚®ç®±çš„ç”¨æˆ·æ³¨å†Œ</li>
<li>è€Œæˆ‘OpenLDAPåœ¨æ–°å»ºç”¨æˆ·çš„æ—¶å€™é‚®ç®±æ²¡æœ‰å¡«å†™ä¸ºç©º</li>
</ol>
<p>æˆ–è®¸å°±æ˜¯è¿™ä¸ªé—®é¢˜äº†ï¼Œç™»å½•lamå°†ç”¨æˆ·çš„é‚®ç®±å­—æ®µè¡¥ä¸Šï¼ˆéœ€ç¬¦åˆç™½åå•è§„åˆ™ï¼‰é‡æ–°ç™»å½•ä¾¿æ­£å¸¸äº†</p>

        <div>
          <ul style="display: inline-block;padding: 0;margin: 0 0 0.5em;color: #999;">
            <li style="display: inline-block;margin: 0 1em 0 0;"><a href="/ldap/yDUHS0HdzZclvbjDH9pdbQ.html">ğŸ“… 2018-07-01</a></li>
            <li style="display: inline-block;margin: 0 1em 0 0;"><a href="/tag/OpenLDAP/">ğŸ·ï¸ OpenLDAP</a></li>
          </ul>
        </div>

        <hr>

        <div class="nav-cell clearfix">
            <script src="https://giscus.app/client.js"
                    data-repo="ops-coffee/blog"
                    data-repo-id="MDEwOlJlcG9zaXRvcnkxNDY4OTI0MTg="
                    data-category="Announcements"
                    data-category-id="DIC_kwDOCMFmgs4CQar3"
                    data-mapping="pathname"
                    data-strict="0"
                    data-reactions-enabled="1"
                    data-emit-metadata="0"
                    data-input-position="top"
                    data-theme="light"
                    data-lang="zh-CN"
                    data-loading="lazy"
                    crossorigin="anonymous"
                    async>
            </script>
        </div>

        <div>
            <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-8944257246828217"
                 data-ad-slot="6731434232"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>

        <div class="nav-cell clearfix">
            <p class="nav-list-title">èƒ½çœ‹åˆ°è¿™é‡Œä¸€å®šæ˜¯çœŸçˆ±ï¼Œå…³æ³¨ä¸€ä¸‹å§</p>
            <img alt="" loading="lazy" src="/static/images/wx.sou1.png" />
        </div>
    </div>
  </div>

  <footer class="footer">
    <div class="container clearfix">
      <div class="copy"> Â© ops-coffee</div>

      <div class="link">
        <a href="/" target="_blank">å…³äºæœ¬ç«™</a>
        <a href="/" target="_blank">å›åˆ°é¦–é¡µ</a>
      </div>
    </div>
  </footer>
</body>
</html>