<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="applicable-device" content="pc,mobile">
  <meta name="keywords" content="Datatables,前端插件,关于技术" />
  <meta name="description" content="工欲善其事，必先利其器" />
  <link rel="alternate" type="application/rss+xml" title="运维咖啡吧" href="https://blog.ops-coffee.cn/feed.xml" />
  <link rel="stylesheet" href="https://blog.ops-coffee.cn/static/posts/css/ops-coffee.min.css" type="text/css" />

  <!-- Begin SEO tag -->
  <title>前端插件之Datatables使用--下篇</title>
  <meta property="og:locale" content="zh_CN" />
  <meta property="og:site_name" content="运维咖啡吧" />
  <meta property="og:url" content="https://blog.ops-coffee.cn" />
  <meta property="og:title" content="前端插件之Datatables使用--下篇" />
  <meta property="og:description" content="工欲善其事，必先利其器" />
  <link rel="canonical" href="https://blog.ops-coffee.cn" />
  <!-- End SEO tag -->
</head>

<body>
  <div class="header">
    <div class="container">
      <nav class="header-site">
        <ul>
          <li><a href="/">首页</a></li>
            <li class="has-submenu">
              <a href="#" target="_self">运维</a>
              <ul class="sub-menu">
                <li><a href="/tag/系统运维/" target="_self">系统运维</a></li>
                <li><a href="/elk/index.html" target="_self">ELK系列</a></li>
                <li><a href="/ldap/index.html" target="_self">LDAP系列</a></li>
              </ul>
            </li>
            <li class="has-submenu">
              <a href="#" target="_self">开发</a>
              <ul class="sub-menu">
                <li><a href="/tag/Devops/" target="_self">DevOps</a></li>
                <li><a href="/tag/Python/" target="_self">Python</a></li>
                <li><a href="/tag/Django/" target="_self">Django</a></li>
                <li><a href="/bpmn/index.html" target="_self">BPMN系列</a></li>
                <li><a href="/webssh/index.html" target="_self">WebSSH系列</a></li>
                <li><a href="/frontend/index.html" target="_self">前端开发系列</a></li>
              </ul>
            </li>
            <li><a href="/devops.html" target="_self">运维平台</a></li>
            <li><a href="/tag/这是生活/" target="_self">这是生活</a></li>
            <li class="has-submenu">
              <a href="#" target="_self">房车旅行</a>
              <ul class="sub-menu">
                <li><a href="/r/index.html" target="_self">房车体验</a></li>
                <li><a href="/travels.html" target="_self">旅行游记</a></li>
              </ul>
            </li>
            <li><a href="/tag/index.html" target="_self">标签</a></li>
            <li><a href="/archive.html" target="_self">归档</a></li>
        </ul>
      </nav>
    </div>
  </div>

  <header>
    <div class="container">
      <a href="/">
        <h1>运维咖啡吧</h1>
        <h2>享受技术带来的乐趣，体验生活给予的感动</h2>
      </a>
    </div>
  </header>

  <div id="content-wrap">
    <div class="container no-sidebar">
        <h1 id="art-title">前端插件之Datatables使用--下篇</h1>

        <blockquote>
<p>工欲善其事，必先利其器</p>
</blockquote>
<p>本系列文章介绍我在运维系统开发过程中用到的那些顺手的前端插件，上一篇文章介绍了<a href="https://blog.ops-coffee.cn/frontend/front-end-components-jquery-datatables-1" target="_blank">Datatables插件</a>的基本使用，这一篇文章作为上一篇的延续，会介绍Databases的一些高级用法，例如从不同的数据源获取数据、修改数据最终呈现方式、操作Dom改变页面功能、开启服务端数据处理等</p>
<h2 id="_1">数据加载</h2>
<p>上篇文章中的所有数据都是直接渲染的html中的table数据，datatables还支持其他几种数据源，以方便实现更灵活的控制</p>
<h3 id="_2">从数组中获取</h3>
<pre class="codehilite"><code>&lt;table id=&quot;myTable-x&quot; class=&quot;display&quot; style=&quot;width:100%&quot;&gt;&lt;/table&gt;

$(document).ready(function() {
    var dataSet = [
      [&quot;3&quot;,&quot;https://ops-coffee.cn&quot;,&quot;2018-07-03&quot;],
      [&quot;9&quot;,&quot;https://demo.ops-coffee.cn&quot;, &quot;2019-08-06&quot;],
    ];

    $('#myTable-x').DataTable({
        &quot;data&quot;: dataSet,
        &quot;columns&quot;: [
          { title: &quot;Id&quot; },
          { title: &quot;Site&quot; },
          { title: &quot;Date&quot; },
        ]
    })
});</code></pre>


<p><strong>data：</strong> 指定数组</p>
<p><strong>columns：</strong> 配置每一列的title</p>
<p>注意：从数组中获取数据一定要有表头，如果没有则可能会报下边的错：</p>
<pre class="codehilite"><code>Uncaught TypeError: Cannot read property 'aDataSort' of undefined</code></pre>


<p>解决方法就是datatables添加<code>columns</code>配置，或者写上table的thead</p>
<pre class="codehilite"><code>&lt;table id=&quot;myTable-x&quot; class=&quot;display&quot; style=&quot;width:100%&quot;&gt;
    &lt;thead&gt;
        &lt;tr&gt;
            &lt;th&gt;ID&lt;/th&gt;
            &lt;th&gt;Site&lt;/th&gt;
            &lt;th&gt;Date&lt;/th&gt;
        &lt;/tr&gt;
    &lt;/thead&gt;
&lt;/table&gt;</code></pre>


<h3 id="_3">从对象中获取</h3>
<pre class="codehilite"><code>&lt;table id=&quot;myTable-x&quot; class=&quot;display&quot; style=&quot;width:100%&quot;&gt;&lt;/table&gt;

$(document).ready(function() {
    var dataSet = [
      {&quot;Id&quot;:&quot;3&quot;,&quot;Site&quot;:&quot;https://ops-coffee.cn&quot;,&quot;Date&quot;:&quot;2018-07-03&quot;},
      {&quot;Id&quot;:&quot;9&quot;,&quot;Site&quot;:&quot;https://demo.ops-coffee.cn&quot;,&quot;Date&quot;:&quot;2019-08-06&quot;},
    ];

    $('#myTable-x').DataTable({
        &quot;data&quot;: dataSet,
        &quot;columns&quot;: [
          {&quot;data&quot;: &quot;Id&quot;, &quot;title&quot;: &quot;Id&quot;},
          {&quot;data&quot;: &quot;Site&quot;, &quot;title&quot;: &quot;Site&quot;},
          {&quot;data&quot;: &quot;Date&quot;, &quot;title&quot;: &quot;Date&quot;},
        ]
    })
});</code></pre>


<p>使用对象数组，一定要配置columns的<code>data</code>，告诉DataTables每列对应的属性，<code>title</code>配置可选，添加title会给表格添加表头</p>
<h3 id="_4">从实例中获取</h3>
<pre class="codehilite"><code>$(document).ready(function() {
    function dataSet(id, site, date) {
      this.id = id;
      this.site = site;
      this.date = date;
    };

    $('#myTable-x').dataTable({
      data: [
        new dataSet(&quot;3&quot;, &quot;https://ops-coffee.cn&quot;, &quot;2018-07-03&quot;),
        new dataSet(&quot;9&quot;, &quot;https://demo.ops-coffee.cn&quot;, &quot;2019-08-06&quot;),
      ],
      columns: [
          {&quot;data&quot;: &quot;id&quot;, &quot;title&quot;:&quot;Id&quot;},
          {&quot;data&quot;: &quot;site&quot;, &quot;title&quot;:&quot;Site&quot;},
          {&quot;data&quot;: &quot;date&quot;, &quot;title&quot;:&quot;Date&quot;}
      ]
    });
});</code></pre>


<h3 id="ajax">Ajax异步获取</h3>
<p>Datatables还支持Ajax的方式异步加载数据，简单的方式是直接配置一个url地址即可</p>
<pre class="codehilite"><code>$(document).ready(function() {
    $('#myTable-x').dataTable({
        &quot;ajax&quot;: 'sdata.json'
    });
});</code></pre>


<p>ajax接收的数据可以是数组或者对象，注意<code>columns</code>的配置，可以对应参考前文两种格式数据的处理</p>
<p><img alt="" loading="lazy" src="/static/images/2019/0807.datatables02.png" /></p>
<h2 id="_5">结果数据处理</h2>
<p>上边的table可以发现有个site列的内容是一个网址，如果我们想让网址能够点击该如何实现呢？可以利用<code>columns</code>的<code>render</code>属性对展示结果进行更改</p>
<pre class="codehilite"><code>$(document).ready(function() {
    $('#myTable-x').dataTable({
        &quot;ajax&quot;: 'sdata.json',
        &quot;columns&quot;: [
            {&quot;data&quot;: &quot;id&quot;, &quot;title&quot;:&quot;Id&quot;},
            {
                &quot;data&quot;: &quot;site&quot;, 
                &quot;title&quot;:&quot;Site&quot;,
                &quot;render&quot;: function (data, type, row) {
                  return '&lt;a href='+data+' target=&quot;_blank&quot;&gt;'+data+'&lt;/a&gt;'
                }
            },
            {&quot;data&quot;: &quot;date&quot;, &quot;title&quot;:&quot;Date&quot;}
        ]
    });
});</code></pre>


<p>render后边跟了个函数，每当数据表需要获取列中某个单元格的数据时<code>render</code>函数都会执行，且函数可能会被执行多次，函数默认接收三个参数，意思分别是：</p>
<p><strong>data：</strong> 单元格的具体数据，例如<code>https://ops-coffee.cn</code></p>
<p><strong>type：</strong> 标识了这一次调用的请求类型，会有<code>filter</code>、<code>display</code>、<code>type</code>、<code>sort</code></p>
<p><strong>row：</strong> 这一行的完整数据源，如果像Demo示例传了对象数据，那么可以通过<code>row.site</code>获取到这一行site列的数据</p>
<p>拿到参数进行一系列的处理后可以通过<code>return</code>返回最终想要展示的内容</p>
<p>当然也可以通过<code>columns</code>在表格末尾添加一列以实现编辑、删除的按钮展示</p>
<pre class="codehilite"><code>&quot;columns&quot;: [
    {&quot;data&quot;: &quot;id&quot;, &quot;title&quot;:&quot;Id&quot;},
    {
        &quot;data&quot;: &quot;site&quot;, 
        &quot;title&quot;:&quot;Site&quot;,
        &quot;render&quot;: function (data, type, row) {
          return '&lt;a href='+data+' target=&quot;_blank&quot;&gt;'+data+'&lt;/a&gt;'
        }
    },  
    {&quot;data&quot;: &quot;date&quot;, &quot;title&quot;:&quot;Date&quot;},
    {   
      &quot;data&quot;: &quot;id&quot;,
      &quot;title&quot;: &quot;操作&quot;,
      &quot;render&quot;: function (data, type, row) {
        return '&lt;a href=&quot;#update/'+row.id+'/&quot; class=&quot;btn btn-warning btn-sm&quot;&gt;编辑&lt;/a&gt; ' +
               '&lt;a href=&quot;#delete/'+row.id+'/&quot; class=&quot;btn btn-danger btn-sm&quot;&gt;删除&lt;/a&gt;'
      } 
    }   
]</code></pre>


<p>最终呈现结果如下图</p>
<p><img alt="" loading="lazy" src="/static/images/2019/0807.datatables03.png" /></p>
<h2 id="dom">Dom操作</h2>
<p>如果我不需要datatables显示左上角的每页显示条数信息，而要换成一个添加按钮改怎么做呢？这里可以借助datatables的dom来实现</p>
<p>默认情况下表格都会有左上角的每页显示条数、右上角的搜索、左下角的表格信息、右下角的分页、中间的数据加载等待以及表格本身，这些都是datatables的DOM，它们实际上就是一个div包裹起来的select、input之类的html标签，datatables中的每个DOM都与一个字母相对应，他们的对应关系如下：</p>
<p><strong>l：</strong> length，代表左上角的每页显示条数控件</p>
<p><strong>f：</strong> filtering，代表右上角的搜索控件</p>
<p><strong>t：</strong> table，代表表格本身</p>
<p><strong>i：</strong> information，代表左下角的表格信息控件</p>
<p><strong>p：</strong> pagination，代表右下角的分页控件</p>
<p><strong>r：</strong> processing，代表中间数据加载等待提示控件</p>
<p>这些控件在datatables里可以通过配置<code>dom</code>来控制他们的显示位置，以及是否显示，默认的显示顺序是<code>lfrtip</code></p>
<pre class="codehilite"><code>$('#myTable-x').dataTable({
    &quot;dom&quot;: 'lfrtip'
})</code></pre>


<p>你如果不想显示某个控件，可以通过去掉<code>dom</code>配置项里对应的字母实现，同时Datatables支持四个自定义的标签，通过这四个标签可以方便的来修改DOM的展示</p>
<p><code>&lt; &gt;</code> 尖括号就代表html里的div</p>
<p><code>&lt;"class"&gt;</code> 代表了添加了class的div</p>
<p><code>&lt;"#id"&gt;</code> 代表了添加了id的div</p>
<p><code>&lt;"#id.class"&gt;</code> 代表添加了id和class的div</p>
<p>我们想把右上角的每页显示条数控件换成添加按钮的话可以这样写</p>
<pre class="codehilite"><code>$('#myTable-x').dataTable({
    &quot;dom&quot;: '&lt;&quot;#add-btn.toolbar&quot;&gt;frtip'
})

$(&quot;#add-btn.toolbar&quot;).html(
  '&lt;button href=&quot;#add&quot; class=&quot;btn btn-success btn-sm&quot;&gt; + 添加&lt;/button&gt;'
)</code></pre>


<p>遇到样式问题，需要添加css</p>
<pre class="codehilite"><code>&lt;style type=&quot;text/css&quot;&gt;
  .toolbar {float:left}
&lt;/style&gt;</code></pre>


<p>这样就完美实现了</p>
<p><img alt="" loading="lazy" src="/static/images/2019/0807.datatables04.png" /></p>
<h2 id="_6">服务器端处理</h2>
<p>Datatables支持使用服务端进行数据处理，当开启服务端数据处理后，Datatables将在页面执行分页、排序、搜索等操作时向服务端发出Ajax请求，Ajax请求会传递许多变量给服务端，服务端接收到请求后根据变量的值对数据进行处理，处理完成按照固定的格式返回给前端页面，页面对返回的数据进行渲染提供给用户查看</p>
<p>开启服务器模式只需要两个设置项<code>serverSide</code>和<code>ajax</code></p>
<pre class="codehilite"><code>$('#myTable-x').dataTable({
    &quot;serverSide&quot;: true,
    &quot;processing&quot;: true,
    &quot;ajax&quot;: '/api/site/data'
})</code></pre>


<p><strong>serverSide：</strong> 为true时表示开启服务端处理模式</p>
<p><strong>processing：</strong> 为true时会开启数据处理中的提示，非必须</p>
<p><strong>ajax：</strong> 指定服务器端的地址，可以像上边一样是个字符串，也可以像jQuery.ajax一样作为一个对象使用，例如我想传递额外的参数（datatables默认会给后端传递许多的参数，下边有讲）给后端服务器的话，可以这样用</p>
<pre class="codehilite"><code>$('#myTable-x').dataTable({
    &quot;serverSide&quot;: true,
    &quot;processing&quot;: true,
    &quot;ajax&quot;: {
        &quot;url&quot;: &quot;/api/site/data&quot;,
        &quot;data&quot;: function (d) {
            d.type = 'ops-coffee';
        }
    }
})</code></pre>


<p><strong>data：</strong> 可以在发送请求给后端时额外增加<code>type=ops-coffee</code>的参数</p>
<h3 id="_7">发送到服务器端的参数</h3>
<p>当开启服务端数据处理后，默认会给服务端传递许多参数，大概如下：</p>
<pre class="codehilite"><code>draw：绘制计数器，主要用来确保Ajax从服务器端接收到的数据是对应同一次请求的
start：第一条数据的起始位置
length：每页显示的条数
search[value]：全局的检索关键字
order[i][column]：告诉服务器哪些列是需要排序的，i为排序列的序号，下边的i相同含义，注意i是从0开始的
order[i][dir]：告诉服务器排序的方式&quot;desc&quot;,&quot;asc&quot;
columns[i][data]：columns上定义的data属性值
columns[i][name]：columns上定义的name属性值
columns[i][searchable]：告诉服务器哪些列可以被搜索
columns[i][orderable]：告诉服务器哪些列可以进行排序
columns[i][search][value]：告诉服务器某些列的具体搜索条件</code></pre>


<p>如果需要后台分页，那么需要拿到<code>start</code>、<code>length</code>两个参数做相应的处理，</p>
<p>如果有搜索的内容，那么需要拿到<code>serch[value]</code>参数做处理</p>
<h3 id="_8">服务端返回数据的格式</h3>
<p>服务端需要返回datatables可以处理的数据格式，具体数据格式如下：</p>
<pre class="codehilite"><code>{
    &quot;draw&quot;: 1,
    &quot;recordsTotal&quot;: 7,
    &quot;recordsFiltered&quot;: 7,
    &quot;data&quot;: [
        {
            &quot;id&quot;: 3,
            &quot;site&quot;: &quot;https://ops-coffee.cn&quot;,
            &quot;date&quot;: &quot;2018-07-03&quot;
        },
        {
            &quot;id&quot;: 9,
            &quot;site&quot;: &quot;https://demo.ops-coffee.cn&quot;,
            &quot;date&quot;: &quot;2019-08-06&quot;
        }
        // 省略其他结果
    ]
}</code></pre>


<p><strong>draw：</strong> 客户端调用服务端次数标识，客户端传过来是什么原样返回回去即可，无需修改</p>
<p><strong>recordsTotal：</strong> 数据总条数，没有过滤的数据总条数</p>
<p><strong>recordsFiltered：</strong> 过滤后符合要求的条数，如果没有搜索参数那么这个值与<code>recordsTotal</code>一致</p>
<p><strong>data：</strong> 需要显示的具体数据，json格式</p>
<h2 id="api">API调用</h2>
<p>Datatables提供了强大的API来处理表格上的数据，可以通过API添加数据到已经存在的表格，或者对已经存在的数据进行操作，API的类型非常丰富，详细的信息可以查阅官网，使用方法如下：</p>
<h3 id="_9">跳转到页</h3>
<p>跳转到第3页：</p>
<pre class="codehilite"><code>var table = $('#myTable').DataTable()

table.page(2).draw(false)</code></pre>


<p><strong>page(2)：</strong> page为分页方法，后边的2表示跳转到第几页，可以是一个数字，也可以是<code>first</code>、<code>next</code>、<code>previous</code>、<code>last</code>这样的字符串，当为数字时要从0算起，例如示例中为2实际上是跳转到了第3页</p>
<p><strong>draw(false)：</strong> 对表格进行重绘以实现表格更新的显示，大多数的api操作都不会直接更新在页面上，所以需要调用下<code>draw</code>，默认情况下重绘后分页会被重置回到第一页，当设置为<code>false</code>时分页不会被重置</p>
<h3 id="_10">搜索某列</h3>
<p>搜索第2列包含<code>ops-coffee.cn</code>的行</p>
<pre class="codehilite"><code>var tablx = $('#myTable').dataTable()

tablx.api().column(1).search('ops-coffee.cn').draw()</code></pre>


<p>首先需要注意这个例子中的API调用使用了<code>.api()</code>，这是因为上一个例子在初始化时用了<code>.DataTable()</code>而这个例子初始化时用了<code>.dataTable()</code>，仅仅是d字母大小写的区别而已，但意义确不同，前者直接返回API实例，后者返回的是jQuery实例</p>
<h4 id="_11">精确搜索</h4>
<p>默认情况下搜索时模糊匹配的，例如你搜索<code>ops-coffee.cn</code>，会把<code>blog.ops-coffee.cn</code>、<code>nav.ops-coffee.cn</code>之类的都搜索出来，如果想要精确匹配，仅搜索完全匹配<code>ops-coffee.cn</code>的结果，则需要借助于正则表达式来实现</p>
<pre class="codehilite"><code>tablx.api().column(1).search('^ops-coffee.cn$', true, false).draw()</code></pre>


<p>search接收4个参数，分别是：input、regex、smart、caseInsen，每个参数的解释如下</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>类型</th>
<th>是否可选</th>
<th>意义</th>
</tr>
</thead>
<tbody>
<tr>
<td>input</td>
<td>string</td>
<td>No</td>
<td>应用于表格搜索的字符串</td>
</tr>
<tr>
<td>regex</td>
<td>boolean</td>
<td>Yes - default:false</td>
<td>作为正则表达式（true）或不作为（默认为false）</td>
</tr>
<tr>
<td>smart</td>
<td>boolean</td>
<td>Yes - default:true</td>
<td>执行内置搜索算法（默认为true）或者不执行（false）。在使用此参数前，确保第二个参数是false，不然两个正则表达式可能冲突导致意想不到的结果。 如果你不想使用内置算法搜索，置为false，第二个参数为true，即可自定义正则表达式搜索</td>
</tr>
<tr>
<td>caseInsen</td>
<td>boolean</td>
<td>Yes - default:true</td>
<td>不区分大小写匹配（默认为true）或者区分大小写匹配（false）</td>
</tr>
</tbody>
</table>
<h2 id="demo">完整Demo</h2>
<p>为了方便大家学习，我写了个完整的demo，你可以在线查看效果或下载代码应用到自己的项目中</p>
<p>在线Demo地址：<a href="https://demo.ops-coffee.cn/datatables/" target="_blank">https://demo.ops-coffee.cn/datatables/</a></p>
<p>Github源码地址：<a href="https://github.com/ops-coffee/demo/tree/master/datatables" target="_blank">https://github.com/ops-coffee/demo/tree/master/datatables</a></p>

        <div>
          <ul style="display: inline-block;padding: 0;margin: 0 0 0.5em;color: #999;">
            <li style="display: inline-block;margin: 0 1em 0 0;"><a href="/frontend/front-end-components-jquery-datatables-2.html">📅 2019-08-08</a></li>
<li style="display: inline-block;margin: 0 1em 0 0;"><a href="/tag/前端插件/">🏷️ 前端插件</a></li><li style="display: inline-block;margin: 0 1em 0 0;"><a href="/tag/关于技术/">🏷️ 关于技术</a></li>          </ul>
        </div>

        <hr>

        <div class="nav-cell">
            <script async src="https://giscus.app/client.js"
                    data-repo="ops-coffee/blog" data-repo-id="MDEwOlJlcG9zaXRvcnkxNDY4OTI0MTg="
                    data-category="Announcements" data-category-id="DIC_kwDOCMFmgs4CQar3"
                    data-mapping="pathname" data-strict="0" data-reactions-enabled="1"
                    data-emit-metadata="0" data-input-position="top" data-theme="light"
                    data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous">
            </script>
        </div>

        <div>
            <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8944257246828217"
                 data-ad-slot="6731434232" data-ad-format="auto" data-full-width-responsive="true"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>

        <div class="nav-cell">
            <p class="nav-list-title">能看到这里一定是真爱，关注一下吧</p>
            <img alt="" loading="lazy" src="/static/images/wx.sou1.png" />
        </div>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <div class="copy"> © ops-coffee</div>

      <div class="link">
        <a href="/search.html" title="搜索" target="_blank">搜索</a>
        <a href="/questions.html" title="提问" target="_blank">提问</a>
        <a href="/friends.html" title="友情链接" target="_blank">友链</a>
      </div>
    </div>
  </footer>
  
  <!-- Umami Cloud -->
<script async src="https://umami.ops-coffee.cn/script.js" data-website-id="a4aabd8e-32c7-40e7-a81c-119b909f2d0f"></script>

<!-- Google Adsense -->
<script data-ad-client="ca-pub-8944257246828217" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</body>

</html>